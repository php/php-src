#!/bin/sh
#
# Generate credits_*.h headers from the ext/*/CREDITS and sapi/*/CREDITS files.

# Go to project root directory
cd $(CDPATH= cd -- "$(dirname -- "$0")/../../" && pwd -P)

awkprog='
BEGIN { FS = "\n|\r\n|\r"; RS = "" }
{ print "CREDIT_LINE(\""$1"\", \""$2"\");" }'

for what in ext sapi
do
  file=ext/standard/credits_$what.h
  cat >$file <<END
/*
                      DO NOT EDIT THIS FILE!

 it has been automatically created by scripts/dev/credits from
 the information found in the various ext/.../CREDITS and
 sapi/.../CREDITS files

 if you want to change an entry you have to edit the appropriate
 CREDITS file instead

*/

END
  # Do not process skeleton
  files=`find "$what" -name CREDITS | grep -v "$what"/skeleton/CREDITS`
  awk "$awkprog" $files | LC_ALL=C sort -f | uniq >> $file
  echo "Updated $file"
done
