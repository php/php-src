LTLIBRARY_NAME = libmain.la

LTLIBRARY_SOURCES_COMMON = \
       main.c snprintf.c php_sprintf.c \
       safe_mode.c fopen_wrappers.c alloca.c \
       php_ini.c SAPI.c rfc1867.c php_content_types.c strlcpy.c \
       strlcat.c mergesort.c reentrancy.c php_variables.c php_ticks.c \
       streams.c network.c php_open_temporary_file.c php_logos.c \
       output.c memory_stream.c

LTLIBRARY_SOURCES = $(LTLIBRARY_SOURCES_COMMON) internal_functions.c

LTLIBRARY_CLI_NAME = libmain_cli.la
LTLIBRARY_CLI_SOURCES = $(LTLIBRARY_SOURCES_COMMON) internal_functions_cli.c
LTLIBRARY_CLI_OBJECTS = $(LTLIBRARY_CLI_SOURCES:.c=.lo) $(LTLIBRARY_CLI_OBJECTS_X)

targets = $(LTLIBRARY_NAME) $(LTLIBRARY_CLI_NAME)

include $(top_srcdir)/build/rules.mk
include $(top_srcdir)/build/library.mk

$(LTLIBRARY_CLI_NAME): $(LTLIBRARY_CLI_OBJECTS) $(LTLIBRARY_CLI_DEPENDENCIES)
	$(LINK) $(LTLIBRARY_LDFLAGS) $(LTLIBRARY_CLI_OBJECTS) $(LTLIBRARY_CLI_LIBADD)

internal_functions.c: $(srcdir)/internal_functions.c.in $(top_builddir)/config.status
	cd $(top_builddir) && \
	REDO_ALL=yes ./config.status
