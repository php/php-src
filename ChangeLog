Mon Mar 19 17:18:51 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_flat_map_func): convert the block value to
	  Array if it doesn't respond to each.  [ruby-core:43334]
	  [Bug #6155]

Mon Mar 19 16:34:14 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enum.c (zip_i): variadic argument needs explicit cast on the
	  platforms where VALUE is longer than int.

Mon Mar 19 15:36:41 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (enumerable_lazy): add an example of take and first
	  to the documentation.  [ruby-core:43344] [Bug #6158]
	  add the description of the behavior when a block is given to zip
	  or cycle.

Mon Mar 19 15:20:53 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_specialized_instruction): DRY and replace chain
	  of if-else with switch for special instructions.  based on a
	  patch by Vasfed.  https://github.com/ruby/ruby/pull/105

Mon Mar 19 15:05:54 2012  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/test_pty.rb: same as r29280, skip tests when PTY allocation
	  failed (that's not our fault).

Sun Mar 18 23:21:17 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (aligned_free): fix condition for free.  memalign() and
	  posix_memalign() are not defined together normally.

Sun Mar 18 18:31:45 2012  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* gc.c (aligned_malloc, aligned_free): added fallback implementations
	  for platforms like OSX Leopard.

Sun Mar 18 17:17:48 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_pow): estimate result bit size more precisely.
	  [ruby-core:30735][Feature #3429]

Sun Mar 18 17:17:36 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (free_method_entry_i): method entry may be in
	  unlinked_method_entry_list.  [ruby-core:43383][Bug #6171]

Sun Mar 18 15:27:31 2012  Tanaka Akira  <akr@fsij.org>

	* compile.c: typo fix by Run Paint Run Run.
	  [ruby-core:28368] [Bug #2824]

Sun Mar 18 10:01:02 2012  Kazuki Tsujimoto  <kazuki@callcc.net>

	* lib/profiler.rb: support calling singleton methods of
	  an instance of BasicObject.

Sat Mar 17 06:56:58 2012  Eric Hodel  <drbrain@segment7.net>

	* object.c:  Fix indentation of Class#inherited example.

Sat Mar 17 01:46:05 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* string.c (trnext): fix bug with string ending with '\\'.
	  [ruby-dev:45374][Bug #6160]

	* test/ruby/test_string.rb (TestString#test_delete): test for
	  above.

Fri Mar 16 20:06:24 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (trnext): should advance char-wise.
	  [ruby-core:43335][Bug #6156]

Fri Mar 16 17:42:05 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (block_append_gen): fix unreachable warning line number.
	  should warn at the code, not jump.

Fri Mar 16 17:33:08 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_take): allocate buffer array before iteration, as well
	  as enum_first did.

	* enum.c (enum_first): remove duplication.

Fri Mar 16 14:43:18 2012  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* load.c (ruby_init_ext): don't free the given pointer itself.
	  It is not guaranteed even that the pointer is on heap.

Fri Mar 16 14:37:57 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_eval.c (rb_mod_module_eval): fix the documentation of
	  class_eval to mention class variable lookup.  [ruby-core:40649]
	  [Bug #5544]

Fri Mar 16 14:27:11 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* vm_eval.c (rb_mod_module_eval): fix the documentation of
	  class_eval to mention constant lookup.  [ruby-core:41718]
	  [Bug #5777]

Fri Mar 16 14:10:45 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (initialize): raise Net::IMAP::Error when the
	  connection is closed without a greeting response.
	  [ruby-core:40938] [Bug #5616]

Fri Mar 16 13:50:12 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (rfc822_text): ignore [] after RFC822.
	  [ruby-core:40945] [Bug #5620]

Fri Mar 16 12:00:42 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (argument_error): use line number at the beginning
	  of lambda, not the first code of its body.
	  [ruby-core:43314][Bug #6151]

	* iseq.c (rb_iseq_first_lineno): constified.

Fri Mar 16 11:20:07 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_take): don't enumerate an extra value.
	  [ruby-dev:45370] [Bug #6152]

Fri Mar 16 06:30:10 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (lazy_zip_func): variadic argument needs explicit cast
	  on the platforms where VALUE is longer than int.

	* enumerator.c (lazy_init_iterator): no need to check overflow twice.

Fri Mar 16 05:47:09 2012  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c (lazy_init_iterator):  Fix type error (int vs long).

Thu Mar 15 23:13:36 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enum.c (rb_enum_values_pack): rename from enum_values_pack, and
	  remove static.

	* enumerator.c (lazy_init_iterator, lazy_init_yielder,
	  lazy_select_func, lazy_reject_func, lazy_grep_func): handle
	  multiple values correctly.

	* enumerator.c (lazy_grep): change the behavior when a block is
	  given, to be consistent with Enumerable#grep.

Thu Mar 15 19:12:31 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_zip): rescue StopIteration returned by
	  Enumerator#next.

Thu Mar 15 18:19:53 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_zip, lazy_cycle): Enumerator::Lazy#{zip,cycle}
	  should be eager when a block is given, to be consistent with
	  Enumerable#{zip,cycle}.

Thu Mar 15 17:45:27 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (InitVM_Enumerator): renamed Enumerable::Lazy to
	  Enumerator::Lazy.

Thu Mar 15 16:37:38 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (enumerable_lazy): added cycle to the documentation.

Thu Mar 15 15:37:42 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_yylex): fix warning line number.

Thu Mar 15 15:19:38 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (lazy_cycle): check argument number overflow before
	  creating temporary array.

Thu Mar 15 15:04:54 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (ruby_strtod): no need to check same digit for hexdigit
	  twice.  [ruby-dev:45363][Bug #6146]

	* parse.y (sym_check_asciionly): check ascii compatibility before
	  scanning for code range.

	* parse.y (intern_str): set to us-ascii if ascii only.
	  [ruby-dev:45363][Bug #6146]

	* file.c (ruby_enc_find_basename): allow NULL as alllen.
	  [ruby-dev:45363][Bug #6146]

Thu Mar 15 14:49:31 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_conv_enc_opts): default to original encoding.

Thu Mar 15 13:47:17 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* hash.c (env_str_new, rb_f_getenv, env_fetch): use rb_str_conv_enc()
	  instead of rb_str_encode() to simplify the code.

Thu Mar 15 12:44:50 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (rb_w32_ugetenv): new API to
	  accept and to return UTF-8 strings.

	* win32/win32.c (rb_w32_getenv): follow above change.

	* win32/win32.c (rb_w32_get_environ): returns UTF-8 environment area.

	* hash.c (env_str_new, rb_f_getenv, env_fetch): follow above changes.
	  [Bug #5570] [ruby-core:40737]

Thu Mar 15 10:57:27 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_cycle): add Enumerable::Lazy#cycle.

Thu Mar 15 10:31:40 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_arity.rb (TestArity#err_mess): use assert_raise.

Thu Mar 15 07:03:52 2012  Eric Hodel  <drbrain@segment7.net>

	* vm_eval.c (check_funcall):  Raise ArgumentError if respond_to?
	  requires more than three arguments. [Bug #6000]

	* test/ruby/test_object.rb (class TestObject):  Test for respond_to?
	  requiring more than three arguments.

Thu Mar 15 06:08:06 2012  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* include/ruby/intern.h: Add rb_check_arity, rb_error_arity [#6085]

	* array.c: Use rb_check_arity / rb_error_arity

	* class.c: ditto

	* enumerator.c: ditto

	* eval.c: ditto

	* file.c: ditto

	* hash.c: ditto

	* numeric.c: ditto

	* proc.c: ditto

	* process.c: ditto

	* random.c: ditto

	* re.c: ditto

	* signal.c: ditto

	* string.c: ditto

	* struct.c: ditto

	* transcode.c: ditto

	* vm_eval.c: ditto

	* vm_insnhelper.c: ditto & implementation of rb_error_arity

	* test/ruby/test_arity.rb: tests for above

Thu Mar 15 06:08:05 2012  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* vm_insnhelper.c: improve number of arguments error in case of
	  optional parameters (issue #6085)

	* include/ruby/intern.h: define UNLIMITED_ARGUMENTS

	* test/ruby/test_arity.rb:  test for above

Thu Mar 15 00:58:04 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (enumerable_lazy): fix the documentation of
	  Enumerable#lazy.

Wed Mar 14 22:01:06 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_init_iterator): break when Qundef is returned
	  to make obj.drop(3).take(2) work properly.

	* enumerator.c (lazy_take_while): add Enumerable::Lazy#take_while.

	* enumerator.c (lazy_drop): add Enumerable::Lazy#drop.

	* enumerator.c (lazy_drop_while): add Enumerable::Lazy#drop_while.

	* enumerator.c (InitVM_Enumerator): add Enumerable::Lazy#force as an
	  alias of to_a.

Wed Mar 14 19:28:40 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_take): add Enumerable::Lazy#take.

Wed Mar 14 18:40:36 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c: use long for array indices.

Wed Mar 14 18:25:18 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c: moved the comment of StopIteration.

Wed Mar 14 17:55:29 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (flodivmod): must go through the same pass if HAVE_FMOD or
	  not.  this is a bugfix of r35013.

Wed Mar 14 16:41:55 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/test_tmpdir.rb (TestTmpdir#test_world_writable): skip on Windows.

Wed Mar 14 15:09:23 2012  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c: fix flodivmod for cornercases [Bug #6044]
	  add ruby_float_mod

	* insns.def (opt_mod): use ruby_float_mod

	* internal.h: declare ruby_float_mod

	* test/ruby/test_float.rb: tests for above

	* test/ruby/envutil.rb: create helper assert_is_minus_zero

Wed Mar 14 10:44:35 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (lazy_grep_func): should use === instead of =~, as
	  well as Enumerable#grep

Wed Mar 14 08:15:54 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_flat_map_func): use each for non-Array objects.

Wed Mar 14 08:06:35 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_zip): add Enumerable::Lazy#zip.

	* enumerator.c (lazy_lazy): just returns self.

Wed Mar 14 07:48:36 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (datetime_s_now): [ruby-core:43256].

Tue Mar 13 22:00:14 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_set_arguments): keyword rest arg without keyword args.

	* node.c (dump_node): dump kw_rest_arg too.

	* parse.y (block_param, f_arg): more kwrest patterns.
	  [ruby-core:42455][Bug #5989]

	* parse.y (new_args_gen): no extra kw_rest_arg if no keyword rest arg.

Tue Mar 13 15:17:03 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (block_param, f_args): add rules for the case arguments
	  begin with kwrest.  [ruby-core:42455][Bug #5989]

Tue Mar 13 12:37:53 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_encoding_set): always warn if external encoding and internal
	  encoding are identical. [ruby-core:40727] [Bug #5568]

Tue Mar 13 12:37:03 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c: add ObjectSpace::WeakMap.  [ruby-dev:44565][Bug #5350]

	* lib/weakref.rb: use WeakMap instead of _id2ref.

Tue Mar 13 10:59:48 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (prepare): skip if basedir is not defined.
	  [ruby-core:39135][Bug #5238]

	* tool/rbinstall.rb (CONFIG.[]): check for mandatory
	  configurations.

Tue Mar 13 00:09:18 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (enumerable_lazy): added documentation.

Mon Mar 12 20:19:25 2012  Tanaka Akira  <akr@fsij.org>

	* lib/tmpdir.rb (Dir::tmpdir): test the current directory suitable for
	  temporary directory.

Mon Mar 12 20:08:16 2012  Tanaka Akira  <akr@fsij.org>

	* lib/fileutils.rb (fu_have_symlink?): specify TypeError for rescue
	  clause.

Mon Mar 12 19:23:13 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (rb_find_encoding): new function find encoding from
	  arbitrary object as a pointer to rb_encoding, and return NULL if
	  not found.

	* io.c (io_encoding_set): just warn unsupported encodings, but not
	  exception.  [ruby-core:40726] [Bug #5567]

Mon Mar 12 19:03:32 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (Init_eval_method): respond_to? and
	  respond_to_missing? are public.

Mon Mar 12 14:56:52 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (NEW_YIELD), parse.y (new_yield_gen): array-values flags
	  has been already obsolete.  patch by Thomas Enebo.
	  [ruby-core:41929][Bug #5847]

Mon Mar 12 12:44:33 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_method.c (Init_eval_method): copy basic methods to Exception.
	  [ruby-core:40287][Bug #5473]

Mon Mar 12 10:13:36 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_jump.c (rb_exec_end_proc): remember the latest exit status.
	  [ruby-core:43173][Bug #5218]

Mon Mar 12 07:33:12 2012  Tanaka Akira  <akr@fsij.org>

	* lib/tmpdir.rb: update document for changing
	  FileUtils.remove_entry_secure to FileUtils.remove_entry.

	* NEWS: add incompatibility note for lib/tmpdir.rb.

Mon Mar 12 07:19:03 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/tmpdir.rb (Dir.tmpdir): should not use world-writable but
	  non-sticky directory.

	* lib/tmpdir.rb (Dir.mktmpdir): check the parent directory.

Mon Mar 12 07:04:11 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (Init_Random): removed rb_Random_DEFAULT and register as
	  mark-object instead of global variable.

Mon Mar 12 07:03:32 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* random.c (random_s_rand): ensure default PRNG is re-initialized
	  after fork.  patched by Eric Wong.  [ruby-core:41209][Bug #5661]

Sun Mar 11 23:57:29 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* pack.c (pack_unpack): when unpack('M') occurs an illegal byte
	  sequence, output the "=" character and the following character in
	  the decoded data without any transformation.
	  [ruby-dev:44875] [Bug #5635]

Sun Mar 11 22:32:43 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Merge 164a75c8bd2007d32c4d7665d53140d8fc126dcd.
	  [ruby-core:41917] [Bug #5846]

Sun Mar 11 17:10:04 2012  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Put error message into STDERR if failed to launch
	  worker (job) process. [ruby-dev:44802] [Bug #5577]

	* lib/test/unit/parallel.rb: If failed to increment_io, exit with code
	  2. [ruby-dev:44802] [Bug #5577]

Sun Mar 11 15:46:45 2012  Shota Fukumori  <sorah@tubusu.net>

	* io.c: fix rdoc of `IO.binwrite` to show same as `IO.write` except
	  it opens file with mode "wb:ASCII-8BIT". [Bug #5782] [ruby-core:42592]

Sat Mar 10 23:52:28 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c: pack tables also generic keys.  patched by Sokolov Yura at
	  https://github.com/ruby/ruby/pull/84

	* st.c: add st_foreach_check for fixing iteration over packed table
	  and st_delete_safe.  patched by Sokolov Yura at
	  https://github.com/ruby/ruby/pull/84

	* st.c: fix packed num_entries on delete_safe.  patched by Sokolov
	  Yura at https://github.com/ruby/ruby/pull/84

Fri Mar  9 14:29:32 2012  Shugo Maeda  <shugo@ruby-lang.org>

	* enumerator.c (lazy_flat_map): add Enumerable::Lazy#flat_map.

Fri Mar  9 06:29:22 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb (load, parse): stop parsing or loading after
	  the first document has been parsed.

	* test/psych/test_stream.rb: pertinent tests.

Fri Mar  9 06:17:05 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb (parse_stream, load_stream): if a block is
	  given, documents will be yielded to the block as they are parsed.
	  [ruby-core:42404] [Bug #5978]

	* ext/psych/lib/psych/handlers/document_stream.rb: add a handler that
	  yields documents as they are parsed

	* test/psych/test_stream.rb: corresponding tests.

Fri Mar  9 00:35:03 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (lazy_initialize, enumerable_lazy): no additional
	  arguments.

Fri Mar  9 00:30:23 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c: add Enumerable#lazy. based on the patch by
	  Innokenty Mikhailov at <https://github.com/ruby/ruby/pull/101>
	  [ruby-core:37164] [Feature #4890]

Fri Mar  9 00:25:59 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enumerator.c (enumerator_each, generator_each): pass arguments to
	  the block with yielder.

Fri Mar  9 00:25:02 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_cat): new function to concat objects into array.

Thu Mar  8 16:44:02 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* .gdbinit (rb_numtable_entry): update for recent refactoring of
	  st_table.

Wed Mar  7 22:41:50 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/xmlrpc/client.rb (module XMLRPC): fix typo.

	* test/xmlrpc/test_client.rb (test_async_call): add test for
	  XMLRPC::Client#call_async to check above fix.

Wed Mar  7 16:30:24 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_load_fail): should honor encoding.

	* load.c (load_failed): ditto.

Wed Mar  7 12:26:25 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_load_fail): use path as a string, not char*.

	* internal.h: (rb_load_fail): moved from ruby/intern.h.

	* ruby.c (load_file_internal): fname cannot be NULL.

Wed Mar  7 08:32:43 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* error.c (rb_loaderror_with_path): Adding the missing file as an
	  instance variable to the LoadError exception.
	  [ruby-core:39079]

	* load.c: call rb_loaderror_with_path so that the missing path is
	  added to the exception.

	* ruby.c: call rb_loaderror rather than raising our own LoadError
	  exception.

	* include/ruby/intern.h: add declaration for rb_loaderror_with_path.

	* test/ruby/test_require.rb: add supporting test for LoadError#path
	  method.

Wed Mar  7 08:28:00 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/xmlrpc/parser.rb: support i8 types. Thanks Stas Kelvich!
	  [ruby-core:29246] [Feature #3090]

	* test/xmlrpc/test_client.rb: supporting test

Wed Mar  7 07:43:29 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/xmlrpc/client.rb: assume servers that do not send a Content-Type
	  header are sending 'text/xml'. Thanks Nathan Leavitt!
	  [ruby-core:41204] [Bug #5660]

	* test/xmlrpc/test_client.rb: supporting test

Wed Mar  7 07:39:28 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/xmlrpc/test_client.rb: adding a test for performing an XMLRPC
	  call.
	* test/xmlrpc/data/blog.xml: supporting XML document for the response.

Tue Mar  6 16:24:01 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_string): escape simple regexp meta
	  character terminators.

Tue Mar  6 10:11:43 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (set_rawmode): clear ECHOE and ECHOK
	  bits too.

	* ext/io/console/console.c (echo_p): ignore ECHOE and ECHOK bits.
	  [ruby-dev:45309] [Bug #6116]

	* ext/io/console/console.c (console_raw): fix rdoc.

	* ext/io/console/console.c (console_set_echo): mentioned about
	  platform dependency.

Tue Mar  6 07:18:10 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/xmlrpc/client.rb: switch net/http post2 calls to modern
	  `request_post` methods.

Tue Mar  6 02:31:20 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/core_ext.rb: only extend Kernel if IRB is loaded
	  in order to stop method pollution.

Tue Mar  6 01:34:19 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (block_call): rules for block_call after block_call.
	  based on a patch by pasberth https://github.com/ruby/ruby/pull/102
	  [ruby-dev:45308][Bug #6115]

Tue Mar  6 01:24:13 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (block_command, block_call): simplified rules.

Mon Mar  5 18:28:35 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_regexp.rb (TestRegexp#test_source): fix typo.
	* test/ruby/test_regexp.rb (TestRegexp#test_equal): ditto.

Mon Mar  5 17:11:44 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/lib/syck/rubytypes.rb (Exception.yaml_new): fix bug
	  that causes YAML serialization problem for Exception.
	  Exception#initialize doesn't use visible instance variable for
	  the exception message, so call the method with the message.
	  patched by Jingwen Owen Ou <jingweno AT gmail.com>.
	  http://github.com/ruby/ruby/pull/41

Mon Mar  5 16:50:22 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_sleep.rb (TestSleep#test_sleep_5sec): syntax error.

	* test/ruby/test_sleep.rb (TestSleep#test_sleep_5sec): call uname
	  only on linux because it's a workaround for linux only.

Mon Mar  5 12:44:12 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (unpack_entries): chain entries directly.  based on a patch
	  by Sokolov Yura <funny.falcon AT gmail.com>.

	* st.c (unpack_entries): use union instead of casted pointer.
	  patched by Sokolov Yura <funny.falcon AT gmail.com>.

	* st.c: use PACKED_ENT and FIND_ENTRY.  patched by Sokolov
	  Yura <funny.falcon AT gmail.com>.

	* st.c (unpack_entries): reallocate bins if packed array size
	  is not same as initial bins size.  based on a patch by
	  Sokolov Yura <funny.falcon AT gmail.com>.

Mon Mar  5 11:51:48 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/bigdecimal/lib/bigdecimal/math.rb: remove description about
	  BigMath#log. patched by Sho Hashimoto [ruby-dev:45307] [Bug #6112]

	* string.c (str_byteslice): fix typo.

Sun Mar  4 23:21:10 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_string): regexp engine doesn't need
	  terminators to be escaped.  [ruby-core:40364][Bug #5484]

Sat Mar  3 22:51:46 2012  Tanaka Akira  <akr@fsij.org>

	* process.c (rb_run_exec_options_err): chdir at last to interpret
	  relative pathnames from the current directory of the parent process.

Sat Mar  3 12:20:44 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strftime.c: reassigned some variables.

Sat Mar  3 12:12:16 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_{parse,strptime}.c: [ruby-dev:45303].

Sat Mar  3 10:09:21 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/xmlrpc/client.rb (initialize): net/http defaults to 1_2 in 1.8+,
	  so we can safely remove the call to enable it.

Sat Mar  3 08:42:25 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/xmlrpc/client.rb (new2): use URI for uri parsing.
	* test/xmlrpc/test_client.rb: test that query params are passed to the
	  client constructor.

Sat Mar  3 08:20:10 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/xmlrpc/client.rb (new2): raises an ArgumentError on bad
	  arguments.
	* test/xmlrpc/test_client.rb: tests for bad uris

Sat Mar  3 08:08:11 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/xmlrpc/client.rb (new2): fix custom port specification when an
	  SSL uri is used.
	* test/xmlrpc/test_client.rb: tests for XMLRPC::Client.new2

Sat Mar  3 08:03:29 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/syck/rubyext.c (mktime_do): use ISDIGIT().
	  [ruby-core:43060] [Bug #6108]

	* ext/syck/token.c (sycklex_yaml_utf8): cast as unsigned char.
	  [ruby-core:43060] [Bug #6108]

Sat Mar  3 06:57:14 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (ruby_pc): make configurable.  [Bug #6051]

Fri Mar  2 17:49:03 2012  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* .travis.yml (branches): Enable TravisCI for ruby_1_9_3.

Fri Mar  2 17:13:33 2012  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/ruby/test_array.rb (test_combination2): Make the test case for
	  [ruby-core:29240] more descriptive.
	  cf. http://bugs.jruby.org/6518

Fri Mar  2 16:37:11 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (file_expand_path): use wcscasecmp().

Fri Mar  2 16:36:31 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.c (native_cond_timeout): cast explicitly to suppress
	  a warning.

Fri Mar  2 16:35:56 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (pipe_open): cmd is no longer used if fork is available.

Thu Mar  1 16:13:18 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* internal.h (rb_file_const, rb_file_load_ok): moved functions for
	  internal use only.

Thu Mar  1 15:40:05 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/makedirs.bat: new command to make intermediate
	  directories, and not to report any errors if the directory
	  already exists.

	* win32/Makefile.sub (MAKEDIRS): enable command extensions.

Thu Mar  1 01:25:43 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (is_onechar_cclass): optimize character class
	  Merge Onigmo 27278c12e6674043cc8affca6507e20e119a86ee.

	* regparse.c (is_onechar_cclass): [bug] unexpected match occurs when a
	  char class contains no char

	* enc/unicode.c (init_case_fold_table): define the sizes of case
	  folding tables in casefold.h

Wed Feb 29 16:11:34 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/Makefile.sub (MAKEDIRS): use mkdir of cmd.exe instead of ruby.
	  [Bug #6103] [ruby-core:43012]

	* win32/README.win32: added a notice about command extension of cmd.exe.

Wed Feb 29 15:39:39 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#test_readpartial_locktmp): skip on
	  windows because of the platform restriction.

Wed Feb 29 15:38:50 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/memory_status.rb (Memory): syntax error.

Wed Feb 29 13:06:42 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/memory_status.rb: use /proc/self/status if it is in
	  the expected format.

Wed Feb 29 06:14:51 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: reverted r34825.

Tue Feb 28 23:20:01 2012  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* Makefile.in (PLATFORM_DIR): add a variable for `win32` directory.
	* Makefile.in (clean-platform): add new target.
	  It cleans `win32` directory.

	* common.mk (clean): add a dependency for `win32` directory.
	* common.mk (distclean): ditto.
	* common.mk (distclean-platform): add new target.
	  It cleans `win32` directory.
	* common.mk ($(PLATFORM_D)): add new target to make `win32` directory.
	* common.mk (win32/win32.$(OBJEXT)): move win32.o into `win32`
	  directory.
	* common.mk (win32/file.$(OBJEXT)): add new target for win32/file.c.

	* configure.in: move win32.o into `win32` directory and add
	  win32/file.o to MISSING.

	* file.c (file_load_ok, rb_file_load_ok): replace static
	  file_load_ok() with public rb_file_load_ok().
	  It's to link Windows implementation in win32/file.c.
	* file.c (rb_find_file_ext_safe): ditto.
	* file.c (rb_find_file_safe): ditto.

	* win32/file.c (rb_file_load_ok): new file. Add Windows specific
	  optimized implementation of rb_file_load_ok(). We created a
	  separated file to avoid too many #ifdef macro which is unreadable.

	* win32/Makefile.sub (PLATFORM_DIR): add a variable for `win32`
	  directory.
	* win32/Makefile.sub (MISSING): move win32.obj into `win32`
	  directory and add win32/file.obj to MISSING.
	* win32/Makefile.sub (MAKEDIRS): replace MINIRUBY with BASERUBY.
	  It's because miniruby doesn't exist when making `win32` directory.
	* win32/Makefile.sub (clean-platform): add new target to clean `win32`
	  directory.
	* win32/Makefile.sub ({$(srcdir)}.c{}.obj): make it not match
	  win32/file.c to build properly.
	* win32/Makefile.sub (win32/win32.$(OBJEXT)): move win32.obj into
	 `win32` directory.

	  Patch created with Luis Lavena.
	  [ruby-core:42480] [Feature #5999]

Tue Feb 28 20:27:25 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: [ruby-core:42998]

Tue Feb 28 18:47:44 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_binwrite, rb_io_syswrite): use shared frozen source
	  strings.

	* io.c (io_fread, io_getpartial, rb_io_sysread): set buffer size
	  after check if readable, which can cause thread switch.
	  [ruby-dev:45297][Bug #6099]

Tue Feb 28 17:16:01 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/time.rb (Time#xmlschema): use strftime specifiers instead of
	  fractional exponential calculation which yields undesirable
	  result.  [ruby-core:42997][Bug #6100]

Tue Feb 28 14:15:29 2012  Eric Hodel  <drbrain@segment7.net>

	* lib/net/protocol.rb: Add OpenTimeout subclass of Timeout::Error
	* lib/net/pop.rb:  Modernize Timeout usage.  Patch by Eric Wong.
	  Use Net::OpenTimeout instead of Timeout::Error.  [Bug #5765]
	* lib/net/http.rb:  ditto
	* lib/net/smtp.rb:  ditto
	* lib/net/telnet.rb:  ditto

Tue Feb 28 13:51:12 2012  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Retry HTTP requests for additional network errors.
	  Introduce OpenTimeout subclass of Timeout::Error.  [Bug #6001]
	* test/net/http/test_http.rb:  Reduce timeout to 0.01s for faster test
	* test/net/http/test_https.rb:  ditto

Tue Feb 28 11:44:49 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (debugflags): check if -ggdb is accepted.
	  [ruby-core:42875][Bug #6080]

Tue Feb 28 10:28:51 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: default open YAML files with utf8 external
	  encoding. [ruby-core:42967]
	* test/psych/test_tainted.rb: ditto

Mon Feb 27 23:46:09 2012  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (opt_bv_decl): allow newline at the end.  [ruby-dev:45292]

Mon Feb 27 20:43:05 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_set_pos): add rdoc about textmode.

	* test/ruby/test_io.rb (TestIO#test_setpos): use binmode.

Mon Feb 27 17:00:15 2012  Akinori MUSHA  <knu@iDaemons.org>

	* string.c (rb_str_crypt): Update rdoc and state that this
	  function is system dependent.  Reviewed by nobu, thanks to
	  @takai.

Mon Feb 27 17:03:20 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (GetVpValueWithPrec): since methods
	  can be overridden, so should not make an assumption on the type
	  of results.  [ruby-core:42969][Bug #6093]

Mon Feb 27 10:54:20 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (try_cppflags, try_cflags, try_ldflags): replace the
	  target flags if the given flag is accepted.

Mon Feb 27 10:53:44 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/rubygems/test_gem_specification.rb (test_self_from_yaml_syck_default_key_bug):
	  ignore the test for too old versions.

Mon Feb 27 10:53:12 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit.rb (Test::Unit::Runner#puke): skips with no
	  messages should be trivial.

Mon Feb 27 10:50:23 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c, process.c, time.c, ext: use rb_sys_fail_str instead of
	  rb_sys_fail.

Mon Feb 27 10:48:49 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/openssl/extconf.rb: suppress useless deprecation warnings
	  from OpenSSL added by Apple.

Sun Feb 26 23:29:49 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (add_code_range_to_buf0): wrong condition of duplicated
	  warnings.

Sun Feb 26 11:26:44 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (iseq_compile_each): call on special object instead of
	  self.  since stabby lambda is a syntax, so it should not be
	  affected by the context.  [ruby-core:42349][Bug #5966]

	* insns.def (send): no special deal for FCALL.  self should be put
	  on TOS instead.

Sun Feb 26 05:35:43 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* error.c (report_bug): use buf and snprintf to avoid consuming stack.
	  [ruby-dev:45272] [Bug #6058]

Sat Feb 25 17:41:19 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb (headers): try ambiguous headers at last.

Sat Feb 25 17:07:15 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/fileutils.rb: use chomp(?/) instead of sub to optimize and avoid
	  to regexping invalid string.

Sat Feb 25 16:18:24 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* complex.c (nucomp_marshal_load): raise error on invalid data.
	  reported by John Firebaugh [ruby-core:42860] [Bug #6076]

Sat Feb 25 14:46:54 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/dl.c (Init_dl): support intrinsic types, size_t, ptrdiff_t
	  and intptr_t.  [ruby-core:42460][Feature #5992]

	* ext/fiddle/fiddle.c (Init_fiddle): ditto.

	* ext/dl/lib/dl/cparser.rb (DL::CParser#parse_ctype): ditto.

Sat Feb 25 11:08:28 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c (Init_curses): use rb_define_const once for
	  Curses::VERSION.

	* ext/dbm/dbm.c (Init_dbm): ditto for DBM::VERSION.

Sat Feb 25 10:34:22 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c (Init_curses): make Curses::VERSION
	  understandable without context.

	* ext/dbm/dbm.c (Init_dbm): ditto for DBM::VERSION.

Sat Feb 25 07:53:58 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_string): insert a backslash only if
	  quoted by single quotes.  [ruby-dev:45281] [Bug #6069]

Sat Feb 25 07:53:49 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_inspect), io.c (rb_io_inspect): keep encoding of path.
	  [Bug #6072]

Sat Feb 25 07:53:40 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_initialize): keep path in original encoding.

	* error.c (syserr_initialize): prefer the encoding of message over
	  locale.  [ruby-dev:45279][Bug #6071]

Sat Feb 25 06:55:29 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (utime_internal): fix a variable missed to replace.
	  [ruby-core:42864] [Bug #6077]

Fri Feb 24 18:21:55 2012  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/zlib/test_zlib.rb (TestZlibGzipReader#test_encoding): Add
	  encoding testcases for GzipReader#read.  read() emits
	  Encoding.default_external in contrast to read(size) emits BINARY.
	  See also: http://bugs.jruby.org/6208

Fri Feb 24 17:56:39 2012  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/ruby/test_literal.rb (TestRubyLiteral#test_special_const):
	  test for https://bugs.php.net/bug.php?id=61095

Fri Feb 24 16:48:29 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c, file.c, io.c (rb_sys_fail_path): use rb_sys_fail_str.

	* error.c: new functions to deal exceptions with string instances.

	* dir.c, file.c, io.c: use rb_sys_fail_path.

Fri Feb 24 15:49:07 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (__builtin_unreachable): check for clang.
	  [ruby-core:42849]

	* include/ruby/ruby.h (UNREACHABLE): fallback definition.

Fri Feb 24 13:54:33 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c: prevent a memory leak by protecting calls to
	  handler callbacks.
	* test/psych/test_parser.rb: test to demonstrate leak.

Fri Feb 24 12:07:34 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/net/http.rb: Fix documentation. Patched from Florian Mhun
	  via http://github.com/ruby/ruby/pull/96

Fri Feb 24 11:48:07 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* string.c (rb_str_prepend): Fix documentation for String#prepend.
	  Patched from Franck Verrot via http://github.com/ruby/ruby/pull/98
	  and Andrew Horsman via http://github.com/ruby/ruby/pull/55

Fri Feb 24 10:08:33 2012  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb (Net::HTTP#transport_request):  Fix infinite loop
	  upon EOFError or Errno::ECONNRESET where count is reset to 0.
	* test/net/http/test_http.rb (class TestNetHTTPKeepAlive):  Test for
	  above.

Fri Feb 24 09:05:40 2012  Eric Hodel  <drbrain@segment7.net>

	* complex.c (Init_Complex):  Document Complex::I.  Patch by Sylvain
	  Daubert.  [Feature #5623]

Fri Feb 24 08:52:09 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_string, parser_yylex): insert a backslash
	  if the next character is non-ascii.  [ruby-dev:45278] [Bug #6069]

Fri Feb 24 08:13:20 2012  Eric Hodel  <drbrain@segment7.net>

	* lib/profiler.rb:  Add Profiler documentation by Gonzalo Rodriguez.
	  [Bug #5816]

Fri Feb 24 08:08:38 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c: set parser encoding based on the YAML input
	  rather than user configuration.
	* test/psych/test_encoding.rb: corresponding tests.
	* test/psych/test_parser.rb: ditto
	* test/psych/test_tainted.rb: ditto

Fri Feb 24 08:02:52 2012  Eric Hodel  <drbrain@segment7.net>

	* hash.c (Init_Hash):  Add section on how objects are used as Hash keys
	  and how to use custom classes as Hash keys.

Fri Feb 24 07:36:11 2012  Eric Hodel  <drbrain@segment7.net>

	* object.c (rb_obj_eql):  Improve equality documentation by adding an
	  example of equal? vs == and recommending eql? be aliased to == when
	  overridden.

Fri Feb 24 07:21:15 2012  Eric Hodel  <drbrain@segment7.net>

	* object.c (rb_obj_hash):  Added note that the hash value is not
	  deterministic on Marc-Andre's suggestion.  Expanded description of
	  the purpose of the hash method.  [Bug #6068]

Thu Feb 23 23:01:21 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: unused macro removed.

Thu Feb 23 22:26:53 2012  Tanaka Akira  <akr@fsij.org>

	* test/test_curses.rb: new file.

Thu Feb 23 19:57:56 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/rain.rb: trap SIGHUP, SIGINT, SIGQUIT and SIGTERM only.

Thu Feb 23 19:56:48 2012  Tanaka Akira  <akr@fsij.org>

	* signal.c (sig_trap): show signal name on error.

Thu Feb 23 12:21:48 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: use DBM_SUFFIX only to detect header of
	  Berkeley DB.

Thu Feb 23 10:00:18 2012  Eric Hodel  <drbrain@segment7.net>

	* io.c (rb_io_f_sync):  Fix double-negative typo.  [ruby-trunk - #5837]

Thu Feb 23 09:57:21 2012  Eric Hodel  <drbrain@segment7.net>

	* load.c (rb_f_require):  Add note to require for scope of items in the
	  loaded file.  [ruby-trunk - #5910]

Thu Feb 23 03:58:08 2012  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/ostruct.rb (delete_field): Bug fix so previous value is
	  returned. Patch by Nick Recobra [Bug #6063]

Thu Feb 23 02:33:00 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_extract_modeenc): fail only if conflicting
	  text/binary modes given explicitly.  [ruby-dev:45268][Bug #6055]

Wed Feb 22 23:27:08 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/iconv/test_option.rb: enabled.  [ruby-core:42802][Bug #6061]

Wed Feb 22 21:45:56 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c: use defined() to suppress a warning.

Wed Feb 22 21:44:29 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: refactored.

Wed Feb 22 20:42:28 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: try to distinguish curses_version is a
	  function or variable.

	* ext/curses/curses.c (Init_curses): refine Curses::VERSION.

Wed Feb 22 19:47:03 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: show the chosen header and library.

Wed Feb 22 19:22:31 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* reverted 34739 for test/date.

Wed Feb 22 19:08:55 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: refactored.

Wed Feb 22 18:44:41 2012  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb (setup_options): add option "--retry" as opposite
	  for "--no-retry"

Wed Feb 22 18:34:02 2012  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb (setup_options): add option "--show-skip" to
	  cancel "--hide-skip" (-q)

Wed Feb 22 17:36:22 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_s_foreach): argument check before making Enumerator.
	  [ruby-dev:31525]

Wed Feb 22 17:07:35 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_s_foreach): return enumerator including kerword
	  arguments.  [ruby-dev:45267][Bug #6054]

Wed Feb 22 12:15:16 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: allow llvm-gcc because it work fine with r34278.

Wed Feb 22 10:57:08 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* regparse.c (fetch_token): don't use // comment.

Wed Feb 22 10:32:11 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/mkmf/test_framework.rb: try CoreFoundation framework, than
	  Cocoa which is dependent on QuickTime SDK which has separated
	  since Xcode 4.3.

Wed Feb 22 10:18:05 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (test-all, test-ruby): more dependencies.

Wed Feb 22 06:48:55 2012  Eric Hodel  <drbrain@segment7.net>

	* file.c (rb_f_test):  Fix formatting of Kernel#test rdoc.

Wed Feb 22 06:12:15 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: check DBM_SUFFIX for Mac OS X.
	  Its ndbm.h doesn't include db.h.

Wed Feb 22 06:02:42 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c (fdbm_initialize): disable Berkeley DB error messages.

	* ext/dbm/extconf.rb: check DBC type for above.

	[ruby-dev:45269]

Tue Feb 21 20:23:47 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (rb_any_hash): treat Qundef like as other special constants.

	* hash.c (hash_foreach_iter): fix signature.

Tue Feb 21 19:39:34 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c (Init_curses): use curses_version() for
	  Curses::VERSION.

Tue Feb 21 18:21:25 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c : remove gc_clear_mark_on_sweep_slots() and use
	  rest_sweep() instead of it, because some dead objects might be
	  marked in next the mark phase by false pointers.
	  [ruby-core:42672]

Tue Feb 21 16:08:17 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (rb_hash_proc): get wrapped pointer properly.  [Bug #6048]

Tue Feb 21 14:41:10 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/ruby.pc.in: added rubylibprefix, {rubylib,vendor,site}dir
	  and {ruby,vendor,site}archdir.  [ruby-core:42766][Feature #6052]

Tue Feb 21 09:13:25 2012  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* proc.c (method_hash, proc_hash): Fix {Unbound}Method#hash
	  [Bug #6048]. Isolate hash computation for proc

	* internal.h: Declaration for above

	* vm_method.c (rb_method_definition_hash): Computation for
	  hash part of a method definition

	* method.h: Declaration for above

	* test/ruby/test_method.rb: Test for above

Tue Feb 21 02:56:15 2012  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* enumerator.c (enumerator_rewind): update the documentation.
	  fixed: #6053

Mon Feb 20 23:38:35 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* enc/depend: ignore mktable.c because it's not encoding library.
	  [ruby-core:42760] [Bug #6049]

Mon Feb 20 21:40:53 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: fold too long lines.

Mon Feb 20 21:16:48 2012  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* lib/fileutils.rb: revert a line modified accidentally at r34669.
	  This fixes mingw test errors in TestDir_M17N.
	  [ruby-core:42728] [Feature #4970]

Mon Feb 20 21:09:27 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/curses.c (Init_curses): define Curses::VERSION.

Mon Feb 20 21:08:00 2012  Tanaka Akira  <akr@fsij.org>

	* ext/curses/extconf.rb: restore $libs and $defs for each
	  header/library choice.

Mon Feb 20 19:57:26 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: weaken header/library consistency check if db is
	  "ndbm".  It seems several (possibly historical) distributions
	  provide libndbm.  However the content of libndbm vary: Berkeley DB,
	  GDBM or even 4.3BSD NDBM.  (Mandriva, Tru64 UNIX, OpenSuSE,
	  SCO OpenServer, ...)
	  "ndbm" is not searched automatically now (dblib doesn't contain it)
	  but configure --with-dbm-type=ndbm choose libndbm and ndbm.h.

Mon Feb 20 19:15:57 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: refine variable names.

Mon Feb 20 15:50:33 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check if -fstack-protector is really available.

Sun Feb 19 23:43:38 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: show header and library found.

Sun Feb 19 23:01:01 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c (Init_dbm): refine DBM::VERSION definition.

	* ext/dbm/extconf.rb: provide RUBYDBM_GDBM_HEADER macro.

Sun Feb 19 17:07:27 2012  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb (test_dbmfile_suffix): check pag and dir is
	  empty for 4.3BSD ndbm.

Sun Feb 19 03:00:30 2012  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb (test_dbmfile_suffix): check magic numbers.

Sun Feb 19 01:05:41 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: detect GDBM's ndbm.h by testing dbm_clearerr is
	  an empty macro.

Sun Feb 19 00:25:55 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: don't choose 'dbm' if _GDB_H_ is defined which
	  is available since GDBM 1.9 because 'gdbm_compat' is appropriate
	  choice since GDBM 1.8.1.

Sat Feb 18 23:27:00 2012  Kenta Murata  <mrkn@mrkn.jp>

	* random.c: remove a duplicated comment.

Sat Feb 18 18:43:13 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb (dblib): prefer recent GDBM over older GDBM.
	  (have_declared_libvar): new function to check a declared variable
	  exists in a library.
	  (have_undeclared_libvar): renamed from renamed from have_libvar.
	  (headers.db_check2): check that GDBM version variable if GDBM header
	  is chosen.

	* ext/dbm/dbm.c (Init_dbm): use HAVE_DECLARED_LIBVAR_GDBM_VERSION and
	  HAVE_UNDECLARED_LIBVAR_GDBM_VERSION macro.

Sat Feb 18 13:53:01 2012  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb (test_dbmfile_suffix): DBM::VERSION should
	  be Berkeley DB if foo.db is created by DBM.open.

Sat Feb 18 13:40:37 2012  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb (test_dbmfile_suffix): test dbm file suffix.

Sat Feb 18 12:50:59 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c (DBM::VERSION): define it by detecting _GDBM_H_ or
	  _DBM_IOERR.

Sat Feb 18 07:52:45 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/enc-unicode.rb: don't use 1.9 feature on tools.

Sat Feb 18 02:48:39 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/fileutils.rb: refactored FileUtil methods to use the
	  `define_command` API.  Patch from 7rans <transfire@gmail.com>
	* test/fileutils/test_dryrun.rb: corresponding test refactoring
	* test/fileutils/test_nowrite.rb: ditto
	* test/fileutils/test_verbose.rb: ditto

Fri Feb 17 21:39:36 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: remove dbm.

Fri Feb 17 21:18:39 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: refine header/library mismatch detection.
	  check only for ndbm.h except libc.  check _GDBM_H_ for gdbm.
	  check _DBM_IOERR for the original ndbm.

Fri Feb 17 20:30:44 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: don't check libdbm.  It is not a ndbm
	  implementation.  (libdbm in Version 7 Unix is database library
	  for single database per process.)

Fri Feb 17 15:38:53 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* Merge Onigmo-5.13.1. [ruby-dev:45057] [Feature #5820]
	  https://github.com/k-takata/Onigmo
	  cp reg{comp,enc,error,exec,parse,syntax}.c reg{enc,int,parse}.h
	  cp oniguruma.h
	  cp tool/enc-unicode.rb
	  cp -r enc/

Fri Feb 17 15:20:30 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (enum_each_slice): arrays to be yielded can be newly
	  created in the block.

	* enum.c: move work variables to objects not to let called blocks
	  access stack area out of scope.  [Bug #5801]

Fri Feb 17 12:35:55 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/merger.rb: remove borders from the commit message which is used
	  when the commit doesn't change ChangeLog.

Fri Feb 17 11:50:11 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (btest, btest-ruby, test-sample test-knownbugs)
	  (test-all, test-ruby): depend on prog.

Fri Feb 17 09:56:22 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (create_header): log the content of header.

Fri Feb 17 09:44:55 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/transcode-tblgen.rb (import_ucm): don't use \h because the
	  script should work with ruby 1.8.

	* tool/enc-unicode.rb: ditto.

Fri Feb 17 07:33:29 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* enum.c (id_lshift): use constant ID.

Fri Feb 17 07:30:53 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: refactored to split too long conditions.

Fri Feb 17 00:23:25 2012  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb: fix skip condition for libgdbm 1.8.0 or prior.
	  reported by Bohuslav Kabrda.
	  [ruby-core:42685] [ruby-trunk - Bug #6036]

Fri Feb 17 00:04:21 2012  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: check _DB_H_ macro unavailable except
	  Berkeley DB library.

Thu Feb 16 05:41:35 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (splatarray): make new array if flag is set.

	* compile.c (iseq_compile_each): make new array with
	  splat. [ruby-core:21901][Feature #1125]

Thu Feb 16 00:14:04 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/abbrev.rb (Array#abbrev): add missing '"' in documentation.

Wed Feb 15 22:20:19 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (rb_fiber_reset_root_local_storage): add a new function to
	  restore rb_thread_t::local_storage.

	* cont.c (rb_obj_is_fiber): add a new function to tell finalizer to
	  prevent fibers from destroy.

	* gc.c (rb_objspace_call_finalizer): don't sweep fibers at finalizing
	  objspace.

	* internal.h (rb_fiber_reset_root_local_storage, rb_obj_is_fiber):
	  add prototypes.

	* vm.c (ruby_vm_destruct): reset main thread's local_storage before
	  free main thread. rb_thread_t::local_storage is replaced by fiber's
	  local storage when forked from fiber, and it should be already freed
	  when the fiber was destroyed. [ruby-core:41456] [Bug #5700]

	* test/ruby/test_fiber.rb (test_fork_from_fiber): add test for fork
	  from fiber.

Wed Feb 15 19:57:02 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/fiddle/closure.c (callback): deal with unsigned integers.
	  [ruby-core:42458][Bug #5991][Bug #6022]

	* ext/fiddle/conversions.c (value_to_generic, generic_to_value):
	  ditto.

	* ext/fiddle/closure.c (callback): same as r34506.

Wed Feb 15 17:41:31 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (io_strsetbuf): call rb_str_modify to make str independent
	  before calling rb_str_set_len for r34580.

Wed Feb 15 12:30:10 2012  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c (Init_zlib):  Added Zlib::TEXT and note that
	  Zlib::ASCII is deprecated in zlib 1.2.3 and newer.

Wed Feb 15 12:24:40 2012  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Move constant descriptions to constants.  Remove
	  extra comment block at the top of Init_zlib().

Wed Feb 15 12:30:46 2012  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/ostruct.rb: Create getters and setters after dup.
	  [Bug #6028] [rubyspecs:0380bcc]

Wed Feb 15 10:59:52 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (HEAP_BITMAP_LIMIT): HEAP_BITMAP_LIMIT is computed on the
	  basis of HEAP_SIZE because it must covers a whole heap block.
	  [ruby-trunk - Bug #6006]

Wed Feb 15 09:27:45 2012  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c (Init_zlib):  Added Zlib::FIXED and Zlib::RLE
	  strategies.
	* NEWS:  Add note about the new Zlib constants.

Wed Feb 15 09:11:36 2012  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c:  Improve documentation.  [ruby-trunk - Bug #5948]

Wed Feb 15 07:28:54 2012  Eric Hodel  <drbrain@segment7.net>

	* encoding.c (Init_Encoding):  Add IO example of internal and external
	  encoding.  Fixed a typo in the force_encoding example.  [#5949]

Wed Feb 15 06:58:21 2012  Eric Hodel  <drbrain@segment7.net>

	* encoding.c (Init_Encoding):  Add Encoding documentation.
	  [ruby-trunk - Bug #5949]
	* encoding.c (rb_set_default_external):  Fix typo in documentation.

Tue Feb 14 20:22:11 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (CEILDIV): rename to a appropriate name.

Tue Feb 14 18:07:20 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (assign_heap_slot): SEGV happens cause on 64-bit platform
	  sometime there should be `objs-=2` instead of `objs--`.
	  [Bug #6006]
	  patched by Sokolov Yura. https://github.com/ruby/ruby/pull/92

Tue Feb 14 16:00:30 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_setstrbuf): cut down the buffer if longer.

Tue Feb 14 15:06:37 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (build_message): skip escaped
	  question marks.

Tue Feb 14 12:10:04 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (autoload_const_set, autoload_require): fix
	  signatures.

Tue Feb 14 05:23:40 2012  Eric Hodel  <drbrain@segment7.net>

	* process.c (proc_wait):  Change typo "SystemError" to
	  "SystemCallError".  [ruby-trunk - Bug #5962]
	* process.c (proc_wait2):  ditto

Tue Feb 14 05:18:24 2012  Eric Hodel  <drbrain@segment7.net>

	* enumerator.c:  Document use of Enumerator.new for creating a lazy
	  enumeration for filtering/chaining.  [ruby-trunk - Feature #707]

Mon Feb 13 23:01:50 2012  Akinori MUSHA  <knu@iDaemons.org>

	* vm_method.c (rb_method_boundp):
	  obj.respond_to?(:a_protected_method) should return false because
	  calling a protected method may cause NoMethodError if called
	  from outside the class inheritance tree.  Kernel#respond_to? is
	  mostly used to test if it is safe to call a method, so the false
	  positive should be avoided. [ruby-dev:40461] [ruby-dev:41739]
	  [ruby-dev:41837]

Mon Feb 13 21:52:06 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (HEAP_OBJ_LIMIT, HEAP_BITMAP_LIMIT): HEAP_OBJ_LIMIT used
	  `sizeof(struct heaps_slot)` while heap is currently allocated
	  with `struct heaps_header`.
	  HEAP_BITMAP_LIMIT were calculated from
	  `HEAP_OBJ_LIMIT/sizeof(uintptr_t)` - one Byte for each object,
	  not one Bit. [Bug #6006]
	  patched by Sokolov Yura. https://github.com/ruby/ruby/pull/92

Mon Feb 13 18:30:32 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (io_setstrbuf): defer resizing buffer string until data is
	  read actually.

Mon Feb 13 10:24:39 2012  Loren Segal  <lsegal@soen.ca>

	* io.c (Init_IO): use directive hack to make ARGF documentable
	  in other tools.  [ruby-core:42515][Bug #6007]

Sun Feb 12 20:43:54 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_event_hook_func_t): add argument names.

Sun Feb 12 16:30:23 2012  Akinori MUSHA  <knu@iDaemons.org>

	* tool/merger.rb (#default_merge_branch): Add support for
	  Subversion 1.7 which adopted a whole new working directory
	  structure.

Sun Feb 12 15:14:41 2012  Kazuki Tsujimoto  <kazuki@callcc.net>

	* benchmark/driver.rb: suppress unused/shadowing variable warnings.

Sun Feb 12 03:14:40 2012  Eric Hodel  <drbrain@segment7.net>

	* vm_eval.c (check_funcall):  Call respond_to? with matching arity for
	  legacy single-argument implementations.  [ruby-trunk - Bug #6000]

Sat Feb 11 12:04:05 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* compile.c (defined_expr): guard the whole expression.
	  [ruby-dev:45021][Bug#5786]

Sat Feb 11 08:34:42 2012  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c (rb_inflate_add_dictionary):  Added
	  Zlib::Inflate#add_dictionary to allow users to pre-specify
	  for using during #inflate.  [ruby-trunk - Feature #5937]

Sat Feb 11 08:23:02 2012  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c (do_inflate):  Inflate more data if buffered data
	  exists.  Allows Zlib::Inflate#set_dictionary to work.
	  [ruby-trunk - Bug #5929]

Sat Feb 11 06:00:48 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* dir.c (fnmatch): The * needs to be escaped to avoid formatting in
	  fnmatch comment.
	  patched by @dalton. https://github.com/ruby/ruby/pull/91

Fri Feb 10 03:41:31 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c: removed external encoding setter, allow parser
	  to be reused.
	* ext/psych/lib/psych/parser.rb: added external encoding setter.
	* test/psych/test_parser.rb: test parser reuse

Fri Feb 10 01:30:41 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/dl.h (ALIGN_OF): use offsetof().

	* ext/dl/dl.h (DLALIGN): round up at once and get rid of overflow.

Fri Feb 10 00:47:07 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (assert_no_memory_leak): new assertion to
	  check memory leak by invoking child ruby process and watch its
	  memory size.

Thu Feb  9 23:41:44 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/pathname/test_pathname.rb (test_binread): add assertion to
	  check encoding.

Thu Feb  9 16:48:19 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/dl.c (Init_dl): fix mangled document.

Thu Feb  9 16:10:34 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/memory_status.rb (Memory::Win32): 64bit support.

Thu Feb  9 16:08:55 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/lib/value.rb (DL::ValueUtil.{unsigned_value,signed_value}):
	  currently pack/unpack does not accept "q!" and "Q!".

Thu Feb  9 16:01:29 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/fiddle/conversions.c (value_to_generic): src is not guaranteed as
	  a Bignum if the type is LONG_LONG.  it may be a Fixnum if the value
	  is small.

Thu Feb  9 11:32:36 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/dl/lib/types.rb: Win64 support.

Thu Feb  9 04:12:29 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/pathname/test_pathname.rb: not read but binread.
	  patched by Benoit Daloze, [ruby-core:42440] [Bug #5984]

Wed Feb  8 22:29:59 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (rb_str_modify_expand): fix memory leak.

Wed Feb  8 14:06:59 2012  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c: Add SSL constants and allow to unset SSL
	  option to prevent BEAST attack. See [Bug #5353].

	  In OpenSSL, OP_DONT_INSERT_EMPTY_FRAGMENTS is used to prevent
	  TLS-CBC-IV vulnerability described at
	  http://www.openssl.org/~bodo/tls-cbc.txt
	  It's known issue of TLSv1/SSLv3 but it attracts lots of attention
	  these days as BEAST attack. (CVE-2011-3389)

	  Until now ossl sets OP_ALL at SSLContext allocation and call
	  SSL_CTX_set_options at connection.  SSL_CTX_set_options updates the
	  value by using |= so bits set by OP_ALL cannot be unset afterwards.

	  This commit changes to call SSL_CTX_set_options only 1 time for each
	  SSLContext. It sets the specified value if SSLContext#options= are
	  called and sets OP_ALL if not.

	  To help users to unset bits in OP_ALL, this commit also adds several
	  constant to SSL such as
	  OpenSSL::SSL::OP_DONT_INSERT_EMPTY_FRAGMENTS.  These constants were
	  not exposed in Ruby because there's no way to unset bits in OP_ALL
	  before.

	  Following is an example to enable 0/n split for BEAST prevention.

	    ctx.options = OP_ALL & ~OP_DONT_INSERT_EMPTY_FRAGMENTS

	* test/openssl/test_ssl.rb: Test above option exists.

Wed Feb 8 13:12:02 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_x509name.c: Use the numerical representation of
	  unrecognized OIDs instead of the sn "UNDEF".

	* test/openssl/test_x509name.rb: Add tests for the fixed behavior.

	  Patch provided by Paul Kehrer, thank you!
	  [ruby-core:41769] [Feature #5787]

Wed Feb  8 09:49:58 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/merger.rb: don't abort, update first.

Wed Feb 8 09:47:33 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: Call INT2NUM only once for GeneralString.
	  Thanks to Mantas Mikulenas for noticing and providing a patch!
	  [ruby-core:42358] [Bug #5972]

Wed Feb 8 09:19:00 2012  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_cipher.c: Add warning about key as IV.

Tue Feb  7 20:08:12 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* error.c (exc_inspect): Fix typo. patch from Trent Ogren
	  via https://github.com/ruby/ruby/pull/90

Tue Feb  7 19:37:35 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c: refactor packed entries using structs.

Tue Feb  7 14:52:10 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_update): table can be unpacked in the callback.

	* st.c (st_foreach): should not yield same pair when checking
	  after unpacking.

Mon Feb  6 21:55:13 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* tool/merger.rb: abort if the working directory is dirty.

	* tool/merger.rb: update the working directory after commit.

Mon Feb  6 00:16:27 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): return ASCII-8BIT even if 2nd string
	  is ascii only string. [ruby-core:42354] [Bug #5968]

Fri Feb  3 07:16:47 2012  Eric Hodel  <drbrain@segment7.net>

	* lib/webrick.rb:  Moved proxy rewriting to WEBrick::HTTPProxy.
	* lib/webrick/httpproxy.rb:  Add examples of creating a proxy server
	  and response rewriting using HTTPProxy.

Fri Feb  3 06:53:22 2012  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_x509store.c:  Add class documentation for
	  OpenSSL::X509::Store

Thu Feb  2 22:28:13 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/net/http/test_https_proxy.rb
	  (HTTPSProxyTest#test_https_proxy_authentication):
	  add workaround to avoid to hang up without openssl.
	  see [ruby-dev:45021][Bug #5786]

	* test/resolv/test_dns.rb (TestResolvDNS#test_query_ipv4_address):
	  ditto.

Thu Feb  2 21:48:18 2012  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/parsers/baseparser.rb: use meaningful names.

Thu Feb  2 21:38:52 2012  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/parsers/baseparser.rb, test/rexml/test_namespace.rb:
	  fix the default xml namespace URI validation.
	  [ruby-dev:45169] [Bug #5956]
	  Reported by Miho Hiramatsu. Thanks!!!

Thu Feb  2 17:51:02 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (argf_next_argv): reset ARGF.next_p on ARGV.replace.
	  r34409 breaks replacing ARGV.
	  [ruby-dev:45160] [Bug #5952]

Thu Feb  2 16:21:01 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/net/http/test_http.rb (TestNetHTTPKeepAlive#*): remove debug
	  output.

Thu Feb  2 01:24:34 2012  Yusuke Endoh  <mame@tsg.ne.jp>

	* parse.y (debug_lines, coverage): set file path encoding for coverage
	  result.  [ruby-dev:44950]

Wed Feb  1 14:38:31 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/tempfile.rb (Tempfile#unlink, Tempfile::Remover#call): Just
	  call File.unlink and ignore ENOENT because existence check
	  before unlinking does not help in terms of race condition.

	* lib/tempfile.rb (Tempfile#unlink, Tempfile::Remover#call): My
	  comment about thread safeness is obsolete.

Wed Feb  1 09:50:10 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* doc/re.rdoc (Repetition): fix typo.  reported by Ori Avtalion
	  and patched by Zachary Scott.  [Bug #5947]

Wed Feb  1 06:38:54 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_close): skip stdin, which should be readable again.
	  [ruby-dev:45160] [Bug #5952]

	* io.c (argf_readlines): reinitialize after all read to be
	  readable again.

Tue Jan 31 21:27:43 2012  Narihiro Nakamura  <authornari@gmail.com>

	* configure.in (HEAP_ALIGN_LOG): HEAP_ALIGN_LOG should be page
	  size in OpenBSD. [ruby-core:42158][Bug #5901]

	* gc.c : avoid to redefine.

Tue Jan 31 14:27:22 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/envutil.rb (EnvUtil.invoke_ruby): yield also child pid
	  in block form.

Mon Jan 30 19:08:19 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (vm_call0): should pass block to enumerators.  patched
	  by Kazuki Tsujimoto.  [ruby-dev:44961][Bug #5731]

	* vm_eval.c (method_missing), vm_insnhelper.c (vm_call_method):
	  ditto.  patched by satoshi shiba.

Mon Jan 30 12:31:05 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* file.c (append_fspath): need to set the encoding to result always.

Mon Jan 30 10:38:37 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/irb/test_completion.rb: skip if cannot load irb/completion
	  (maybe readline does not exist).

Sun Jan 29 22:47:19 2012  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* tool/config.{guess,sub}: updated to automake-1.11.2.

Sun Jan 29 12:17:56 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  respect encodings.  [Bug #5941]

Sat Jan 28 09:33:33 2012  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* win32/win32.c (rb_w32_read): fix an issue that $stdin.read doesn't
	  terminate by CTRL-C on Windows.
	  [ruby-dev:45149] [Bug #5812]

Sat Jan 28 08:18:11 2012  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/ruby/test_thread.rb
	  (TestThreadGroup#test_thread_timer_and_interrupt): skip exit status
	  assertion because we cannot get signal status on Windows.

	* win32/win32.c (CreateChild): create process group to receive the
	  signal by GenerateConsoleCtrlEvent().

	* win32/win32.c (kill): use CTRL_BREAK_EVENT instead of CTRL_C_EVENT
	  if a process group is specified. CTRL_C_EVENT signal cannot be
	  generated for process groups for the specification.
	  [ruby-dev:45149] [Bug #5812]

Sat Jan 28 07:46:03 2012  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* thread_win32.c (rb_w32_wait_events_blocking): use
	  ruby_thread_from_native() instead of GET_THREAD() because
	  GET_THREAD() doesn't always return the current thread and
	  WaitForMultipleObjects() at rb_w32_read() doesn't return by
	  Thread#kill. This fixes TestQueue#test_thr_kill failure on
	  Windows.

	* thread_win32.c (rb_w32_wait_events): use ruby_thread_from_native()
	  instead of GET_THREAD() for consistency with the above change.

	* thread_win32.c (rb_w32_sleep): ditto.

	* thread_win32.c (rb_w32_Sleep): ditto.
	  [ruby-dev:45149] [Bug #5812]

Sat Jan 28 07:28:48 2012  Hiroshi Shirosaki  <h.shirosaki@gmail.com>

	* test/zlib/test_zlib.rb (TestZlibGzipReader#test_reader_wrap): set
	  binmode explicitly for fixing test error on Windows. This is consistent
	  with r34243.
	  [ruby-dev:45149] [Bug #5812]

Sat Jan 28 05:53:34 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/irb/completion.rb (IRB::InputCompletor::CompletionProc):
	  ignore non-string name modules.  [ruby-core:42244][Bug #5938]

Fri Jan 27 16:31:45 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (HEAP_ALIGN, HEAP_ALIGN_MASK): DRY, let compiler calculate
	  from HEAP_ALIGN_LOG.

Thu Jan 26 11:03:37 2012  Eric Hodel  <drbrain@segment7.net>

	* lib/matrix.rb:  Clean up extra whitespace in output documentation.

Thu Jan 26 03:24:02 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (io_getch): default delegating method
	  for StringIO.  https://github.com/nobu/io-console/issues/4

	* ext/stringio/stringio.c: moved some methods to hidden modules.

Wed Jan 25 13:27:42 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_s_basename): ignore non-ascii extension in
	  different encoding, which cannot match.

	* file.c (rmext): no extension to strip if empty string.

	* file.c (rb_enc_path_next, rb_enc_path_skip_prefix)
	  (rb_enc_path_last_separator, rb_enc_path_end)
	  (ruby_enc_find_basename, ruby_enc_find_extname): encoding-aware
	  path handling functions.

	* file.c (rb_home_dir, file_expand_path, rb_realpath_internal)
	  (rb_file_s_basename, rb_file_dirname, rb_file_s_extname)
	  (rb_file_join): should respect the encodings of arguments than
	  file system encoding.  [ruby-dev:45145] [Bug #5919]

	* dir.c (check_dirname, ruby_glob0): ditto.

	* ext/pathname/pathname.c (path_sub_ext): ditto.

Tue Jan 24 14:20:42 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (rb_iter_break_value): new function to break a block with
	  the value.  [ruby-dev:45132] [Feature #5895]

Tue Jan 24 12:58:41 2012  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* object.c (rb_Hash): add Kernel#Hash conversion method like
	  Array() or Float().  a patch from Run Paint Run Run.  Fix #3131

Tue Jan 24 11:38:05 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI.encode_www_form_component): initialize on
	  requiring to support JRuby, which runs parallel multithreads.
	  [ruby-core:42222] [Bug #5925]

	* lib/uri/common.rb (URI.decode_www_form_component): initialize on

Mon Jan 23 20:33:11 2012  Jason Kay  <geniture@me.com>

	* lib/net/http.rb (Net::HTTP#connect): Writing entire packet at
	  once to avoid incomplete transmission.  Current code using
	  writeline was causing sub-optimal conversing with a proxy due to
	  the connect tunnel request headers being split over multiple
	  packets. The modification I made allows the connect request to
	  be written as one packet, avoiding problems and optimizing the
	  conversation.

	  https://github.com/ruby/ruby/pull/72
	  [Feature #5460]

Mon Jan 23 17:06:17 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/mailto.rb (URI::MailTo.build): follow Array#to_s change of
	  Ruby 1.9; use Array#join. [Bug #5840]

Mon Jan 23 16:42:28 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (extract_binmode): raise an exception if binmode/textmode
	  is specified with both vmode and opthash.
	  [ruby-core:42199] [Bug #5918]

Mon Jan 23 16:35:27 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_extract_modeenc): set ASCII-8BIT if binmode is specified
	  with opthash. [ruby-core:42197] [Bug #5917]

Mon Jan 23 10:08:00 2012  Kenta Murata  <mrkn@cookpad.com>

	* test/cgi/test_cgi_util.rb (test_cgi_escape_preserve_encoding):
	  add a test for CGI::escape to preserve encoding.

	* test/cgi/test_cgi_util.rb (test_cgi_unescape_preserve_encoding):
	  add a test for CGI::unescape to preserve encoding.

Mon Jan 23 00:45:34 2012  Akinori MUSHA  <knu@iDaemons.org>

	* misc/rdoc-mode.el (rdoc-imenu-create-index): Add imenu support
	  to rdoc-mode.

	* misc/rdoc-mode.el (rdoc-mode): Fix regexp patterns containing
	  "\s " where CR/LF is not supposed to match.

Sun Jan 22 15:41:26 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_intern3): split to registration check and new
	  registration.

	* parse.y (rb_intern_str): make interned string shared with the
	  given string.

	* parse.y (rb_intern3, rb_intern_str): check the coderange first.

Sat Jan 21 22:21:07 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (FIXNUM_P): simple flag should be int.

Sat Jan 21 21:51:19 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (rb_enc_compatible): fix segv on symbols.
	  [ruby-core:42204] [Bug #5921]

Sat Jan 21 11:43:45 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* dir.c (dir_chdir, check_dirname): get rid of optimization-out.

Fri Jan 20 20:47:37 2012  Kenta Murata  <mrkn@cookpad.com>

	* lib/cgi/util.rb (CGI.escape): support a string with invalid byte
	  sequence.  [Bug #5913]

	* test/cgi/test_cgi_util.rb
	  (test_cgi_escape_with_invalid_byte_sequence): test for the above
	  change.

Fri Jan 20 17:37:37 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm.c (vm_exec): remove workaround for LLVM because r34278 fixes it.

	* vm_insnhelper.c (vm_call_cfunc): ditto.

Fri Jan 20 14:31:43 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP#transport_request): retry a idempotent
	  request automatically. [ruby-dev:45030] [Bug #5790]
	  [ruby-core:41821] [Bug #5813]

	* lib/net/http.rb (Net::HTTP#keep_alive_timeout=): added to specify
	  the second to reconnect the TCP connection on Keep-Alive.
	  The default value is 2 second because current servers uses 2 sec.
	  http://ftp-admin.blogspot.com/2009/09/keepalivetimeout2.html

	* lib/net/http.rb (Net::HTTP#begin_transport): reconnect TCP
	  connection on keep-alive timeout.

Thu Jan 19 07:53:09 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_strptime.c: moved detector of leftover.

Thu Jan 19 07:10:47 2012  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_parse.c: [ruby-core:42173].

Wed Jan 18 18:11:02 2012  Akinori MUSHA  <knu@iDaemons.org>

	* misc/rdoc-mode.el (rdoc-mode): Add provide so that requiring
	  this library succeeds.

Wed Jan 18 18:06:45 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/curses/curses.c (cWindow, cMouseEvent): made typed data.

Wed Jan 18 12:49:15 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Added support for loading
	  subclasses of String with ivars
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Added support for dumping
	  subclasses of String with ivars
	* test/psych/test_string.rb: corresponding tests

Wed Jan 18 10:39:47 2012  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Added ability to load array
	  subclasses with ivars.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Added ability to dump
	  array subclasses with ivars.
	* test/psych/test_array.rb: corresponding tests

Tue Jan 17 17:18:41 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (SPT_TYPE): enable as SPT_REUSEARGV on Darwin.

	* missing/setproctitle.c (ruby_init_setproctitle): changed prefix.

Tue Jan 17 12:32:46 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (aligned_malloc, aligned_free): covered missing defined
	  operators and fixes for cygwin.

Tue Jan 17 10:54:46 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (do_hash): it's the time to remove cast to unsigned int.

Tue Jan 17 07:30:12 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* st.c (unpack_entries): Fix r34310: on unpacking, the position of
	  a hash must be do_hash-ed value.

	* st.c (add_packed_direct): ditto.

Mon Jan 16 16:41:53 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/optparse.rb (Regexp): fix incorrect options when casting to
	  a Regexp, and suppress encoding option warnings.
	  https://github.com/ruby/ruby/pull/82

Mon Jan 16 11:22:38 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (rb_chsize): no need to get the current file size.

Mon Jan 16 00:41:33 2012  Sokolov Yura  <funny.falcon@gmail.com>

	* st.c: st use function instead of macro.  In my current
	  environment (Ubuntu 11.04 32bit gcc-4.5.2) it gives 4%
	  performance improvement.

	  https://github.com/ruby/ruby/pull/77

Sun Jan 15 14:09:48 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* object.c (rb_inspect): raise the result is not compatible with
	  the default external encoding. [ruby-core:42095] [Bug #5848]
	  If the default external encoding is ASCII compatible, the encoding of
	  inspected result must be compatible with it.
	  If the default external encoding is ASCII incompatible,
	  the result must be ASCII only.

Sun Jan 15 13:21:50 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json/parser/parser.rl (json_string_unescape): workaround fix
	  for over optimization of GCC 4.7. [ruby-core:42085] [Bug #5888]
	  http://gcc.gnu.org/bugzilla/show_bug.cgi?id=51862

Sat Jan 14 22:24:09 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/callback/mkcallback.rb (gencallback): suppress unused
	  variables.

Sat Jan 14 21:56:43 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* iseq.c (iseq_data_to_ary): check line info table boundary.  line
	  number 0 means no line number info is needed.  [ruby-dev:45130]
	  [Bug #5894]

Sat Jan 14 18:24:13 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* error.c (exc_equal): clear rb_thread_t::errinfo when ignore
	  an exception under rb_protect(). [ruby-core:41979] [Bug #5865]

Sat Jan 14 12:02:55 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_enc_vsprintf): relaxed the restriction.  since the
	  implementation deeply depends on plain char, so wchar_t based
	  encodings are not supported.

Sat Jan 14 12:00:20 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (exc_equal): ignore exceptions during implicit
	  conversion.  [ruby-core:41979] [Bug #5865]

Sat Jan 14 05:58:54 2012  Eric Hodel  <drbrain@segment7.net>

	* io.c (rb_io_s_read):  Fix formatting of open_args comment.  Reported
	  by Adam Prescott.

Fri Jan 13 18:41:19 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* sprintf.c (rb_enc_vsprintf): can be used for ASCII compatible
	  encodings only.

Fri Jan 13 18:29:06 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_mutex_unlock_th): simplified.

	* thread.c (rb_barrier_waiting): fix potential overflows.

Fri Jan 13 17:23:38 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_unlock): update loading table at once.

Fri Jan 13 16:44:45 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (exc_equal): try implicit conversion for delegator.
	  [ruby-core:41979] [Bug #5865]

Fri Jan 13 03:46:53 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/shellwords.rb (Shellwords#shellescape): shellescape() now
	  stringifies the given object using to_s.

	* lib/shellwords.rb (Shellwords#shelljoin): shelljoin() accepts
	  non-string objects in the given array, each of which is
	  stringified using to_s.

	* lib/shellwords.rb: Fix rdoc markups.

Fri Jan 13 03:38:36 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/shellwords.rb (Shellwords#shellsplit): Fix a bug where
	  consecutive backslashes in double quotes are all removed except
	  the one at the tail.

Fri Jan 13 03:28:00 2012  Luis Lavena  <luislavena@gmail.com>

	* ext/socket/extconf.rb (if ipv6): only define _WIN32_WINNT if was not
	  previously defined. This solve warnings with multiple defines in
	  command line with GCC 4.6.1

Thu Jan 12 18:44:31 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb: fix r33904 and revert r33905.  initialize global
	  variables with init_mkmf before initializing constants.
	  [ruby-dev:45124] [Bug #5879]

Thu Jan 12 13:51:00 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (cont_restore_0): prevent optimizing out `sp'. sp is used for
	  reserving a memory space with ALLOCA_N for restoring machine stack
	  stored in cont->machine_stack, but clang optimized out it (and
	  maybe #5851 is also caused by this).
	  This affected TestContinuation#test_check_localvars.

	* cont.c (cont_restore_1): revert workaround introduced in r32201.

Thu Jan 12 02:14:43 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* object.c: Added examples for Object#is_a? and
	  Object#instance_of? patched from Manoj Kumar.
	  [Bug #5880] [ruby-core:42057]

Thu Jan 12 00:57:48 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/mkmf.rb: verbose-mode can use by RM, RMDIRS, etc.
	  (e.g. make V=1 realclean)

Wed Jan 11 23:40:21 2012  Naohisa Goto  <ngoto@gen-info.osaka-u.ac.jp>

	* string.c (rb_str_concat): set array element after definition
	  to fix compile error with Fujitsu C Compiler 5.6 on Solaris 10
	  on Sparc.  [Bug #5878] [ruby-dev:45123]

Wed Jan 11 22:52:51 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (ruby_mimmalloc): don't set allocated size to header.
	  ruby_mimmalloc() doesn't increment allocated_size/allocations and
	  decrement them in ruby_xfree() cause inconsistency.

	* gc.c (ruby_xfree): don't decrement allocated_size/allocations if
	  allocated size record is 0.

Wed Jan 11 22:36:43 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/readline/test_readline.rb (test_completion_proc_empty_result):
	  ensure clearance of Readline's line_buffer after the test.

Tue Jan 10 21:57:38 2012  Hiroshi Shirosaki <h.shirosaki@gmail.com>

	* ext/dbm/dbm.c (Init_dbm): fix a build error on mswin32.
	  use `extern __declspec(dllimport)` for dll link with VC.
	  [ruby-core:41996] [Bug #5869]

Tue Jan 10 15:31:55 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm.c (vm_exec): refix r34162; suppress warning and add description.

Tue Jan 10 15:13:58 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  use rb_memerror().

Tue Jan 10 12:49:42 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c: in fact, i686-linux doesn't need to define _XOPEN_SOURCE 600.

Tue Jan 10 12:44:11 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (ruby_mimmalloc): defined for objects need not rb_objspace,
	  but should return pointer suitable for ruby_xfree;
	  main vm and main thread.
	  patched by Sokolov Yura. https://github.com/ruby/ruby/pull/79

	* internal.h: ditto.

	* vm.c (Init_BareVM): use ruby_mimmalloc.

	* ext/dl/cfunc.c: #include <ruby/util.h>.

	* ext/syslog/syslog.c: use xfree because it is allocated by
	  ruby_strdup.

Tue Jan 10 12:13:56 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  fix compile error.

Tue Jan 10 10:41:11 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  empty completion result does not mean memory error.

Tue Jan 10 02:19:22 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/test_io.rb (test_autoclose_true_closed_by_finalizer,
	  test_autoclose_true_closed_by_finalizer): skip if IO objects are
	  not recycled yet. [ruby-dev:45098] [Bug #5850]

Tue Jan 10 00:41:28 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/tempfile.rb (Tempfile#_close): clear @tempfile and @data[1] even
	  when exception is raised at @tempfile.close. [ruby-dev:45113]

	* lib/tempfile.rb (Tempfile#unlink): fix a typo.

Tue Jan 10 00:32:17 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (run_finalizer): clear rb_thread_t::errinfo when ignore
	  an exception under rb_protect(). [ruby-dev:45113]

Mon Jan  9 23:37:43 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  fix typos.

Mon Jan  9 20:55:34 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c : don't embed struct heaps_slot to a heap block because it
	  can causes copy-on-write of memory page on heap block when its
	  free_next is rewritten.

Mon Jan  9 20:26:33 2012  Tanaka Akira  <akr@fsij.org>

	* ext/pathname/pathname.c (path_entries): add document suggested by
	  the thread [ruby-core:41959] [Bug #5859].

Mon Jan  9 20:14:13 2012  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (family_addrinfo): don't require protocol
	  equality.  For example, protocol 0 and IPPROTO_TCP is not problem
	  for TCP.

Mon Jan  9 20:08:52 2012  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (family_addrinfo): return the given
	  addrinfo object.
	  Patch by Ippei Obayashi.  [ruby-dev:45095] [Bug #5845]

Mon Jan  9 19:40:20 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/zlib/test_zlib.rb (TestZlibGzipWriter#test_writer_wrap): set
	  binmode explicitly.

Mon Jan  9 14:42:41 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: free_slots is changed Singly linked list. clear
	  free_slots before sweep.

Mon Jan  9 07:46:17 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c: i686-linux needs to define _XOPEN_SOURCE 600 for posix_memalign.

Mon Jan  9 04:24:59 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (rb_objspace_free): global_List is allocated with xmalloc.
	  patched by Sokolov Yura.  https://github.com/ruby/ruby/pull/78

	* dln_find.c: remove useless replacement of free.

	* ext/readline/readline.c (readline_attempted_completion_function):
	  strings for readline must allocated with malloc.

	* process.c (run_exec_dup2): use free; see also r20950.

	* re.c (onig_new_with_source): use malloc for oniguruma.

	* vm.c (ruby_vm_destruct): use free for VMs.

	* vm.c (thread_free): use free for threads.

Mon Jan  9 04:24:59 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* dln_find.c: remove useless replacement of free.

	* ext/readline/readline.c (filename_completion_proc_call):
	  matches should use xfree.

	* ext/readline/readline.c (username_completion_proc_call): ditto.

Mon Jan  9 01:12:35 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (rb_enc_uint_char): raise RangeError when added codepoint
	  is invalid. [Feature #5855] [Bug #5863] [Bug #5864]

	* string.c (rb_str_concat): ditto.

	* string.c (rb_str_concat): set encoding as ASCII-8BIT when the string
	  is US-ASCII and the argument is an integer greater than 127.

	* regenc.c (onigenc_mb2_code_to_mbclen): rearrange error code.

	* enc/euc_jp.c (code_to_mbclen): ditto.

	* enc/shift_jis.c (code_to_mbclen): ditto.

Sun Jan  8 20:31:45 2012  Narihiro Nakamura  <narihiro@netlab.jp>

	* gc.c : consider header bytes which are used by malloc.

Sun Jan  8 11:54:43 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (aligned_free): support MinGW. Patch by Hiroshi Shirosaki.

Sun Jan  8 11:43:05 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (slot_sweep): add a assertion instead of a debug print.

Sun Jan  8 01:18:19 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/-ext-/old_thread_select/test_old_thread_select.rb:
	  avoid platform bug. [Bug #5858] [ruby-dev:45108]

Sun Jan  8 00:46:34 2012  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* gc.c: get rid of implicit narrowing conversion.

Sun Jan  8 00:10:10 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in: check posix_memalign(3) and memalign(3).

	* gc.c (aligned_malloc): use configure's result instead of
	  _POSIX_C_SOURCE and _XOPEN_SOURCE because they can't be used
	  to check availability at least on FreeBSD.

Sat Jan  7 22:25:50 2012  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c: use Bitmap Marking algorithm to avoid copy-on-write of
	  memory pages. See [ruby-dev:45085] [Feature #5839]
	  [ruby-core:41916].

	* include/ruby/ruby.h : FL_MARK rename to FL_RESERVED1.

	* node.h : ditto.

	* debug.c : ditto.

	* object.c (rb_obj_clone): FL_MARK move to a bitmap.

	* class.c (rb_singleton_class_clone): ditto.

Sat Jan  7 00:47:07 2012  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* configure.in: always define CANONICALIZATION_FOR_MATHN.
	  [ruby-dev:45100] [Bug #5852]

Fri Jan  6 23:11:20 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* include/ruby/version.h: RUBY_API_VERSION 2.0.0

Fri Jan  6 12:24:11 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* object.c (rb_inspect): raises Encoding::CompatibilityError if the
	  result is incompatible with the default external encoding.
	  [ruby-core:41931] [Bug #5848]

Thu Jan  5 15:26:15 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (check_valid_dir): strict checking of root.
	  GetDriveType() succeeds with non root directory as the argument,
	  even if MSDN says that the API needs the root directory.
	  this patch fixes a failure of test/ruby/test_file_exhaustive.rb.

Thu Jan  5 12:15:55 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (rb_file_join): separator is appended by array length - 1
	  times. patched by Benoit Daloze [ruby-core:41901] [Bug #5841]

Thu Jan  5 11:47:54 2012  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/common.rb (URI::Parser#initialize_regexp):
	  use \A \z instead of ^ $. [Bug #5843]

Wed Jan  4 17:55:53 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* array.c (rb_ary_sample): add example for Array#sample
	  based on patch from https://github.com/ruby/ruby/pull/74

Wed Jan  4 14:24:33 2012  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* string.c (str_nth_len): count ascii-only run at the end.  this
	  bug appears only when single-byte-optimization is disabled due
	  to unknown coderange.  [ruby-core:41896] [Bug #5836]

Wed Jan  4 11:32:07 2012  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (check_valid_dir): special case for a root directory.
	  Reported by Masateru OKAMOTO at [Bug #5819].

Wed Jan  4 00:19:54 2012  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/parsers/baseparser.rb: use private instead of _xxx
	  method name. This is Ruby code not Python code.
	  refs #5696

Tue Jan  3 23:57:37 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/rexml/parsers/baseparser.rb: rexml BaseParser uses
	  instance_eval unnecessarily on listener add.
	  patch from Charles Nutter. [Bug #5696] [ruby-core:41437]

Tue Jan  3 20:44:13 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* README: add comment for Git user. patch from Arun Agrawal.
	* README.ja: ditto.

Tue Jan  3 15:58:22 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* thread.c: changed documentation for "thread-local" variables.
	  patch from Julien Ammous.

Tue Jan  3 15:50:12 2012  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* process.c: Fix typo. patch from Aviv Ben-Yosef.

Tue Jan  3 13:43:37 2012  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* tool/merger.rb: allow r0123 style revision number.

Tue Jan  3 11:17:55 2012  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* tool/merger.rb (#version_up): version.h date should be Japanese
	  locale date.

Mon Jan  2 22:08:00 2012  Akinori MUSHA  <knu@iDaemons.org>

	* tool/file2lastrev.rb (VCS::detect): Add support for Subversion
	  1.7 which adopted a whole new working directory structure.

	* tool/file2lastrev.rb (VCS::detect): Simply use .each instead of
	  .sort.reverse_each which looks too arbitrary.  If you want SVN
	  to be tried first, then you just have to register it first as it
	  is right now.

Mon Jan  2 20:53:36 2012  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb (random_bytes): use IO#read instead of
	  IO#readpartial to make the intent more clear.

Mon Jan  2 15:26:39 2012  Kazuki Tsujimoto  <kazuki@callcc.net>

	* test/ruby/test_object.rb (test_send_with_block): add a normal case.

Mon Jan  2 15:18:54 2012  Kazuki Tsujimoto  <kazuki@callcc.net>

	* test/ruby/test_object.rb (test_send_with_block): moved from
	  bootstraptest/test_flow.rb.

Mon Jan  2 15:10:11 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/test/unit/parallel.rb: use pack("m0") instead of
	  pack("m").gsub("\n","").
	* lib/test/unit.rb (Test::Unit::Runner::Worker#run): ditto.

Mon Jan  2 15:05:09 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/test/unit.rb (Test::Unit::Runner::Worker#run): use
	  File.basename with suffix instead of gsub.

Mon Jan  2 14:55:28 2012  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* lib/test/unit.rb (Test::Unit::Runner#_run_parallel): find may
	  return nil and nil can not dup.

Sun Jan  1 12:23:10 2012  Akinori MUSHA  <knu@iDaemons.org>

	* lib/shellwords.rb (Shellwords#shellescape): Drop the //n flag
	  that only causes warnings with no real effect.  [Bug #5637]

Sat Dec 31 06:28:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread.c (rb_barrier_waiting): save the number of waiting threads
	  in RBASIC()->flags. [ruby-dev:45002] [Bug #5768]

	* thread.c (rb_barrier_wait): increment and decrement around
	  rb_mutex_lock, and use rb_barrier_waiting().

	* thread.c (rb_barrier_release): use rb_barrier_waiting().

	* thread.c (rb_barrier_destroy): ditto.

Mon Dec 26 17:20:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm.c (vm_exec): add guard to prevent optimization for LLVM clang.

Fri Dec 30 17:01:12 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* vm_eval.c (rb_f_send): fix obj.send() documentation issue.
	 [Bug #5125] [ruby-core:38633]

Thu Dec 29 22:36:16 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/test/unit.rb (Test::Unit::Runner::Worker#_run_parallels): fix
	  premature exit when all workers' status are :ready or :prepare.
	  [ruby-dev:45061] [Bug #5822]

Thu Dec 29 01:51:13 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* include/ruby/ruby.h: fix #error pragma. LLP64 platform is supported.

	* include/ruby/st.h: ditto.

Wed Dec 28 11:22:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/fileutils.rb (FileUtils::Entry_#entries): use utility method
	  instead of typoed regexp.  [ruby-core:41829] [Bug #5817]

Wed Dec 28 02:08:04 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* vm_insnhelper.c (unknown_keyword_error): add GC guard to prevent
	  intermediate object from GC.

Tue Dec 27 22:34:54 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb (Worker#close): "closing IO if IO is closed"
	  should be "closing IO if IO isn't closed"

Tue Dec 27 22:04:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* st.c (st_update): new function to lookup the given key and
	  update the value.  [ruby-dev:44998]

Tue Dec 27 21:17:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* node.h (rb_args_info): change pre_args_num and post_args_num as
	  int, to match with rb_iseq_t.

	* parse.y (new_args_gen): check overflow.

Mon Dec 26 22:38:35 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_insnhelper.c (unknown_keyword_error): make it kind a error
	  message when unknown keyword is given.  It require more work.
	  See [ruby-core:40518] and [ruby-core:40541] in detail.

Mon Dec 26 22:31:07 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_core.h (struct rb_iseq_struct), compile.c (iseq_set_arguments),
	  iseq.c (rb_iseq_parameters), vm_insnhelper.c
	  (vm_callee_setup_arg_complex): support Method#parameters for keyword
	  arguments.  The provisional spec is what Benoit Daloze proposed.
	  [ruby-core:40541]

	* test/ruby/test_keyword.rb: add a test for above.

Mon Dec 26 22:15:27 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* vm_core.h (struct rb_iseq_struct), compile.c (iseq_set_arguments,
	  iseq_compile_each), vm_insnhelper.c (vm_callee_setup_arg_complex):
	  implement keyword arguments.  See [ruby-core:40290]
	  The feature is promised to be included in 2.0, but the detail spec
	  is still under discussion; this commit is a springboard for further
	  discussion.  Please try it and give us feedback.
	  This commit includes fixes for some problems reported by Benoit
	  Daloze <eregontp AT gmail.com> [ruby-core:40518] and Marc-Andre
	  Lafortune <ruby-core-mailing-list AT marc-andre.ca>
	  [ruby-core:41772].

	* iseq.c (iseq_free, prepare_iseq_build): bookkeeping.

	* test/ruby/test_keyword.rb: add tests for keyword arguments.

	* test/ripper/dummyparser.rb (class DummyParser): temporal fix for
	  ripper test.

Mon Dec 26 22:00:17 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* node.h, node.c, parse.y: implement a parser part for keyword
	  arguments.
	  This is a preparation for keyword argument (see [ruby-core:40290]).

	* gc.c (gc_mark_children): bookkeeping.

Mon Dec 26 21:03:18 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* node.h, parse.y (new_args_gen), compile.c (iseq_set_arguments): use
	  struct rb_args_info instead of NODEs.
	  This is a preparation for keyword argument (see [ruby-core:40290]).

	* node.c (dump_node), gc.c (gc_mark_children, obj_free): bookkeeping.

Mon Dec 26 20:59:51 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* node.h, parse.y (lambda, f_larglist): remove NEW_LAMBDA hack.
	  This is a preparation for keyword argument (see [ruby-core:40290]).

Mon Dec 26 22:01:19 2011  Hiroshi Shirosaki <h.shirosaki@gmail.com>

	* io.c (rb_sys_fail_path): move the definition.
	  Move above for using it in set_binary_mode_with_seek_cur().

	* io.c (set_binary_mode_with_seek_cur): fix improper seek cursor.
	  Seeking file cursor with setting binary mode has possibility to
	  cause infinite loop. Fixed the bug and refined error handling.
	  Introduced at r34043.

	  And cleanups as below.
	  Remove unnecessary parentheses of `fptr`.
	  Use return value of setmode().

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_seek_with_setting_binmode): add a test for above.
	  [ruby-core:41671] [Bug #5714]

Mon Dec 26 17:01:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* common.mk (LIBRUBY_A): depends on main.o since r33774.
	  [ruby-core:41786] [Bug #5796]

Mon Dec 26 13:07:08 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io.rb (TestIO#test_autoclose): Tempfile.new doesn't
	  accept the block argument.

Mon Dec 26 13:06:52 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb: Avoid zombie processes on "--separate" option
	  added at r34121.

Mon Dec 26 04:01:23 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_cipher.c: Update and complete documentation.

Sun Dec 25 23:16:11 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb (test_separate): Test for "--separate"
	  option (r34121)

Sun Dec 25 22:39:49 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb (_run_parallel):
	  New option "--separate" for test/unit; when running tests with this
	  option, a job process will be restarted after one test file has done.
	  This means all test files will run with separated process.

	* lib/test/unit/parallel.rb: Fix for above. Now parallel.rb puts
	  "ready!" for first ready, "ready" for afters.

Sun Dec 25 00:02:15 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: change --with-ntver to --with-winnt-ver to be more
	  descriptive in the context. [ruby-core:41794]

Sat Dec 24 23:25:15 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: add --with-ntver option to match win32/configure.bat
	  functionality. Set 0x0501 as default. [ruby-core:35010]
	  [ruby-core:35035]

Sat Dec 24 12:38:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* proc.c (proc_call): get rid of optimization-out by clang.

	* proc.c (rb_proc_call, rb_proc_call_with_block): ditto.

Sat Dec 24 10:56:32 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/readline/readline.c (readline_readline): check if outstream
	  is closed to get rid of a bug of readline 6.  [ruby-dev:45043]
	  [Bug #5803]

Sat Dec 24 06:59:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/readline/test_readline.rb (test_line_buffer__point): use
	  lambda not to exit entire method by "return".  or "next" for
	  proc.  [ruby-dev:45042] [Bug #5802]

Sat Dec 24 01:20:39 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm_eval.c (send_internal): PASS_PASSED_BLOCK_TH must be placed
	  just before calling rb_call0.

	* bootstraptest/test_flow.rb: add a test for above.

Sat Dec 24 00:55:16 2011  Tanaka Akira  <akr@fsij.org>

	* lib/tempfile.rb (Tempfile#initialize): warn if a block is given.

Fri Dec 23 16:14:30 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (readline_attempted_completion_function):
	  in Readline module with GNU Readline 6 case, Readline module
	  resets completion_append_character to " ", after it executes
	  completion. So, Readline module stores
	  completion_append_character, and Readline module always sets it
	  after Readline module executes completion. [ruby-dev:43456]
	  [Feature #4635]

Fri Dec 23 15:59:05 2011  TAKAO Kouji  <kouji@takao7.net>

	* ext/readline/readline.c (Init_readline): libedit check
	  rl_getc_function only when rl_initialize() is called, and
	  using_history() call rl_initialize(). This assignment should be
	  placed before using_history(). [ruby-core:40641] [Bug #5539]

Fri Dec 23 10:14:47 2011  Tanaka Akira  <akr@fsij.org>

	* test/thread/test_queue.rb (test_thr_kill): show the number of loop
	  run when the test failed.

Fri Dec 23 09:23:48 2011  Tanaka Akira  <akr@fsij.org>

	* test/test_pty.rb (test_pty_check_default): call PTY.check until
	  "cat" command is finished.

Fri Dec 23 06:03:00 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* common.mk: add "check succeeded" message.

	* README, README.ja: follow above change.

Fri Dec 23 06:00:39 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/bigdecimal/bigdecimal.h: add satisfy cc-mode comment.
	* util.c: ditto.

Fri Dec 23 00:08:25 2011  Tanaka Akira  <akr@fsij.org>

	* test/test_pty.rb (test_pty_check_default): "cat" may not terminated
	  in the 0.1 second.

Thu Dec 22 23:37:25 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_thread.rb (test_condvar_timed_wait): don't test the
	  maximum sleep time.  Ruby is not a real-time system.

Thu Dec 22 22:37:45 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread_pthread.c (ping_signal_thread_list): remove return value.
	* thread_pthread.c (check_signal_thread_list): add a new function to
	  check if signal thread list is empty.
	* thread_pthread.c (thread_timer): check signal thread list after
	  timer_thread_function(). main thread might be added into signal thread
	  list during timer_thread_function().

Thu Dec 22 00:40:24 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/bigdecimal/bigdecimal.c (VpMult, VpCtoV, VpSqrt): remove assigned
	  but unused variables.

Wed Dec 21 18:28:22 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk (newline.c, miniprelude.c): revert r33949 because the change
	  broke mswin build, and the changer said no reason about the change.
	  [ruby-dev:45016] [Bug #5783]

Wed Dec 21 12:35:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_s_allocate): follow
	  Allocation Framework.  [Bug #5775]

Wed Dec 21 02:25:36 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/emitter.c: fixing clang warnings. Thanks Joey!

Wed Dec 21 01:06:00 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* ext/bigdecimal/README: Update redmine.ruby-lang.org to bugs.ruby-lang.org
	* ext/socket/ancdata.c: ditto
	* test/-ext-/wait_for_single_fd/test_wait_for_single_fd.rb: ditto
	* test/syck/test_yaml.rb: ditto
	* doc/ChangeLog-1.9.3: ditto

Tue Dec 20 23:50:12 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* PStore content update perf optimization. Patch by Masaki Matsushita.
	  See #5248.

	* lib/pstore.rb (save_data):

	  * Delete inadequate Marshal check.

	  * Deferred file truncation: when writing the new content, truncate
	    the saved file to the data size after writing the data, instead of
	    truncating whole bytes before writing data.

	  * Deferred MD5 calculation: when comparing MD5 hash to check the
	    content modification, calculate MD5 hash of new data iif the
	    content length is differ from the old one.

	  * Compare content size with String#bytesize instead of String#size.

Tue Dec 20 21:00:30 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: uses to_integer instead.
	* test/date/test_switch_hitter.rb: added a test.

Tue Dec 20 15:04:18 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* Make sure to clear $! when ignoring an exception

	* ext/openssl/ossl.c (ossl_pem_passwd_cb0, ossl_verify_cb):
	  pem_passwd_cb and verify_cb ignores the exception raised in a
	  callback proc so it should clear $! for subsequent execution.

	  That's said, both subsequent processes for pem_passwd_cb and
	  verify_cb raises another exception before leaking $! to Ruby world.
	  We cannot test this fix in Ruby land.

	* test/openssl/test_pkey_rsa.rb
	  (test_read_private_key_pem_pw_exception): Test for pem_passwd_cb +
	  exception.

Tue Dec 20 11:49:13 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/date/test_date_base.rb (test_jd): tests for
	  [ruby-dev:45008].

Tue Dec 20 10:20:48 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/date/date_core.c (wholenum): fix the type of the return value.

Tue Dec 20 05:03:24 2011  Eric Hodel  <drbrain@segment7.net>

	* README.ja:  Update redmine.ruby-lang.org to bugs.ruby-lang.org
	* README:  ditto
	* common.mk:  ditto
	* man/erb.1:  ditto
	* man/irb.1:  ditto
	* man/ri.1:  ditto
	* man/ruby.1:  ditto
	* sparc.c:  ditto
	* tool/install-sh:  ditto

Tue Dec 20 02:15:18 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c:  [ruby-dev:45008].

Sun Dec 18 18:52:37 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* vm.c (vm_define_method): improve guard of iseq from GC.  Fix
	  failure or segmentation fault in test_singleton_method(TestGc)
	  on sparc Solaris10 compiled with Oracle Solaris Studio 12.2.
	  [Bug #5762] [ruby-dev:45000] [Bug #4178]

Sun Dec 18 14:34:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (Init_bigdecimal): does not follow
	  allocation framework right now.  [ruby-core:41710] [Bug #5773]

Sun Dec 18 12:42:48 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: BigDecimals can be restored
	  from YAML.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: BigDecimals can be dumped
	  to YAML.
	* test/psych/test_numeric.rb: tests for BigDecimal serialization

Sun Dec 18 12:03:13 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: Strings that look like dates
	  should be treated as strings and not dates.

	* test/psych/test_scalar_scanner.rb: corresponding tests.

Sun Dec 18 09:43:21 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/thread/test_queue.rb (test_thr_kill): extend timeout.
	  this test takes a long time at slow machine.

Sun Dec 18 09:36:51 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/ruby/envutil.rb (invoke_ruby): remove :timeout option before
	  pass it to Kernel#spawn.

Fri Dec 16 17:18:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README, README.ja: 'make check' is preferable to 'make test'.

Thu Dec 15 23:16:13 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* error.c (builtin_type_name): don't return pointer to the buffer of
	  temporary String object.

Thu Dec 15 17:56:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_type): make typed data.

Thu Dec 15 17:40:28 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_type): fix typo.

Thu Dec 15 14:48:35 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/strscan/strscan.c: use typed data with
	  onig_region_memsize().

Thu Dec 15 14:33:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_typeddata): refine error message with
	  including expected struct name.

Thu Dec 15 13:15:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regcomp.c (onig_region_memsize): implemented for memsize_of().

	* ext/objspace/objspace.c (memsize_of): use it.

Thu Dec 15 10:44:54 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_reject_bang, rb_ary_delete_if): update rdoc.
	  documentation from Thomas Leitner <t_leitner AT gmx.at> in
	  [ruby-core:41616].  [Bug #5752]

Thu Dec 15 10:10:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_require.rb (test_race_exception): get rid of
	  not-guaranteed timing issue.  [ruby-core:41655] [Bug #5754]

Wed Dec 14 21:58:42 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_{read_with_binmode_and_get[cs]}): only for Windows.

Wed Dec 14 19:57:23 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* common.mk,Makefile.in,win32/Makefile.sub (ECHO1): move platform
	  specific hack from common.mk to Makefile.in (and win32/Makefile.sub).
	  [Bug #5711]

	* lib/mkmf.rb: we can generate Makefile as we like.

Wed Dec 14 19:22:33 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (rb_w32_fd_is_text): new function.

	* win32/win32.c (init_stdhandle): set default mode of stdin as binmode.

	* io.c (set_binary_mode_with_seek_cur): new function to replace
	  SET_BINARY_MODE_WITH_SEEK_CUR macro.  now returns previous mode of the
	  fd and take care of LF in rbuf.

	* io.c (do_writeconv): set text mode when needed.

	* io.c (io_read): need to change the mode of the IO to binmode
	  temporally when the length for IO#read, because IO#read with length
	  must behave so.

	* test/ruby/test_io_m17n.rb (TestIO_M17N#test_{read_with_length,
	  read_with_length_binmode,get[cs]_and_read_with_binmode,
	  read_with_binmode_and_get[cs],read_write_with_binmode}): tests for
	  above changes.

	all patches are written by Hiroshi Shirosaki. [ruby-core:41496]
	[Feature #5714]

Wed Dec 14 15:28:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (str_encode): about the extension of :fallback
	  option since 1.9.3.

Wed Dec 14 12:19:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_unlock): release loading barrier and then remove it
	  from loading_table if it is not in-use.  [Bug #5754]

	* thread.c (rb_barrier_release, rb_barrier_destroy): return
	  whether any other threads are waiting on it.

Wed Dec 14 11:23:45 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread_pthread.c (ubf_select): call rb_thread_wakeup_timer_thread()
	  only when it is not timer_thread. [Bug #5757] [ruby-dev:44985]
	  patched by Tomoyuki Chikanaga.

Wed Dec 14 10:20:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_lock): delete the loading barrier if it has been
	  destroyed.

	* thread.c (rb_barrier_wait): return nil for recursive lock
	  instead of false, to distinguish it from destroyed barrier.

Wed Dec 14 01:24:55 2011  okkez  <okkez000@gmail.com>

	* thread_pthread.c (rb_thread_create_timer_thread): fix memory
	  leak. [ruby-dev:44904] [Bug #5688]

Wed Dec 14 00:01:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (primary): point method name line.  [ruby-core:40936]
	  [Bug #5614]

Tue Dec 13 23:43:48 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* error.c (name_err_mesg_to_str): clear rb_thread_t::errinfo when
	  ignore exception under rb_protect(). [ruby-core:41612] [Bug #5755]

	* test/ruby/test_exception.rb (test_exception_in_name_error_to_str):
	  add a corresponding test.

Tue Dec 13 16:13:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (load_unlock): all threads requiring one file should
	  share same loading barrier, so it must be kept alive while those
	  are waiting on it.  [ruby-core:41618] [Bug #5754]

Tue Dec 13 07:30:14 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/webrick/httpresponse.rb (setup_header): 1xx responses
	  are allowed to have Keep-Alive connections.

	* test/webrick/test_httpresponse.rb: corresponding test.

Tue Dec 13 07:13:28 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/webrick/httpresponse.rb (setup_header): 204 and 304 responses
	  are allowed to have a Keep-Alive connection. [ruby-core:41581]

	* test/webrick/test_httpresponse.rb: corresponding test.

Tue Dec 13 06:29:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_magic_comment): should pass the proper value.
	  [ruby-dev:44984][Bug #5753]

Tue Dec 13 05:50:07 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_yield_setup_block_args): splat single
	  argument if optional arguments are defined not only mandatory or
	  post arguments.  [ruby-core:41557] [Bug #5730]

Mon Dec 12 22:35:39 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* parse.y (stmt_or_begin): changed the error message for BEGIN not
	  at toplevel.  [ruby-dev:44963] [Bug #5738]

Mon Dec 12 17:29:01 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* README: Fixed SupportedPlatforms URL in the README.
	  patched by eMxyzptlk. https://github.com/ruby/ruby/pull/62

Mon Dec 12 17:26:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* load.c (rb_feature_p): lazy assigned load_path searched in
	  loading_table were not expanded, but all features, pushed to
	  loading table, are expanded.  a patch by Yura Sokolov
	  <funny.falcon AT gmail.com> in [ruby-core:41545]. [Bug #5727]

Mon Dec 12 15:41:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_truncate): fix typo.  patched by
	  Nick Howard <ndh AT baroquebobcat.com>.
	  https://github.com/ruby/ruby/pull/65

Sun Dec 11 12:19:17 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb: includes the sequence number of UID in a error
	  message.  suggested by art lussos.
	  [ruby-core:41413] [Feature #5692]

Sun Dec 11 11:42:10 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* ext/syslog/syslog.c: fix a typo. [ruby-core:41585] [Bug #5740]

Sun Dec 11 10:48:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (exit_initialize): deal with true and false as well as
	  Kernel#exit.  [ruby-dev:44951] [Bug #5728]

Sun Dec 11 10:37:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_check_to_int): new function to convert a VALUE to
	  an Integer if possible, but returns nil instead of raising an
	  exception otherwise.

Sun Dec 11 10:34:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (rb_exit_status_code): extract from rb_f_exit_bang and
	  rb_f_exit.  assume 0 to be success in Kernel#exit! too.

Fri Dec  9 19:24:31 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/trans/iso-8859-16-tbl.rb: add ISO-8859-16 converter.

	* enc/trans/single_byte.trans: ditto.

Fri Dec  9 14:28:40 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_path_convert): don't convert it when the path string is
	  ascii only. [ruby-core:41556] [Bug #5733]
	  tests are contributed by nobu.

Fri Dec  9 08:00:15 2011  Luis Lavena  <luislavena@gmail.com>

	* include/ruby/win32.h: undef stat to silence mingw-w64 stat
	  redefinition warnings (GCC 4.6.3).

Thu Dec  8 23:38:24 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* variable.c (set_const_visibility): clear inline-cache when constant's
	  visibility is modified. [ruby-dev:44929]

	* test/ruby/test_module.rb (test_private_constants_clear_inlinecache):
	  add test for it.

Thu Dec  8 23:26:11 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): should sort after map, not before
	  it.  in this case there is no difference, but we should write better
	  code.  this bad smell was caught by nagachika.

Thu Dec  8 22:31:13 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/extmk.rb (extract_makefile): need to sort the array of current
	  srcs before comparing to the sorted old srcs.
	  fixed the problem that the configuring stage of exts were always
	  run, introduced at r33801.

Thu Dec  8 13:26:24 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rexml/test_order.rb (OrderTester#test_more_ordering): use
	  Zlib::GzipReader.open instead of Zlib::GzipReader.new with File.new.
	  fixed a test error on Windows introduced at r33946.

Thu Dec  8 13:11:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#test_sete[gu]id): silently
	  skip if not implemented such functions (such as, on Windows).
	  fixed test errors on Windows introduced at r33953.

Thu Dec  8 12:57:50 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/socket/extconf.rb: forgotten to define HAVE_SOCKETPAIR for
	  windows.
	  fixed test errors on Windows introduced at r33947.

Thu Dec  8 12:11:06 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_WERROR_FLAG): append all warning flags which
	  are enabled to compile, so that printf format modifiers properly
	  fail.  [ruby-core:41351] [Bug #5679]

Thu Dec  8 07:20:15 2011  Eric Hodel  <drbrain@segment7.net>

	* doc/re.rdoc:  Document difference between match and =~, options with
	  Regexp.new and global variables.  Patch by Sylvain Daubert.
	  [Ruby 1.9 - Bug #5709]

Thu Dec  8 06:53:10 2011  Eric Hodel  <drbrain@segment7.net>

	* doc/re.rdoc:  Fix example code to match documentation.  Patch by
	  Jarno Lamberg.  [Ruby 1.9 - Bug #5624]

Wed Dec  7 19:04:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (rpath): fix typo in the help string.  a patch from
	  Yuji Yamano <yyamano AT kt.rim.or.jp> in [ruby-list:48568].

Wed Dec  7 18:55:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (vm_set_top_stack, vm_set_eval_stack): check for stack
	  overflow with stack_max before push new frame. [ruby-core:41520]
	  [Bug #5720]

	* vm.c (vm_set_main_stack): no stack overflow chances after
	  vm_set_eval_stack().

Wed Dec  7 09:58:15 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/bigdecimal/bigdecimal.c:  Document +@, -@, hash, INFINITY, Nan.
	  Patch by Sylvain Daubert.  [Ruby 1.9 - Feature #5622]

Wed Dec  7 09:48:00 2011  Eric Hodel  <drbrain@segment7.net>

	* io.c (Init_IO):  Mention io/console methods.  [Ruby 1.9 - Bug #5602]
	* ext/io/console/console.c:  Mention that io/console must be required
	  similar to lib/time.rb

Wed Dec  7 08:04:31 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb (module Psych): parse and load methods take
	  an optional file name that is used when raising Psych::SyntaxError
	  exceptions
	* ext/psych/lib/psych/syntax_error.rb (module Psych): allow nil file
	  names and handle nil file names in the exception message
	* test/psych/test_exception.rb (module Psych): Tests for changes.

Tue Dec  6 18:26:33 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c: use db_version() instead of DB_VERSION_STRING to
	  detect runtime Berkeley DB version.
	  use dpversion instead of _QDBM_VERSION to detect runtime QDBM
	  version.
	  [ruby-dev:44948]

Tue Dec  6 12:30:41 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: detect gdbm_version in libgdbm.

	* ext/dbm/dbm.c: make DBM::VERSION more informative for gdbm, qdbm and
	  Berkeley DB 1.x.  [ruby-dev:44944]

Tue Dec  6 07:26:37 2011  Eric Hodel  <drbrain@segment7.net>

	* range.c:  Improve documentation for Range.  Patch by Chris Zetter.
	  [Ruby 1.9 - Bug #5656]

Mon Dec  5 19:08:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regparse.c (PFETCH_READY): separate gcc specific trick.

Mon Dec  5 19:01:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_seteuid_m): fix argument.

	* test/ruby/test_process.rb (test_geteuid): fix typo.

	* test/ruby/test_process.rb (test_getegid, test_set[eg]uid): add.

Mon Dec  5 18:56:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (big_rshift), compile.c (validate_label,
	  iseq_build_from_ary_exception), cont.c (cont_capture), dir.c
	  (dir_open_dir), gc.c (objspace_each_objects), io.c (pipe_open)
	  (rb_io_advise), parse.y (parser_compile_string)
	  (rb_parser_compile_file), proc.c (binding_free), process.c
	  (rb_proc_exec_n, rb_seteuid_core, proc_setegid, rb_setegid_core)
	  (p_uid_exchange, p_gid_exchange), regparse.c (strdup_with_null),
	  signal.c (sig_dfl), vm.c (rb_iseq_eval, rb_iseq_eval_main),
	  vm_insnhelper.c (vm_expandarray): suppress
	  unused-but-set-variable warnings.

	* class.c (rb_obj_methods), compile.c (iseq_compile_each),
	  iseq.c(iseq_load, rb_iseq_parameters), pack.c (pack_pack),
	  regcomp.c (is_not_included, update_string_node_case_fold),
	  transcode.c (rb_econv_open0, make_replacement),
	  vm_eval.c (raise_method_missing): remove unused variable.

	* signal.c (reserved_signal_p): static.

Mon Dec  5 14:27:23 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/{subst.h,win32.h}, ext/socket/rubysocket.h: revert
	  r33876.  [ruby-core:41475] [Bug #5706]

	* ext/socket/extconf.rb: the alternative hack for [Bug #5675].

Mon Dec  5 10:18:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/zlib/zlib.c (rb_gzreader_initialize): revert a part of r33937.
	  1st, to change the mode of an IO is very sensitive problem, so
	  the maintainer of this library should judge it.
	  2nd, usually Zlib::GzipReader.new is not called directly.  #initialize
	  is called via .open, and in the method the I/O is opened in binary
	  mode, so there is no problem without changing the mode in #initialize.

Sun Dec  4 22:53:12 2011  Tanaka Akira  <akr@fsij.org>

	* lib/tempfile.rb: don't use lock directory.  [ruby-dev:39197]

Sun Dec  4 22:34:43 2011  Tanaka Akira  <akr@fsij.org>

	* lib/tempfile.rb (Tempfile::MAX_TRY): remove unused constant.

Sun Dec  4 12:11:28 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* lib/pp.rb: fix rdoc.

Sun Dec  4 12:03:16 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/delegate.rb (Delegator#methods): Kernel#methods receives
	  zero or one argument. [ruby-core:37118] [Bug #4882]

Sun Dec  4 10:15:00 2011  Luis Lavena  <luislavena@gmail.com>

	* ext/zlib/zlib.c (rb_gzreader_initialize): use binary mode by default
	  under Windows. Patch by Hiroshi Shirosaki. [ruby-core:40706]
	  [Feature #5562]

	* include/ruby/encoding.h (void rb_econv_binmode): define NEWLINE
	  decorator.

	* io.c (rb_cloexec_fcntl_dupfd): Introduce NEED_READCONV and
	  NEED_WRITECONV to replace universal newline decorator by CRLF only
	  when required to improve file reading and writing under Windows.
	  Patch by Hiroshi Shirosaki. [ruby-core:40706] [Feature #5562]
	* io.c (do_writeconv): adjust binary mode if required.
	* io.c (read_all, appendline, swallow, rb_io_getline_1): ditto.
	* io.c (io_getc, rb_io_each_codepoint, rb_io_ungetc): ditto.
	* io.c (rb_io_binmode, rb_io_ascii8bit_binmode): ditto.
	* io.c (rb_io_extract_modeenc, rb_sysopen): ditto.
	* io.c (pipe_open, prep_stdio, io_encoding_set): ditto.
	* io.c (rb_io_s_pipe, copy_stream_body): ditto.

	* test/ruby/test_io_m17n.rb (EOT): add test for pipe and stdin in
	  binary mode.

	* win32/win32.c (init_stdhandle): remove O_BINARY from stdhandle
	  initialization.
	* win32/win32.c (rb_w32_write): use FTEXT mode accordingly.

Sat Dec  3 20:49:16 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): print a warning when no argument
	  is passwd to Module#private_constant.  [ruby-list:48558]

	* vm_method.c (set_method_visibility): ditto for
	  Module#private_class_method.

Sat Dec  3 20:43:14 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* variable.c (set_const_visibility): Module#private_constant has
	  changed the visibility of only the first argument.  Now it changes
	  all of them.  [ruby-list:48558]

	* test/ruby/test_module.rb: add a test for above.

Sat Dec  3 07:17:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (CFLAGS): append ARCH_FLAG.

	* configure.in (ARCH_FLAG): exclude from CFLAGS.

	* configure.in (UNIVERSAL_INTS): include short int.  fix for
	  test/mkmf.

Fri Dec  2 15:48:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.c (VpAllocReal): reduce extra frac.

Fri Dec  2 15:41:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: check whether -pie or -Wl,-pie is valid as
	  LDFLAGS.  [ruby-core:41438] [Bug#5697]

	* configure.in: use $linker_flag for LDFLAGS option which is not
	  limited to particular platforms.

Thu Dec  1 23:21:58 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread_pthread.c (thread_timer): call prctl(PR_SET_NAME) only if
	  PR_SET_NAME is available.

Thu Dec  1 22:31:16 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (linux_get_maxfd): change local variable name.

Thu Dec  1 16:59:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/socket/extconf.rb: add arguments for macro calls.
	  [ruby-core:41370] [Bug#5681]

Thu Dec  1 16:20:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (MakeMakefile#try_func): fix broken patch at r33834.

Thu Dec  1 14:43:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.h (Real): suppress false warning from
	  clang.  [ruby-core:41418] [Bug#5693]

Thu Dec  1 10:31:55 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (LDFLAGS): -fstack-protector is always needed to
	  link static library created with it.  [ruby-core:41387]
	  [Bug#5686]

Thu Dec  1 07:03:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: add sys/prctl.h test.
	* thread_pthread.c (thread_timer): call prctl(PR_SET_NAME) to change
	  thread name. It may help to debug.

Wed Nov 30 23:35:45 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* variable.c (rb_path2class): don't raise NameError when the middle
	  constant of the path is not defined but defined on toplevel.
	  [ruby-core:41410] [Bug #5691]

Wed Nov 30 20:02:02 2011  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* transcode.c: Simplified rb_econv_binmode, avoided a warning on cygwin.

Wed Nov 30 08:57:07 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mkmf.rb:  Use MakeMakefile's rm_f to avoid conflict with Rake or
	  FileUtils.
	* test/ruby/test_module.rb:  Hide MakeMakefile's inclusion in Object

Wed Nov 30 09:12:43 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rdoc/encoding.rb (RDoc::Encoding.read_file): fixup newline chars
	  on Windows.
	  see https://github.com/rdoc/rdoc/issues/87

	* test/rdoc/test_rdoc_markup_pre_process.rb
	  (TestRDocMarkupPreProcess#test_include_file,
	  TestRDocMarkupPreProcess#test_include_file_encoding_incompatible):
	  follow above change.

Wed Nov 30 09:09:37 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): parse method can take an option file
	  name for use in exception messages.
	* test/psych/test_parser.rb: corresponding tests.

Tue Nov 29 09:07:59 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mkmf.rb:  Fix indentations of constants at end of module.
	  Document some constants.

Tue Nov 29 09:58:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_write_error2): suppress unused variable warning.

Tue Nov 29 07:45:26 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mkmf.rb:  Wrap comments to 78 columns and clean up formatting.

Tue Nov 29 05:54:18 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/mkmf.rb:  Wrap mkmf.rb in module MakeMakefile to clean up Object
	  documentation.  [Ruby 1.9 - Feature #5658]
	* ext/extmk.rb:  Use MakeMakefile::CONFIG instead of Object::CONFIG
	* test/mkmf/base.rb:  ditto

Tue Nov 29 00:08:57 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (INSTRUBY_ARGS): added --mantype to apply mdoc2man.rb
	  to man pages.  Fixes #5598.
	  (do-install-nodoc, do-install-local, do-install-man,
	  dont-install-nodoc, dont-install-local, dont-install-man):
	  No longer needs --mantype.

	  Reported by Rainer Orth <ro AT cebitec.uni-bielefeld.de>,
	  patch by George Koehler <xkernigh AT netscape.net>.

Mon Nov 28 22:26:31 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rake/test_rake_directory_task.rb
	  (TestRakeDirectoryTask#test_directory_win32): shouldn't create any
	  file/directory on root directory.  create on @tempdir (= Dir.pwd).
	  see https://github.com/jimweirich/rake/issues/91

Mon Nov 28 12:57:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_write_error2): fwrite() returns ssize_t.

Mon Nov 28 12:47:19 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* parse.y (nodetype, nodeline): static.  these functions are for
	  debugging, and not intend to be public.

Mon Nov 28 12:37:54 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* gc.c (initial_params): static.  it seems to be forgotten at r33501.

Mon Nov 28 12:32:24 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/win32.h, win32/win32.c (GetCurrentThreadHandle): remove
	  unused old API.

Mon Nov 28 12:29:20 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/mkexports.rb (Exports#initialize): remove old symbol name.

Mon Nov 28 12:15:28 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/mkexports.rb (Exports#read_substitution): need to read
	  from subst.h too.  [Bug #5675]

Mon Nov 28 11:46:35 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_io_flush): release GVL during fsync() on Windows.

Mon Nov 28 11:00:25 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/subst.h: typo of r33876.

Mon Nov 28 10:36:00 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/subst.h: moved Windows specific substitutions from
	  win32.h.

	* ext/socket/rubysocket.h: include ruby/subst.h.  [Bug #5675]

Mon Nov 28 10:20:58 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/{Makeilfe.sub,win32.c} (FILE_COUNT, FILE_READPTR): move the
	  definitions from config.h to win32.c.  I dared to have left such
	  macros, for other future compiler support.
	  [ruby-core:41313] [Bug #5674]

Mon Nov 28 09:28:30 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_uchmod): typo.  [Bug#5671] [ruby-dev:44898]

	* test/ruby/test_file.rb (TestFile#test_chmod_m17n): test of above bug.

Sun Nov 27 21:25:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: added -fno-strict-overflow. it suppress annoying
	  -Wstrict-overflow warning.

Sun Nov 27 20:58:02 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_write_error2): get rid of warning on linux. fwrite
	  of glibc is tagged __attribute__ ((__warn_unused_result__))
	  if _FORTIFY_SOURCE != 0.
	* vm_dump.c (rb_vm_bugreport): ditto.

Sun Nov 27 19:09:02 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (stack_protector): disable on mingw.  [Bug#5676]

	* Makefile.in (DLDFLAGS): also needs -fstack-protector.
	  [Bug#5676]

Sun Nov 27 14:13:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: add -fstack-protector into XLDFLAGS as well as
	  XCFLAGS if stack-protector is used.

Sun Nov 27 13:09:25 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: workaround to avoid MacOS X build error.
	  Maybe autoconf 2.61 is slightly buggy. [ruby-core:41316]

Sun Nov 27 04:57:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in (--no-undefined): r33840 breaks FreeBSD and DragonFly
	  with gcc 4.4 or later. Their environ is in /usr/libexec/ld-elf.so.1,
	  so it will be false negative.

Sun Nov 27 04:55:45 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP::SSL_IVNAMES): rerefix 33701.
	  SSL_ATTRIBUTES stores names for set_params, they are symbol.
	  SSL_IVNAMES stores instance variable names.

Sun Nov 27 00:16:07 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_body): use 0666 for permission argument for open.
	  [ruby-core:40865]

Sat Nov 26 23:01:38 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_engine.rb: remove side effect of generic engine
	  load by explicitly loading software-based "openssl" engine for
	  all tests.

Sat Nov 26 20:41:48 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP.get_response): enable use_ssl
	  if given URI object is https.
	  patched by Mark Ferlatte [ruby-core:40665] [Bug #5545]

	* lib/net/http.rb (Net::HTTP.post_form): ditto.

Sat Nov 26 20:01:18 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb (Net::HTTP::SSL_ATTRIBUTES): refix 33701.
	  store instance variable symbol names.

Sat Nov 26 15:40:25 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* .travis.yml (script): should be ./configure

Sat Nov 26 15:39:18 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* .travis.yml (before_script): wrong name, sorry.

Sat Nov 26 15:31:34 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* .travis.yml (before-script): autoconf required.

Sat Nov 26 15:24:05 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* .travis.yml: Travis enable.

Sat Nov 26 10:47:50 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/extconf.rb: remove checks for available functions.
	* ext/openssl/missing.h: ditto.
	  Thanks, Tim Mooney for reporting this!
	  [Bug #5432] [ruby-core:40088]

Sat Nov 26 10:22:28 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ssl.c: add comment on where to find implementation
	  of OpenSSL::SSL::SSLSocket#session.

Sat Nov 26 05:00:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (--no-undefined): RUBY_TRY_CFLAGS does nothing for
	  linker flags.  use RUBY_TRY_LDFLAGS.

Fri Nov 25 11:37:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (ioctl_narg_len, linux_iocparm_len): reinstantiate linux
	  specific narg length calculation.
	* test/ruby/test_io.rb (test_ioctl_linux2): add new test for old and
	  unstructured ioctl.

Fri Nov 25 10:39:14 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* Makefile.in (EXTLDFLAGS): export it.
	* configure.in: add --no-undefined if --enable-shared is specified.
	  Gentoo enabled this option long time. Also, export EXTLDFALGS.

Fri Nov 25 08:48:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: turn on PIE if --enable-shared is not specified.

Fri Nov 25 08:05:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: add -fstack-protector. It help to protect us from
	  stack smashing attack.

Fri Nov 25 08:03:28 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: add -D_FORTIFY_SOURCE=2. It provide some compile
	  time and runtime check for security.

Fri Nov 25 08:00:23 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/mkmf.rb: get rid of warnings of mkmf.rb if -Wmissing-declarations
	  and/or -Wold-style-definition warnings if specified.
	  Patch by Nikolai Weibull. Thank you! [Bug #5459] [ruby-core:40200]

Fri Nov 25 07:46:09 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: add -Wall always.

Thu Nov 24 20:02:40 2011  Tanaka Akira  <akr@fsij.org>

	* test/openssl/test_engine.rb: use IO#reopen to restore stderr.

Thu Nov 24 19:59:56 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_reopen): re-initialize buffering mode for stdout and
	  stderr.

Thu Nov 24 11:12:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_io_fsync,rb_io_fdatasync): release GVL during fsync().
	  fsync() and fdatasync() may take a long time on slow disks and/or
	  if there is much dirty data.
	  Patch by Eric Wong. [Feature #5665] [ruby-core:41247]

Thu Nov 24 10:05:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_engine.rb: Suppress output from 'openssl'
	  engine's RC4 cipher.
	  [Bug #5633] [ruby-core:41026]

Thu Nov 24 08:05:02 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey_dsa.c: remove redundant colon from error
	  message.
	* ext/openssl/ossl_ssl.c: ditto.
	* ext/openssl/ossl_pkey_rsa: ditto.
	  patched by Eric Hodel [Bug #5604] [ruby-core:40896]

Wed Nov 23 20:03:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (ioctl_narg_len): don't use _IOC_SIZE macro on Linux.
	  On Linux some constants for ioctl(2) doesn't include the size of
	  its return value and 16bit value; for example FIONREAD 0x541B.
	  Moreover the manual, ioctl_list(2),  says "Note  that  the  size
	  bits  are  very unreliable: in lots of cases they are wrong,
	  either because of buggy macros using sizeof(sizeof(struct)),
	  or because of legacy values."
	  So we shouldn't use it.

Tue Nov 22 18:07:32 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (_pioinfo): need to declare _pioinfo() before using
	  _osfhnd and other macros which uses _pioinfo() internally.

Tue Nov 22 17:49:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (_pioinfo): make an inline function.

Tue Nov 22 11:26:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

Tue Nov 22 11:33:58 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/win32.c (dupfd): argument of _osfhnd and so on should not
	  have side effect.

Tue Nov 22 11:26:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* bignum.c (rb_big_divide): refix of r33536. Don't change behavior of Bignum#/.
	  [ruby-core:40429] [Bug #5490]

Tue Nov 22 10:46:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* numeric.c (ruby_float_step): improve floating point calculations.
	  [ruby-core:35753] [Bug #4576]

	* numeric.c (ruby_float_step): correct the error of floating point
	  numbers on the excluding case.
	  patched by Masahiro Tanaka [ruby-core:39608]

	* numeric.c (ruby_float_step): use the end value when the current
	  value is greater than or equal to the end value.
	  patched by Akira Tanaka [ruby-core:39612]

Tue Nov 22 06:59:21 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io.rb (test_fcntl_dupfd): there is no known platform
	  which don't have F_DUPFD.  [ruby-dev:44874]

Tue Nov 22 04:46:22 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: remove autoload from psych
	* ext/psych/lib/psych/json.rb: ditto

Tue Nov 22 00:44:59 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_io.rb (test_fcntl_dupfd): the argument of F_DUPFD is
	  minimum file descriptor.

Tue Nov 22 00:25:17 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (linux_get_maxfd): get rid of a warning.

Mon Nov 21 23:39:14 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (linux_get_maxfd): new function to find maximum fd on Linux.
	  (rb_close_before_exec): use linux_get_maxfd.

Mon Nov 21 06:16:24 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (fiber_switch): ignore fiber context switch
	  because destination fiber is same as current fiber.
	  With out this, it may segv on FreeBSD 9.
	  patched by Koichi Sasada.

Sun Nov 20 23:22:42 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/extmk.rb (extract_makefile, extmake): regenerate makefiles
	  if globbed source file list is changed.

	* lib/mkmf.rb (create_makefile): store ORIG_SRCS.

Sun Nov 20 22:43:03 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enc/unicode.c (PROPERTY_NAME_MAX_SIZE): +1.
	  reported by Ken Takata. [ruby-dev:44894][Bug #5652]

Sun Nov 20 11:01:28 2011  Tanaka Akira  <akr@fsij.org>

	* lib/set.rb (SortedSet.setup): remove old_init after initialize
	  method is redefined.  The remove before redefinition makes the
	  warning prevention fragile.  [ruby-dev:44892]

Sun Nov 20 04:01:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (enc/unicode/name2ctype.h): remove duplicated
	  ifdefs.

Sat Nov 19 19:31:47 2011  Tanaka Akira  <akr@fsij.org>

	* time.c (TIME_COPY_GMT): copy vtm.utc_offset and vtm.zone too.
	  patch by Tomoyuki Chikanaga.
	  [ruby-dev:44827] [Bug #5586]

Sat Nov 19 16:36:57 2011  Tanaka Akira  <akr@fsij.org>

	* test/net/http/test_http.rb: remove temporally files in ensure clause.

Sat Nov 19 08:18:41 2011  Tanaka Akira  <akr@fsij.org>

	* test/net/http/test_http.rb: remove temporally files.

Fri Nov 18 17:18:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_raw, console_set_raw)
	  (console_getch): optional parameters.  [EXPERIMENTAL]

Fri Nov 18 16:12:11 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/io/console/console.c (console_cooked, console_set_cooked):
	  new methods to reset cooked mode.  [EXPERIMENTAL]

Fri Nov 18 13:20:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/unit/assertions.rb (MINI_DIR): quick dirty hack to get rid of
	  warnings when using assert/assert_respond_to.

Fri Nov 18 13:03:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_cloexec_open): set O_NOINHERIT instead of O_CLOEXEC if it is
	  available (for Windows).

	* win32/win32.c (fcntl): on F_DUPFD, determine the inheritance of the
	  new handle by O_NOINHERIT flag of original fd.

Fri Nov 18 08:00:41 2011  Ryan Davis  <ryan@lust.zenspider.com>

	* lib/minitest/*: Imported minitest 2.8.1 (r6750)
	* test/minitest/*: ditto
	* configure.in: Improved gcc-llvm error message to help people migrate.

Thu Nov 17 20:43:34 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: revert a part of the patch in [ruby-dev:41531].
	  don't use db.h with other headers.  [ruby-dev:44884].

Thu Nov 17 20:23:03 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* benchmark/bm_io_select[23].rb: use Process::RLIMIT_NOFILE only when
	  it is defined.  if it is not defined, assume 64 as the max of fds.

Thu Nov 17 10:36:46 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb (load_file): make sure opened yaml files are
	  also closed. [ruby-core:41088]

Wed Nov 16 18:13:52 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* Makefile.in (LIBRUBY_A): check if generated linked library is
	  valid for extconf.

Wed Nov 16 13:51:40 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2ulong): need to calc in unsigned long, because
	  the range of VALUE is larger than it on LLP64 platform, such as Win64.
	  this change fixes the failures of test/-ext-/num2int.

Wed Nov 16 12:02:47 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/webrick/test_cgi.rb (TestWEBrickCGI#start_cgi_server): there are
	  no guarantee of existence of RbConfig::CONFIG['LIBPATHENV'].
	  it only exists in Unix-like environments.

	* test/webrick/test_filehandler.rb
	  (WEBrick::TestFileHandler#test_script_disclosure): ditto.

Wed Nov 16 11:34:20 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (argf_next_argv): wrong timing of setting ecflags.
	  fixed the failure of TestArgf#test_textmode introduced at r33662.

Wed Nov 16 10:45:00 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/-test-/num2int/num2int.c: remove an unnecessary and wrong decl
	  of rb_stdout.  it's declared in ruby.h correctly.

Wed Nov 16 10:26:41 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* bignum.c (rb_big2ull): add a cast to get rid of a VC++ warning.

Wed Nov 16 09:39:27 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/minitest/unit.rb (assert_raises): experimental fix to run
	  correctly on chkbuild over 64bit linux. call exception_details only
	  when the detail is really needed to avoid create needless inspect
	  under ulimit-ed environment.

Wed Nov 16 06:34:30 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_thread.rb (test_condvar_timed_wait): use
	  assert_operator.

Tue Nov 15 21:56:25 2011  Tanaka Akira  <akr@fsij.org>

	* test/ruby/test_sleep.rb (test_sleep_5sec): 0.1sec tolerance is too
	  small for busy environment.

Tue Nov 15 20:08:55 2011  Tanaka Akira  <akr@fsij.org>

	* io.c, thread.c, ext/pty/pty.c, ext/fiddle/closure.c: use
	  __linux__ macro for consistency.

Tue Nov 15 14:45:15 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/ruby.h(NUM2LONG, NUM2INT, NUM2SHORT, NUM2LL,
	  INT2NUM, UINT2NUM, LONG2NUM, ULONG2NUM, NUM2CHR): wrap by
	  macros.

Tue Nov 15 13:38:14 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* include/ruby/defines.h (FLUSH_REGISTER_WINDOWS): move sparc asm code
	  to a separate file sparc.c for preventing inlining optimization.
	  Patched by Jurij Smakov. [Bug #5244] [ruby-core:40685]
	* sparc.c (rb_sparc_flush_register_windows): ditto.
	* configure.in: ditto.

Tue Nov 15 13:11:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/ruby.h: get rid of gcc specific rb_long2int(),
	  NUM2LONG(), NUM2INT(), NUM2SHORT(), NUM2LL(), INT2NUM(),
	  UINT2NUM(), LONG2NUM(), ULONG2NUM() and NUM2CHR()
	  implementation. Because 1) They don't make any better code
	  at all. 2) Inline function have a better debugger supoort.

Tue Nov 15 09:58:25 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (TestIO#test_fcntl_dupfd): fix OpenBSD test
	  failure. [ruby-dev:44872]

Tue Nov 15 09:50:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* regcomp.c (print_indent_tree): fix double printing of ENCLOSE_OPTION
	  children bug. patched by Suraj Kurapati. [ruby-core:40964]

Tue Nov 15 01:53:48 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/ruby/test_io.rb (test_fcntl_dupfd): fix test error on
	  SnowLeopard. Pointed out by CHIKANAGA Tomoyuki. [ruby-dev:44866]

Mon Nov 14 22:06:02 2011  Tanaka Akira  <akr@fsij.org>

	* ext/openssl/ossl_pkey.c (ossl_pkey_new_from_file): set close-on-exec
	  flag.

	* ext/openssl/ossl_x509cert.c (rb_fd_fix_cloexec): ditto.

Mon Nov 14 14:54:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* bignum.c (rb_big2ull): fix 32bit platform breakage. we must
	  not assume sizeof(VALUE) == sizeof(LONG_LONG).
	* test/-ext-/num2int/test_num2int.rb (class TestNum2int):
	  fix false assumption on 32bit platform.

Mon Nov 14 14:52:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* numeric.c (rb_fix2ushort): fix typo. use num rb_num2ushort()
	  instead of num2uint().

Sun Nov 13 10:31:03 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/ruby.h: add #ifdef comment.

Sun Nov 13 10:28:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/ruby.h: add NUM2SHORT(), NUM2USHORT() macros.
	* numeric.c: ditto.

	* test/-ext-/num2int/test_num2int.rb: add testcases for NUM2SHORT().
	* ext/-test-/num2int/num2int.c: ditto.

Sun Nov 13 10:23:48 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* bignum.c (rb_big2ull): fix off-by-twice bug of NUM2ULL.
	* test/-ext-/num2int/test_num2int.rb (class TestNum2int):
	  fix a testcase too.

Sun Nov 13 10:22:44 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/-ext-/num2int/test_num2int.rb (class TestNum2int):
	  add FIXNUM tests.

Sun Nov 13 09:57:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* numeric.c (check_uint): fix off-by-one bug of NUM2UINT.
	* bignum.c (rb_big2ulong): fix off-by-one bug of NUM2ULONG.

	* test/-ext-/num2int/test_num2int.rb: add a testcase for NUM2INT()
	  NUM2UINT(), NUM2LONG(), NUM2ULONG(), NUM2LL and NUM2ULL().
	* ext/-test-/num2int/depend: ditto.
	* ext/-test-/num2int/extconf.rb: ditto.
	* ext/-test-/num2int/num2int.c: ditto.

Sun Nov 13 23:47:29 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dbm/extconf.rb: use convertible_int.

Sun Nov 13 23:45:57 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (checking_for): should not modify the result.

	* lib/mkmf.rb (have_struct_member): accept compiler options.

	* lib/mkmf.rb (convertible_int): add restricted support of struct
	  member, and TYPEOF_ macro.

Sun Nov 13 23:21:24 2011  Tanaka Akira  <akr@fsij.org>

	* ext/gdbm/gdbm.c (fgdbm_reorganize): set close-on-exec flag after
	  gdbm_reorganize().  gdbm_reorganize() opens a new database internally.

Sun Nov 13 19:57:18 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: rollback for each headers for each libraries.

Sun Nov 13 16:24:48 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: treat libc as a choice for a library which
	  provide ndbm API.

Sun Nov 13 15:40:43 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: duplicate $libs and $defs when save them.

Sun Nov 13 12:43:48 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: rollback $libs and $defs when db detection is
	  failed.  It fixes -lgdbm -lqdbm when the system has qdbm and gdbm
	  without gdbm_compat.

Sat Nov 12 21:14:51 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/webrick/test_cgi.rb (class TestWEBrickCGI): respect
	  RbConfig::CONFIG["LIBPATHENV"]. [Bug #5135] [ruby-core:38653]
	* test/webrick/test_filehandler.rb (class WEBrick): ditto.

Sat Nov 12 20:57:29 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (test_fcntl_dupfd): skip if Fcntl::DUPFD
	  is not defined. Pointed out by CHIKANAGA Tomoyuki. Thanks.

Sat Nov 12 17:26:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (do_ioctl, ioctl_narg_len, setup_narg, rb_ioctl): use
	  ioctl_req_t.

Sat Nov 12 17:01:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dbm/extconf.rb (headers.db_check): reduce duplicated code.

Sat Nov 12 15:59:42 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: dbm_clearerr should be available in all ndbm
	  implementation.  If it is not available, it is caused by
	  header/library mismatch such that Berkeley DB header & gdbm library.

	* ext/dbm/dbm.c (fdbm_store): use dbm_clearerr() unconditionally.
	  gdbm 1.9 provides it as a real function instead of a empty macro.

Sat Nov 12 13:35:33 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* bootstraptest/runner.rb: don't suppress SIGINT.
	  [Feature #5612] [ruby-dev:44856]

Sat Nov 12 11:20:36 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (fcntl_narg_len): introduce narg calculation for fcntl instead
	  of hard coded 256.
	* io.c (setup_narg): ditto.

Sat Nov 12 11:19:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (test_fcntl_dupfd): add another fcntl test.

Sat Nov 12 11:18:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/ruby/test_io.rb (test_fcntl_lock_freebsd): add a testcase
	  of fcntl lock for freebsd.

Sat Nov 12 11:16:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (ioctl_narg_len): Linux doesn't have IOCPARM_LEN macro, but
	  has _IOC_SIZE. support it.

Sat Nov 12 11:13:18 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (rb_ioctl): don't expose our sanity check value to ruby script.
	  It may change string value meaning if the value is string.
	  (e.g. MacOS X has F_GETPATH ioctl)
	* io.c (rb_fcntl): ditto.

Sat Nov 12 11:06:02 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (ioctl_req_t): Type of req argument of ioctl() depend on platform.
	  Moreover almost all linux ioctl can't be represented by 32bit integer
	  (i.e. MSB is 1). We need wrap ioctl argument type.
	  [Bug #5429] [ruby-dev:44589]
	* io.c (struct ioctl_arg): ditto.
	* io.c (rb_ioctl): ditto.
	* test/ruby/test_io.rb (test_ioctl_linux): add a testcase for ioctl

Sat Nov 12 11:00:42 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (struct io_cntl_arg): remove io_p member.
	* io.c (nogvl_fcntl, do_fcntl, rb_fcntl): separated from ioctl functions.
	* io.c (nogvl_io_cntl): remove fcntl depended logic.
	* io.c (io_cntl): ditto.
	* io.c (rb_io_ctl): ditto.
	* io.c (rb_io_ioctl): ditto.

Sat Nov 12 10:59:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (setup_narg): fix off by one bug.

Sat Nov 12 10:56:43 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (+setup_narg): factor out length calculation logic.
	* io.c (rb_io_ctl): ditto.

Sat Nov 12 10:52:17 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (+ioctl_narg_len) new helper function.
	* io.c (rb_io_ctl): don't use ioctl specific length check
	  if caller is fcntl.

Fri Nov 11 23:00:46 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: db_prefix is not required now.

Fri Nov 11 21:13:30 2011  Tanaka Akira  <akr@fsij.org>

	* ext/gdbm/gdbm.c (fgdbm_initialize): use GDBM_CLOEXEC if available.

Fri Nov 11 21:00:05 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: fix dbm_pagfno and dbm_dirfno detection with
	  Berkeley DB.  Macro definitions needs arguments to detect correctly.
	  SIZEOF_DSIZE needs -DDB_DBM_HSEARCH because db.h defines datum type
	  only if DB_DBM_HSEARCH is defined.

Fri Nov 11 18:41:57 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_seteuid): separate an internal wrapper function
	  from the method implementation.

Fri Nov 11 17:21:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_library, find_library, have_func): allow
	  arguments of function to be checked.

Fri Nov 11 17:09:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_dump.c (HAVE_BACKTRACE): fallback to 0.

	* vm_dump.c (rb_vm_bugreport): show "Other runtime information"
	  header only when available.

	* vm_dump.c (rb_vm_bugreport): get rid of modifying the content of
	  VM directly.

	* vm_dump.c (rb_vm_bugreport): check if vm is non-null.
	  Pointed out by Ikegami Daisuke <ikegami.da@gmail.com>.
	  Thank you.

Fri Nov 11 12:36:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* io.c (pipe_open): Remove fflush(stdin). it's no effect.
	  Pointed out by Ikegami Daisuke <ikegami.da@gmail.com>.
	  Thank you.

Fri Nov 11 07:33:30 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb (Net::HTTP::SSL_ATTRIBUTES):  Use symbol keys instead
	  of string keys to avoid duplicating parameters in
	  OpenSSL::SSL:SSLContext#set_params.

Thu Nov 10 15:02:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_library, have_func, have_var, have_header):
	  add compiler option parameter.

Thu Nov 10 07:45:16 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/ssl.rb (class OpenSSL::SSL::SSLContext):
	  Document #set_params.

Wed Nov  9 11:36:53 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (gvl_yield): don't prevent concurrent sched_yield().
	  [Bug #5130] [ruby-core:38647]

Wed Nov  9 23:20:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_update_max_fd): fstat(2) can fail with other than
	  EBADF.  [ruby-dev:44837] [Bug #5593].  Cf.
	  http://pubs.opengroup.org/onlinepubs/9699919799/functions/fstat.html

	* io.c (rb_sysopen): max fd is updated in rb_sysopen_internal()
	  already.

Wed Nov  9 22:13:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_file.rb (TestFile#test_utime_with_minus_time_segv):
	  fixed previous commit.

Wed Nov  9 19:53:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_file.rb (TestFile#test_utime_with_minus_time_segv):
	  add test for r33685.

Wed Nov  9 19:00:44 2011  Koichi Sasada  <ko1@atdot.net>

	* test/ruby/test_fiber.rb: add tests for r33684 (Fiber#resume).

Wed Nov  9 16:40:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (unixtime_to_filetime): should check the return value
	  of localtime().  reported by snowjail at gmail.com.
	  [ruby-dev:44838] [Bug #5596]

Thu Nov  9 13:17:25 2011  Koichi Sasada  <ko1@atdot.net>

	* cont.c (rb_fiber_m_transfer, rb_fiber_resume): prohibit using
	  "resume" after "transfer" method are used.  You should not mix
	  "resume" fiber and "transfer" fiber.
	  [Bug #5526]

	* NEWS: add information about this change.

Wed Nov  9 11:40:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* template/Doxyfile.tmpl (INCLUDE_PATH): add srcdir and include.
	  [ruby-core:40843] [Bug #5597]

Wed Nov  9 11:02:54 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* thread.c (do_select): fix cast, tv_sec is time_t.

Wed Nov  9 10:32:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: should not use test -e for portability.
	  [ruby-core:40841] [Bug #5594]

Wed Nov  9 04:52:16 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/tree_builder.rb: dump complex numbers,
	  rationals, etc with reference ids.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: ditto
	* ext/psych/lib/psych/visitors/to_ruby.rb: loading complex numbers,
	  rationals, etc with reference ids.
	* test/psych/test_object_references.rb: corresponding tests

Tue Nov  8 23:34:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dbm/dbm.c (fdbm_fetch, fdbm_key, fdbm_delete, fdbm_store)
	  (fdbm_has_key, fdbm_has_value): get rid of overflow.

	* ext/gdbm/gdbm.c (rb_gdbm_fetch2, rb_gdbm_nextkey)
	  (rb_gdbm_delete, fgdbm_store, fgdbm_has_key): ditto.

	* ext/dbm/dbm.c (fdbm_delete_if): hide intermediate objects.

	* ext/gdbm/gdbm.c (fgdbm_delete_if): ditto.

	* ext/dbm/extconf.rb: check size of datum.dsize to get rid of
	  overflow.

Tue Nov  8 23:30:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* addr2line.c (PATH_MAX): define if not defined. [ruby-core:40840]

Tue Nov  8 23:26:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/tk/tcltklib.c (rb_thread_critical): fix type.

	* ext/tk/tcltklib.c (eventloop_sleep, lib_eventloop_core): int is
	  enough for micro seconds.  may need to check overflow in the
	  setter though.

	* ext/tk/tcltklib.c (RSTRING_LENINT): check overflow if necessary.

	* ext/tk/tcltklib.c (RbTk_ALLOC_N): wrapper for ckalloc() which
	  takes an int.

	* ext/tk/tcltklib.c (ip_ruby_cmd_receiver_get, tcltklib_compile_info):
	  get rid overflow.

	* ext/tk/tcltklib.c (tcltklib_compile_info): constified.

Tue Nov  8 20:50:45 2011  Tanaka Akira  <akr@fsij.org>

	* test/dbm/test_dbm.rb: split tests for read only database.

	* test/gdbm/test_gdbm.rb: ditto.

Tue Nov  8 18:59:07 2011  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (MasterDevice): define only when used.
	  (SlaveDevice): ditto.
	  (deviceNo): ditto.

Tue Nov  8 17:59:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/ruby.h (rb_long2int): define as a macro always, so
	  that cpp conditionals can tell if it is provided.

Tue Nov  8 17:30:50 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (cpp_command): remove multiple -arch flags since cpp
	  cannot work.

Tue Nov  8 14:50:55 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_fwrite): call rb_w32_write_console() only if FMODE_TTY is
	  set.  this is the one of the reason of IO writing slowness of Windows
	  in 1.9.3 or later.

Tue Nov  8 11:01:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/pty/pty.c (get_device_once): FreeBSD 8 supported O_CLOEXEC flag
	  for posix_openpt, but FreeBSD 9's posix_openpt doesn't support
	  O_CLOEXEC and fails if specified.

Tue Nov  8 02:36:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* include/ruby/encoding.h (ECONV_NEWLINE_DECORATOR_READ_MASK,
	  ECONV_NEWLINE_DECORATOR_WRITE_MASK): new macro.

	* io.c (rb_io_extract_modeenc, pipe_open, prep_stdio, argf_next_argv):
	  set TEXTMODE_NEWLINE_DECORATOR_ON_WRITE for textmode on creating IO
	  if the flag is available.

	* io.c (make_writeconv): drop decorators for reading.

	* io.c (make_readconv): drop decorators for writing.

	* io.c (do_writeconv): existing writeconv is not the condition to raise
	  ArgumentError.  should check textmode or not.

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_{cr,lf,crlf}_decorator_on_stdout): test above
	  changes.

Mon Nov  7 22:03:47 2011  Tanaka Akira  <akr@fsij.org>

	* ext/gdbm/gdbm.c (fgdbm_initialize): set close-on-exec flag.

Mon Nov  7 20:31:52 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: make sure strings that look
	  like base 60 numbers are serialized as quoted strings.
	* test/psych/test_string.rb: test for change.

Mon Nov  7 20:26:37 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/psych/test_yamlstore.rb: make test case inherit from MiniTest,
	  load psych/helper so that psych is loaded.

Mon Nov  7 20:18:29 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* test/psych/test_yamldbm.rb: Test case should inherit from MiniTest,
	  load psych/helper so that psych and friends are loaded.

Mon Nov  7 20:15:44 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/extconf.rb: check dbm_pagfno() and dbm_dirfno().

	* ext/dbm/dbm.c: use above to set close-on-exec flag.

Mon Nov  7 20:05:16 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (io_fflush): remove fsync().

	* io.c (rb_io_flush, rb_io_rewind): fsync() here.

	these changes reduces fsync() calls to improve performance.
	first reported at [ruby-list:48515] by ak7 at mail.goo.ne.jp .
	[Bug #5585]

Mon Nov  7 19:43:10 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_close_before_exec): use F_MAXFD if available.
	  F_MAXFD is available on NetBSD since NetBSD 2.0.

Mon Nov  7 19:25:16 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb
	  (TestIO_M17N#test_default_stdout_stderr_mode): new test for
	  r33627-33629.  see [backport #5565]

Mon Nov  7 01:14:22 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/debug.rb: add help for 'pp' and 'r[estart]'. patch
	  from Sho Hashimoto. [Bug #5093] [ruby-dev:44222]

Sun Nov  6 14:49:58 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/rubysocket.h (rsock_recvmsg): declared.

	* ext/socket/ancdata.c (rsock_recvmsg): extracted from
	  nogvl_recvmsg_func.
	  (nogvl_recvmsg_func): use rsock_recvmsg.

	* ext/socket/unixsocket.c (recvmsg_blocking): use rsock_recvmsg.

Sun Nov  6 03:22:36 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_engine.rb: add test for engine cipher. RC4 is used
	  because AES is not supported by the "openssl" engine currently.

Sun Nov  6 00:11:52 2011  Tanaka Akira  <akr@fsij.org>

	* lib/test/unit.rb (Test::Unit::Options#non_options): options[:ruby]
	  should be an array.  This fixes
	  "./ruby test/runner.rb test/testunit/test_parallel.rb"
	  [ruby-dev:44782]

Sat Nov  5 20:30:30 2011  Martin Duerst  <duerst@it.aoyama.ac.jp>

	* insns.def: Some fixes and tweaks to English explanations

Sat Nov  5 19:11:50 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_cloexec_fcntl_dupfd): don't clear try_dupfd_cloexec if
	  fcntl(F_DUPFD) failed as fcntl(F_DUPFD_CLOEXEC).

Sat Nov  5 18:05:12 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_socketpair0): refactored.

Sat Nov  5 17:55:52 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (rsock_socket0): don't clear try_sock_cloexec if
	  SOCK_CLOEXEC is not a reason for EINVAL.

Sat Nov  5 16:27:52 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* ext/pathname/lib/pathname.rb, ext/tk/lib/multi-tk.rb,
	  ext/tk/sample/demos-en/widget, lib/benchmark.rb, lib/irb/cmd/fork.rb,
	  lib/mkmf.rb, lib/net/ftp.rb, lib/net/smtp.rb, lib/open3.rb,
	  lib/pstore.rb, lib/rexml/element.rb, lib/rexml/light/node.rb,
	  lib/rinda/tuplespace.rb, lib/rss/maker/base.rb,
	  lib/rss/maker/entry.rb, lib/scanf.rb, lib/set.rb, lib/shell.rb,
	  lib/shell/command-processor.rb, lib/shell/process-controller.rb,
	  lib/shell/system-command.rb, lib/uri/common.rb: remove unused block
	  arguments to avoid creating Proc objects.

Sat Nov  5 15:45:04 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (rsock_socket0): extract single socket() call with
	  CLOEXEC handling from rsock_socket.

Sat Nov  5 13:49:40 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* lib/pathname.rb (Pathname#find): return an enumerator if
	  no block is given.

	* test/pathname/test_pathname.rb: add tests for above.

	[ruby-dev:44797] [Feature #5572]

Sat Nov  5 11:18:12 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_socketpair0): don't clear
	  try_sock_cloexec if SOCK_CLOEXEC is not a reason for EINVAL.

Fri Nov  4 14:08:19 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_pkey_rsa.c (rsa_generate): [SECURITY] Set RSA
	  exponent value correctly.  Awful bug.  This bug caused exponent of
	  generated key to be always '1'.  By default, and regardless of e
	  given as a parameter.

	  !!! Keys generated by this code (trunk after 2011-09-01) must be
	  re-generated !!! (ruby_1_9_3 is safe)

	* test/openssl/test_pkey_rsa.rb: Add tests for default exponent and
	  specifying exponent by a parameter.

Fri Nov  4 01:31:25 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_engine.rb: add first tests for builtin "openssl"
	  engine.

Fri Nov  4 08:41:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/extconf.rb:
	* ext/openssl/ossl_engine.c: add some missing OpenSSL engines.
	  Thanks, Yui Naruse, for providing the patch!
	  [Bug #5548] [ruby-core:40670]

Fri Nov  4 04:54:10 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/configure.bat: disable delayed expansion of enironment variable.
	  [Bug #5517] [ruby-core:40531]

Fri Nov  4 03:45:22 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (make_writeconv): fixed typo of previous commit.

Fri Nov  4 01:56:30 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (make_writeconv): unversal_newline converter is for reading.
	  so, if the io is text mode and has ECONV_UNIVERSAL_NEWLINE_DECORATOR
	  flag, use crlf_newline converter for writing.
	  this change fixes the problem about the luck of CR up Kernel.p and
	  Kernel.puts to stdout/stderr on Windows.

Fri Nov  4 01:04:48 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (Init_readline): like r18313, libedit's
	  replace_history_entry may use offset instead of which.
	  so introduce history_replace_offset_func and initialize it.

	* ext/readline/readline.c (hist_set): use history_replace_offset_func.

Fri Nov  4 00:53:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/readline/readline.c (Init_readline): fix wrong condition.

Thu Nov  3 23:53:04 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* encoding.c (rb_locale_charmap): ignore calling nl_langinfo_codeset()
	  on Windows except cygwin. [experimental]

Thu Nov  3 22:45:09 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_socketpair0): extracted from
	  rsock_socketpair to set close-on-exec flag for each socketpair()
	  call.

Thu Nov  3 22:12:41 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/socket/init.c (rsock_socket): set close-on-exec flag when
	  SOCK_CLOEXEC is not available.

Thu Nov  3 08:36:00 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_engine.rb: call Engine::cleanup on exit.
	  Patch provided by Yui Naruse, thanks!
	  [Bug #5547] [ruby-core:40669]

Wed Nov  2 21:36:00 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* complex.c (nucomp_rationalize): fix function.  [ruby-core:40667]
	  [Bug #5546]

Wed Nov  2 08:16:45 2011  Tanaka Akira  <akr@fsij.org>

	* lib/webrick/utils.rb: fix fcntl call.

	* lib/drb/unix.rb: ditto.

Wed Nov  2 00:43:59 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/psych/test_yamldbm.rb: avoid platform dependency.
	  patch by Naohisa Goto. [ruby-dev:44763] [Bug #5535]
	* test/syck/test_yamldbm.rb: ditto.

Wed Nov  2 00:14:15 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* test/ruby/test_marshal.rb: renamed methods duplicated with those
	  of marshaltestlib.rb.

Tue Nov  1 22:08:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: reject llvm-gcc.

Tue Nov  1 21:39:00 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_cloexec_pipe): remove workaround of r33587.
	  The bug of NetBSD is fixed on Mon Oct 31 21:31:29 UTC 2011.
	  http://gnats.netbsd.org/cgi-bin/query-pr-single.pl?number=45545

Tue Nov  1 19:49:08 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_reopen): call rb_fd_fix_cloexec instead of
	  rb_maygvl_fd_fix_cloexec.

Tue Nov  1 19:00:30 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_io_reopen): call rb_maygvl_fd_fix_cloexec after freopen().

Tue Nov  1 17:17:26 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* file.c (file_expand_path): reset coderange after expanding path.

Tue Nov  1 14:55:29 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (nogvl_io_cntl): rb_cloexec_fcntl_dupfd's 2nd argument is int.

	* process.c (move_fds_to_avoid_crash): ditto.

Tue Nov  1 13:14:33 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vsnprintf.c (BSD_vfprintf): support 'll' prefix.

	* vsnprintf.c (__sfeof): rename to avoid the collision with NetBSD's
	  one.

	* vsnprintf.c (__sferror): ditto.

	* vsnprintf.c (__sclearerr): ditto.

	* vsnprintf.c (__sfileno): ditto.

Tue Nov  1 12:36:16 2011  Tanaka Akira  <akr@fsij.org>

	* internal.h (rb_maygvl_fd_fix_cloexec): change the visibility for
	  ext/socket.

Tue Nov  1 12:00:53 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_maygvl_fd_fix_cloexec): renamed from fd_set_cloexec.

	* internal.h (rb_maygvl_fd_fix_cloexec): declared.

	* ext/socket/init.c (cloexec_accept): use rb_maygvl_fd_fix_cloexec.
	  (rsock_s_accept_nonblock): use rb_update_max_fd.
	  (rsock_s_accept): use rb_update_max_fd.

Tue Nov  1 08:24:40 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (cloexec_accept): new function to use accept4 if
	  available.
	  (rsock_s_accept_nonblock): use cloexec_accept.
	  (accept_blocking): ditto.

	* ext/socket/extconf.rb: check accept4.

Tue Nov  1 07:31:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (nogvl_recvmsg_func): use MSG_CMSG_CLOEXEC if
	  available.

	* ext/socket/unixsocket.c (recvmsg_blocking): ditto.

Tue Nov  1 05:59:41 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_socketpair): use SOCK_CLOEXEC if
	  available.

Tue Nov  1 02:56:17 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ruby.c (load_file_internal): convert the encoding of load path if
	  needed by platform.  calling open() was replaced by rb_cloexec_open()
	  at r33549, but the function expected UTF-8 pathname on Windows.
	  (open() expected "locale" pathname.)
	  reported by taco via IRC.

	* ruby.c (load_file): change the type of the 2nd parameter to pass its
	  encoding to load_file_internal().

	* ruby.c (process_options, rb_load_file): follow above change.
	  NOTE: we should pass encoding information to rb_load_file().

Mon Oct 31 23:49:38 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/socket.c (rsock_socketpair): extracted from
	  rsock_sock_s_socketpair.

Mon Oct 31 23:31:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/init.c (rsock_socket): use SOCK_CLOEXEC if available.

Mon Oct 31 21:47:44 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_cloexec_pipe): NetBSD 6.0 will support pipe2(2),
	  but its return value is -1 or larger than 0.

Mon Oct 31 22:04:54 2011  Tanaka Akira  <akr@fsij.org>

	* ext/dbm/dbm.c (fdbm_initialize): use O_CLOEXEC if available.

Mon Oct 31 21:47:48 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_fd_fix_cloexec): renamed from
	  rb_fd_set_cloexec.

	* io.c: follow the above renaming.

	* ext/pty/pty.c: ditto.

	* ext/socket/init.c: ditto.

	* ext/socket/socket.c: ditto.

	* ext/socket/ancdata.c: ditto.

	* ext/socket/unixsocket.c: ditto.

Mon Oct 31 21:02:43 2011  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb (Resolv::DNS): retry IO.select for premature wakeup.

Mon Oct 31 20:14:22 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (fd_set_cloexec): clear CLOEXEC flag for standard file
	  descriptors.
	  (rb_cloexec_dup): use rb_cloexec_fcntl_dupfd.
	  (rb_cloexec_fcntl_dupfd): use F_DUPFD_CLOEXEC if available.

Mon Oct 31 19:14:11 2011  Tanaka Akira  <akr@fsij.org>

	* test/resolv/test_dns.rb: don't check maximum slept time.
	  ruby doesn't guarantee the maximum time because it is not a
	  realtime application.

Mon Oct 31 13:10:06 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (setfl): extract from fcntl().

	* win32/win32.c (dupfd): new function to support F_DUPFD. based on a
	  patch written by akr.

	* win32/win32.c (fcntl): use above functions.

	* include/ruby/win32.h (F_DUPFD): define. [experimental]

	* include/ruby/win32.h (F_SETFL): change the value to correspond with
	  other platforms.

Mon Oct 31 12:37:50 2011  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (get_device_once): use O_CLOEXEC for posix_openpt if
	  available.

Mon Oct 31 12:05:24 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_cloexec_dup2): check oldfd == newfd at first.
	  pointed by KOSAKI Motohiro.  [ruby-dev:44713]

Mon Oct 31 10:50:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* io.c (rb_cloexec_fcntl_dupfd): this function needs F_DUPFD.

	* io.c (nogvl_io_cntl): use rb_cloexec_fcntl_dupfd() only if the
	  platform has F_DUPFD.

Mon Oct 31 00:50:00 2011  Luis Lavena  <luislavena@gmail.com>

	* configure.in: check -fno-omit-frame-pointer acceptance and usage
	  under MinGW. [ruby-core:39957] [Bug #5407]

Mon Oct 31 00:16:11 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_cloexec_fcntl_dupfd): declared.

	* io.c (rb_cloexec_fcntl_dupfd): new function.
	  (nogvl_io_cntl): use rb_cloexec_fcntl_dupfd.

	* process.c (move_fds_to_avoid_crash): use rb_cloexec_fcntl_dupfd.

Sun Oct 30 22:46:46 2011  Tanaka Akira  <akr@fsij.org>

	* configure.in: check pipe2.

	* io.c (rb_cloexec_pipe): use pipe2 if available.

Sun Oct 30 22:32:44 2011  Tanaka Akira  <akr@fsij.org>

	* ruby.c (fill_standard_fds): use fstat() instead of fcntl(F_GETFD)
	  for MinGW.  reported by Luis Lavena.  [ruby-core:40526] [Bug #5516]

Sun Oct 30 21:12:47 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_cloexec_pipe): declared.

	* io.c (rb_cloexec_pipe): new function.
	  (rb_pipe): use rb_cloexec_pipe.

	* thread_pthread.c (rb_thread_create_timer_thread): use
	  rb_cloexec_pipe.

Sun Oct 30 20:06:07 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_cloexec_dup): refine control flow.
	  (rb_cloexec_dup2): ditto.

Sun Oct 30 18:45:50 2011  Tanaka Akira  <akr@fsij.org>

	* ruby.c (fill_standard_fds): new function to open closed standard
	  file descriptors.
	  (ruby_sysinit): call fill_standard_fds.

Sun Oct 30 10:50:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (install_recursive, bin-comm): split mere
	  string not path name.  [ruby-core:40462] [Bug #5492]

Sun Oct 30 10:47:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_cloexec_dup, rb_cloexec_dup2): CLOEXEC has been set if
	  dup3 succeeded.

Sun Oct 30 09:58:48 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_cloexec_dup): don't allocate standard file descriptors.

Sun Oct 30 08:29:51 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_cloexec_dup2): don't set CLOEXEC for standard file
	  descriptors.

Sun Oct 30 07:47:10 2011  Tanaka Akira  <akr@fsij.org>

	* configure.in: check dup3.

	* io.c (rb_cloexec_dup2): use dup3 if available.

Sat Oct 29 22:06:37 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_cloexec_dup2): declared.

	* io.c (rb_cloexec_dup2): new function.
	  (io_reopen): use rb_cloexec_dup2.

Sat Oct 20 21:08:18 2011  Tajima Akio <artonx@yahoo.co.jp>

	* win32/Makefile.sub (CONFIG_H): have stdint.h if VC2010.
	  [Bug #5243]

Sat Oct 29 20:59:08 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_cloexec_dup): use F_DUPFD_CLOEXEC if available.

Sat Oct 29 20:00:26 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_cloexec_dup): declared.

	* io.c (rb_cloexec_dup): new function.
	  (ruby_dup): use rb_cloexec_dup.

	* ext/pty/pty.c (pty_getpty): use rb_cloexec_dup.

	* ext/openssl/ossl_bio.c (ossl_obj2bio): ditto.

Sat Oct 29 16:11:34 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c (sdbm_prep): use O_CLOEXEC if available.

Sat Oct 29 14:26:56 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_cloexec_open): use O_CLOEXEC if available.

Sat Oct 29 12:57:15 2011  Tanaka Akira  <akr@fsij.org>

	* process.c (ruby_setsid): use rb_cloexec_open.
	  (rb_daemon): ditto.

	* ruby.c (load_file_internal): ditto.

	* file.c (rb_file_s_truncate): ditto.
	  (file_load_ok): ditto.

	* random.c (fill_random_seed): ditto.

	* ext/pty/pty.c (chfunc): ditto.
	  (get_device_once): ditto.

	* ext/io/console/console.c (console_dev): ditto.

Sat Oct 29 10:40:19 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_cloexec_open): declared.

	* io.c (fd_set_cloexec): extracted from rb_fd_set_cloexec.
	  (rb_cloexec_open): new function.
	  (sysopen_func): use rb_cloexec_open.
	  (rb_sysopen_internal): use rb_update_max_fd instead of
	  rb_fd_set_cloexec.

Sat Oct 29 09:05:07 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread_pthread.h: no Structured Exception Handling like macros.
	  [ruby-core:40432] [Bug #5491]

Fri Oct 28 22:05:34 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c: RCS $Id$ removed.

Thu Oct 27 18:58:00 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (parser_nextc): set encoding for the buffer of ripper.

Fri Oct 28 06:06:08 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c (sdbm_prep): set FD_CLOEXEC flags for file
	  descriptors.
	  (fd_set_cloexec): new function.

Fri Oct 28 03:01:27 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* vm_insnhelper.c (vm_call_cfunc): adding back useless hack.  For some
	  reason, this fixes CFP errors on OS X 10.7.

Fri Oct 28 00:09:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/sdbm/_sdbm.c (sdbm_prep): refactored for less nesting.

Thu Oct 27 18:28:18 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_DEFINE_IF): revert r33534 partially to get
	  rid of AS_ECHO which is not available in autoconf 2.61.
	  [ruby-dev:44702]

Thu Oct 27 16:10:46 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* bignum.c (rb_big_divide): raise ZeroDivisionError if divisor is
	  zero, as well as Fixnum.  [ruby-core:40429] [Bug #5490]

Thu Oct 27 14:56:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_FUNC_ATTRIBUTE): unset temporary variable.

	* configure.in (RUBY_STACK_GROW_DIRECTION): substitute CPU name as
	  shell variable name.  based on the patch by The Written Word Inc. at
	  [ruby-core:40421].  [Bug #5488]

Thu Oct 27 09:57:56 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/ruby.h (SIZE_MAX): define SIZE_MAX if not defined.
	  patched by The Written Word Inc. [ruby-core:40422] [Bug #5489]

Thu Oct 27 08:47:38 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/psych/parser.c: remove unused variable.

Thu Oct 27 08:38:41 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/extconf.rb: add -Wall flag by default when compiler is
	  GCC.

Wed Oct 26 15:24:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* file.c (rb_file_join): honor input encodings than ASCII-8BIT.
	  [ruby-core:40338] [Bug #5483]

Tue Oct 25 21:52:31 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/defines.h: use "__sparc" instead of "sparc" and
	  "__sparc__".

	* dln.c: ditto.

	  [ruby-dev:44694]

Tue Oct 25 06:34:39 2011  Eric Hodel  <drbrain@segment7.net>

	* re.c (match_aref):  Use <code> around indexing examples to prevent
	  hyperlinks.  [ruby-talk:389396]

Mon Oct 24 23:55:31 2011  Tanaka Akira  <akr@fsij.org>

	* complex.c: use "__sun" instead of "__sun__" to detect SunOS.

	* math.c: ditto.

	* hash.c: ditto.

	* atomic.h: ditto.

	* ext/io/wait/wait.c: ditto.

	[ruby-dev:44693]

Mon Oct 24 22:45:37 2011  Tanaka Akira  <akr@fsij.org>

	* io.c: use "__sun" instead of "sun" to detect SunOS.

	* dln.c: ditto.

	* cont.c: ditto.

	* ext/sdbm/_sdbm.c: ditto.

	[ruby-dev:44693]

Mon Oct 24 22:38:08 2011  Tanaka Akira  <akr@fsij.org>

	* ext/pty/pty.c (get_device_once): delay rb_fd_set_cloexec() until
	  grantpt() on Solaris.  grantpt() doesn't work with CLOEXEC on
	  Solaris 10.
	  reported by Naohisa GOTO.  [ruby-dev:44688] [Bug #5475]

Mon Oct 24 08:18:14 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (copy_stream_fallback_body): check nil for EOF of read method.
	  patch by Eric Wong.  [ruby-core:39134] [Bug #5237]

Sun Oct 23 18:21:23 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* ext/tk/MANUAL_tcltklib.eng: fix typo.

Sun Oct 23 18:03:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (rb_infinity, rb_nan): aggregated member initializers
	  need braces.

Sun Oct 23 16:43:43 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* ext/io/wait/wait.c: ioctl(2) is declared in unistd.h on Solaris.

Sun Oct 23 16:33:35 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* ext/tk/MANUAL_tcltklib.eng: fix typo. reported by Mimura-san.
	  [ruby-dev:44683] [Bug #5471]

Sun Oct 23 08:01:29 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_fd_set_cloexec): set close-on-exec flag only if F_GETFD is
	  defined.  reported by Luis Lavena.  [ruby-core:40281] [Bug #5470]

Sat Oct 22 19:48:50 2011  Tanaka Akira  <akr@fsij.org>

	* test/openssl/test_ssl.rb (test_multibyte_read_write): start server
	  for each length to avoid race condition.

Sat Oct 22 18:49:24 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_fd_set_cloexec): declared.

	* io.c (rb_fd_set_cloexec): new function.
	  (ruby_dup): call rb_fd_set_cloexec to set close-on-exec flag.
	  (rb_sysopen_internal): ditto.
	  (rb_pipe): ditto.
	  (io_reopen): ditto.
	  (io_cntl): ditto.

	* process.c (rb_f_exec): change the default :close_others option to
	  true.
	  (rb_f_system): ditto.
	  (move_fds_to_avoid_crash): call rb_fd_set_cloexec to set
	  close-on-exec flag.
	  (ruby_setsid): ditto.
	  (rb_daemon): ditto.

	* thread_pthread.c (rb_thread_create_timer_thread): call
	  rb_fd_set_cloexec to set close-on-exec flag.

	* ruby.c (load_file_internal): ditto.

	* file.c (rb_file_s_truncate): ditto.
	  (file_load_ok): ditto.

	* random.c (fill_random_seed): ditto.

	* ext/pty/pty.c (chfunc): ditto.
	  (get_device_once): ditto.

	* ext/openssl/ossl_bio.c (ossl_obj2bio): ditto.

	* ext/socket/init.c (rsock_socket): ditto.
	  (rsock_s_accept_nonblock): ditto.
	  (rsock_s_accept): ditto.

	* ext/socket/socket.c (rsock_sock_s_socketpair): ditto.

	* ext/socket/ancdata.c (discard_cmsg): ditto.
	  (make_io_for_unix_rights): ditto.

	* ext/socket/unixsocket.c (unix_recv_io): ditto.

	* ext/io/console/console.c (console_dev): ditto.

	[ruby-core:38140] [Feature #5041]

Sat Oct 22 17:46:27 2011  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: fix a exception name in previous patch.

Sat Oct 22 17:43:33 2011  Tanaka Akira  <akr@fsij.org>

	* lib/resolv.rb: make timeout configurable for DNS query.
	  patch by Eric Wong.  [ruby-core:38533] [Feature #5100]

Sat Oct 22 02:07:48 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* numeric.c (rb_infinity, rb_nan): use union to prevent bus error
	  caused by misalignment.  [Bug #5469] [ruby-dev:44657]

	* include/ruby/missing.h (INFINITY, NAN): ditto

Fri Oct 21 22:02:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (initial_params): pack in a struct.

	* gc.c (rb_gc_set_params): set parameters always.
	  [ruby-dev:44648] [Bug #5467]

Fri Oct 21 12:10:20 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* atomic.h: change Solaris checking macro because atomic_ops can work
	  not only with Sun Studio but also with Fujitsu C Compiler.

Fri Oct 21 02:11:00 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ns_spki.c: Complete documentation.
	* test/openssl/test_ns_spki.rb: Integrate SPKI#to_text.

Thu Oct 20 22:47:28 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (socklist_insert, socklist_lookup, socklist_delete):
	  new functions to wrap of st_insert(), st_lookup() and st_delete() to
	  socklist.
	  allocating socklist is deferred until it is really needed.

	* win32/win32.c (exit_handler): delete socklist only if it is
	  initialized.

	* win32/win32.c (rb_w32_sysinit, StartSockets): refactoring: move
	  initialization of select_mutex to StartSockets().

	* win32/win32.c (exit_handler): refactoring: delete select_mutex only
	  if winsock is used.

Thu Oct 20 22:38:53 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkcs5.c: add note on timing attacks and general
	  documentation.

Thu Oct 20 21:19:15 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* vm_eval.c (check_funcall): set array elements one-by-one to fix
	  compile error with Fujitsu C Compiler 5.6 on Solaris 10 on Sparc.
	  [Bug #5464] [ruby-dev:44632]

Thu Oct 20 13:09:35 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/defines.h (flush_register_windows): use software
	  trap on Debian Sparc 32-bit userspace.  [Bug #5244]

Thu Oct 20 12:28:22 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkcs5.rb: add RFC 6070 tests for PBKDF2 with
	  HMAC-SHA1

Thu Oct 20 11:42:23 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* util.c (mmprepare): fix for fragmental size.

	* util.c (mmswap_, mmrot3_): portability improvement.

Thu Oct 20 05:58:02 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_ns_spki.c (Init_ossl_ns_spki):  Stub documentation
	  for Netscape SPKI.

Thu Oct 20 05:13:39 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*: Imported minitest 2.6.2 (r6712)
	* test/minitest/*: ditto

Thu Oct 20 06:55:32 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* lib/openssl/buffering.rb: Force multi-byte strings to be treated as
	  binary data.
	* test/openssl/test_ssl.rb: Add test for it.

	Thanks to Niklas Baumstark for reporting the issue!

	[Ruby 1.9 - Bug #5233] [ruby-core:39120]

Wed Oct 19 17:06:54 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* version.h (RUBY_VERSION): finally declare start of 2.0 work!

Wed Oct 19 11:48:44 2011  Eric Hodel  <drbrain@segment7.net>

	* error.c (Init_Exception):  Document $! and $@.  Provide
	  recommendations for creating exceptions for a library.

Wed Oct 19 11:25:46 2011  Eric Hodel  <drbrain@segment7.net>

	* error.c (Init_Exception):  Add hierarchy of Exception subclasses.
	  Based on patch by Sylvain Daubert.  [Ruby 1.9 - Bug #5438]

Wed Oct 19 11:04:47 2011  Eric Hodel  <drbrain@segment7.net>

	* enum.c: Reformat block args to a single standard, { |args| ... }.
	  Patch by b t.  [Ruby 1.9 - Bug #5393]

Wed Oct 19 12:11:26 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ssl.c: Remove set, but unused variables.
	  ext/openssl/ossl_pkey.c: ditto

	* ext/openssl/ossl_pkey_dh.c: Make functions passed to
	  rb_thread_blocking_region return VALUE instead of void.
	  ext/openssl/ossl_pkey_dsa.c: ditto
	  ext/openssl/ossl_pkey_rsa.c: ditto

Tue Oct 18 23:28:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (identhash): share with type_numhash.

	* st.c (st_hashtype_num): rename from type_numhash.

Tue Oct 18 23:07:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_core.h (ruby_current_thread): probeprofiler has been removed
	  long ago.

Tue Oct 18 23:05:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/ripper/eventids2.c (ripper_init_eventids2): separate
	  initializations of IDs and objects.

	* ext/ripper/tools/generate.rb (generate_eventids1): ditto.

	* parse.y (Init_ripper, InitVM_ripper): fix inversed roles.

Sun Oct 16 19:46:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/bigdecimal/bigdecimal.gemspec (files): fixed typo, and
	  removed nonexistent file.

	* ext/bigdecimal/bigdecimal.gemspec (homepage): added.

	* ext/io/console/io-console.gemspec (homepage): ditto.

Fri Oct 14 12:13:57 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/pty/pty.c (pty_check): should return nil until the child
	  terminates or stops.  [ruby-dev:44600] [Bug #2642]

Fri Oct 14 11:19:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* include/ruby/intern.h (rb_ary_rotate): export.

Fri Oct 14 05:58:05 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* atomic.h (ATOMIC_INC, ATOMIC_DEC): return old values.
	  [ruby-dev:44596] [Bug #5439]

	* signal.c (ruby_atomic_exchange): no needs to define on the
	  platforms where atomic.h is available.

Thu Oct 13 19:29:40 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* atomic.h (ATOMIC_*): use atomic_ops(3C) when SunStudio on Solaris.
	  [ruby-dev:44596] [Bug #5439]

Thu Oct 13 18:13:04 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* atomic.h(ATOMIC_SET): add cast to void to prevent misuse.
	  [ruby-dev:44596] [Bug #5439]

Thu Oct 13 18:04:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (rb_gc_finalize_deferred, rb_objspace_call_finalizer):
	  should use ATOMIC_EXCHANGE() to check the previous value.
	  [ruby-dev:44596] [Bug #5439]

Wed Oct 12 23:39:58 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* test/openssl/test_ssl.rb: Move duplicated tests for SSL::Session to
	  test_ssl_session.rb

Tue Oct 11 08:49:40 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c (rb_ary_initialize):  Improve explanation of Array.new
	  parameters.  Patch by Alvaro Pereyra Rabanal.  [Ruby 1.9 - Bug #5425]
	* array.c (rb_ary_s_try_convert):  Fix typo (try => tries)
	* array.c (rb_ary_rindex):  Add spacing for block.
	* array.c (rb_ary_uniq_bang):  Describe block
	* array.c (rb_ary_uniq):  ditto

Tue Oct 11 07:55:38 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c:  Add a description to Array, minor cleanups.  Patch by
	  Andrea Singh.  [Ruby 1.9 - Bug #5412]

Tue Oct 11 06:09:52 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/pp.rb:  Move PP documentation to top of class PP.  Patch by
	  Sylvain Daubert.  [Ruby 1.9 - Bug #5430]

Tue Oct 11 06:06:29 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/coverage/coverage.c (Init_coverage):  Change list format and
	  describe Coverage.result output.  Patch by Sylvain Daubert.
	  [Ruby 1.9 - Bug #5428]

Tue Oct 11 05:53:23 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c (Init_Object):  Add reference to BasicObject, brief
	  explanation of constant lookup.  Based on patch by Alvaro Pereyra
	  Rabanal.
	  [Ruby 1.9 - Bug #5426]

Sun Oct  9 11:06:52 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* test/psych/test_yamldbm.rb: don't run test if the system
	  don't support yaml/dbm.

	* test/syck/test_yamldbm.rb: ditto.

Sat Oct  8 08:54:56 2011  Eric Hodel  <drbrain@segment7.net>

	* enum.c (group_by):  Improve group_by description.  Patch by b t.
	  [#5411]

Sat Oct  8 03:17:51 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/shell.rb:  Document some methods of Shell.  Patch by Carol
	  Nichols.  [Ruby 1.9 - Bug #5417]

Fri Oct  7 17:54:28 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/test/unit/assertions.rb (assert_send, assert_not_send):
	  parenthesize non-empty arguments.

Fri Oct  7 06:35:50 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c:  Use + for arguments described in documentation to allow
	  rdoc -C2 to work better.  Remove <code> from method references to
	  allow cross-references in HTML documentation.

Thu Oct  6 18:46:23 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* vm_eval.c (make_no_method_exception): fix typo.

	* vm_insnhelper.c, vm_insnhelper.h: ditto.

Thu Oct  6 16:29:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (make_no_method_execption): extract from
	  raise_method_missing().

	* vm_eval.c (send_internal): remove inadvertent symbol creation
	  from public_send.  based on a patch by Jeremy Evans <code AT
	  jeremyevans.net> in [ruby-core:38576]. [Feature #5112]

	* vm_insnhelper.c (vm_call_method): remove inadvertent symbol
	  creation from send and __send__, too.

Thu Oct  6 14:59:11 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/time.rb:  Clean up Time documentation.  Patch by Jake Goulding.
	  [Ruby 1.9 - Bug #5416]

Thu Oct  6 10:00:54 2011  Eric Hodel  <drbrain@segment7.net>

	* enum.c (group_by):  Improve documentation based on patch by b t.

Thu Oct  6 09:56:30 2011  Eric Hodel  <drbrain@segment7.net>

	* enum.c:  Clean up wording in Enumerable documentation.  Patch by b t.
	  [Ruby 1.9 - Bug #5411]

Thu Oct  6 09:17:18 2011  Eric Hodel  <drbrain@segment7.net>

	* time.c (Init_Time):  Remove editorial comments from Time
	  documentation, fix link.

Thu Oct  6 09:14:20 2011  Eric Hodel  <drbrain@segment7.net>

	* time.c (Init_Time):  Improve Time documentation.  Patch by Shane
	  Emmons.  [Ruby 1.9 - Bug #5404]
	* lib/time.rb:  Improve time.rb documentation including Time.strptime.
	  Patch by Shane Emmons.  [Ruby 1.9 - Bug #5402]

Thu Oct  6 08:54:05 2011  Eric Hodel  <drbrain@segment7.net>

	* random.c:  Improve documentation of Random.  Patch by Gregory
	  Parkhurst.  [Ruby 1.9 - Bug #5410]

Thu Oct  6 01:44:51 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* cont.c (cont_mark): mark original Thread object from saved_thread.
	  [ruby-dev:44571] [Bug #5386]

Wed Oct  5 16:33:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* vm_insnhelper.c (vm_call_cfunc): remove useless hack.

Wed Oct  5 05:56:39 2011  Eric Hodel  <drbrain@segment7.net>

	* hash.c (Init_Hash):  Improve Hash documentation.  Patch by Alvaro
	  Pereyra Rabanal.  [Ruby 1.9 - Bug #5405]

Wed Oct  5 05:47:59 2011  Eric Hodel  <drbrain@segment7.net>

	* random.c (Init_Random):  Add a top-level comment for Random.  Patch
	  by Brett Bim.  [Ruby 1.9 - Bug #5403]

Wed Oct  5 02:50:27 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/syntax_error.rb: Add file, line, offset, and
	  message attributes during parse failure.
	* ext/psych/parser.c: Update parser to raise exception with correct
	  values.
	* test/psych/test_exception.rb: corresponding tests.

Wed Oct  5 01:52:16 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/parser.c (parse): Use context_mark for indicating error
	  line and column.

Wed Oct  5 01:22:08 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: use normal begin / rescue
	  since postfix rescue cannot receive the exception class. Thanks
	  nagachika!

Tue Oct  4 21:10:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* class.c (class_alloc): allocate extra memory after containing
	  object setup to get rid of rare-but-potential memory leak.

	* gc.c (gc_mark_children): skip marking extended members if ptr is
	  NULL.

Tue Oct  4 16:17:50 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/time.rb (Time.strptime): use Time.at if d[:seconds] is set.
	  Reported by Christopher Eberz. [ruby-core:39903] Bug #5399

Tue Oct  4 11:44:10 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (rb_gc_set_params): ruby_verbose can be Qnil, so use RTEST.

Tue Oct  4 08:33:41 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/etc/etc.c:  Document Etc, Etc.sysconfdir, Etc.systmpdir.  Patch
	  by mathew murphy.  [Ruby 1.9 - Bug #5396]

Tue Oct  4 08:21:51 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/shellwords.rb:  Update toplevel comment with an example.  Patch
	  by Samnang Chhun.  [Ruby 1.9 - Bug #5388]

Tue Oct  4 08:15:50 2011  Eric Hodel  <drbrain@segment7.net>

	* proc.c (proc_call):  Update documentation to match argument handling
	  of proc/Proc.new/lambda/->()

Tue Oct  4 07:59:16 2011  Eric Hodel  <drbrain@segment7.net>

	* proc.c (proc_call):  Fix documentation of Proc#call vs Proc#===.
	  [Ruby 1.9 - Bug #5349]

Tue Oct  4 07:43:18 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c (rb_ary_initialize):  Make Array.new description match
	  call-seq.  Patch by Henry Maddocks.  [Ruby 1.9 - Bug #5344]

Tue Oct  4 07:35:23 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c (rb_ary_initialize):  Add output for examples.  Patch by
	  Jonathan Mukai.  [Ruby 1.9 - Bug #5216]

Tue Oct  4 07:30:50 2011  Eric Hodel  <drbrain@segment7.net>

	* array.c (rb_ary_s_create):  Add example results for Array::[].  Patch
	  by Jonathan Mukai.  [Ruby 1.9 - Bug #5215]

Tue Oct  4 07:15:17 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Update to RubyGems 1.8.11.  Move Deprecate into the
	  Gem namespace.

Tue Oct  4 06:43:47 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: update psych version.
	* ext/psych/psych.gemspec: generate new gemspec for new version.

Tue Oct  4 06:29:55 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: calling `yaml` rather than `to_yaml`.
	* ext/psych/lib/psych/nodes/node.rb: Rename `to_yaml` to just `yaml`
	  in order to avoid YAML::ENGINE switching from replacing this method.
	* test/psych/helper.rb: fix tests for method name change.
	* test/psych/test_document.rb: ditto
	* test/psych/visitors/test_emitter.rb: ditto

Tue Oct  4 06:20:19 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: Match values against the
	  floating point spec defined in YAML to avoid erroneous parses.
	* test/psych/test_numeric.rb: corresponding test.

Tue Oct  4 05:59:24 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: ToRuby visitor can be
	  constructed with a ScalarScanner.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: ScalarScanner can be
	  passed to the YAMLTree visitor.

Tue Oct  4 05:47:23 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/to_ruby.rb: Define Regexp::NOENCODING
	  for 1.9.2 backwards compatibility.
	* ext/psych/lib/psych/visitors/yaml_tree.rb: Fix Date string
	  generation for 1.9.2 backwards compatibility.

Mon Oct  3 23:56:39 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (rb_gc_set_params): output GC parameter change messages only
	  if -w/-v options are specified. these messages are output to stderr,
	  not to stdout. [ruby-core:39795] [Bug #5380]

	* test/ruby/test_gc.rb (test_gc_parameter): add test for it.

Sun Oct  2 20:05:32 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c (rb_thread_mark), cont.c (cont_mark): revert r33369 and r33371
	  that may cause SEGV in certain environments.

Sun Oct  2 12:14:06 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/psych/test_yamldbm.rb: add test case.
	* test/syck/test_yamldbm.rb: ditto.

Sun Oct  2 11:28:09 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* lib/yaml/store.rb: make initialize method signature match the
	  superclass signature.

Sun Oct  2 10:44:01 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* io.c: fix documentation of ARGF.lineno=.

Sat Oct  1 20:03:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (have_framework): try as Objective-C.
	  https://twitter.com/nagachika/status/120294447660539904

Sun Oct  2 08:43:25 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c (rb_thread_mark), cont.c (cont_mark): self pointer should not
	  be marked by itself. Patch by Koichi Sasada.
	  [ruby-dev:44567] [Bug #5386]

Sun Oct  2 00:42:14 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c (rb_thread_mark): rb_thread_t needs self to be marked.
	  [ruby-dev:44566] [Bug #5386]

Sat Oct  1 09:48:53 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* gc.c (add_heap_slots, init_heap): reset heaps_inc zero when
	  heap slots are expanded by environment variable RUBY_HEAP_MIN_SLOTS.
	  [ruby-core:39777] [Bug #5380]

	* test/ruby/test_gc.rb (test_gc_parameter): add test for it.

	* test/ruby/envutil.rb (assert_normal_exit): add :child_env option to
	  enable pass environment variables to child process.

Thu Sep 29 13:17:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (ary_join_1): should not copy the encoding of non-string
	  element after string element.  [ruby-core:39776] [Bug #5379]

Thu Sep 29 11:53:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (slot_sweep, rb_gc_finalize_deferred)
	  (rb_objspace_call_finalizer, rb_gc): run finalizers
	  sequentially.  [ruby-dev:44562]

Thu Sep 29 20:37:38 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/gdbm/gdbm.c (rb_gdbm_fatal): adjust argument type.

Thu Sep 29 20:10:42 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (is_id_value, is_live_object): extract from id2ref().

	* gc.c (run_finalizer): use object instead of object id.

Thu Sep 29 20:07:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* use RB_TYPE_P which is optimized for constant types, instead of
	  comparison with TYPE.

Wed Sep 28 09:20:37 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (pthread_np.h): needs pthread.h to be included
	  previously on OpenBSD.  a patch by George Koehler <xkernigh AT
	  netscape.net> at [ruby-core:39752].  [Bug #5376]

Wed Sep 28 04:41:35 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/psych/test_yamlstore.rb: use tmpdir for tmpfile.
	* test/syck/test_yamlstore.rb: ditto.

Wed Sep 28 04:10:46 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* ext/bigdecimal/README: update report to.

Tue Sep 28 04:05:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal_en.html: removed because this file isn't
	  maintained now.

	* ext/bigdecimal/bigdecimal_ja.html: ditto.

Tue Sep 27 09:55:40 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c: make native_fd_select().
	* thread.c (do_select): remove #ifdef _WIN32. Instead, use
	  native_fd_select() always.

Tue Sep 27 09:44:59 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (do_select): remove cygwin specific hack. It's layer
	  violation and too large hack.
	* thread.c (cmp_tv, subtract_tv): removed.

Tue Sep 27 03:50:19 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/rexml/test_sax.rb: add require 'rexml/document'.

Tue Sep 27 03:32:27 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/psych/test_yamldbm.rb: fix #setup and #teardown.
	  [Bug #5370] [ruby-core:39730]
	* test/syck/test_yamldbm.rb: ditto.

Mon Sep 26 11:27:38 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httputils.rb: Add MIME Type definition of .js and .svg.
	  patched by Hal Brodigan. [ruby-core:39704] [Bug #5365]

Mon Sep 26 09:20:44 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: remove DJGPP support. It's not longer supported
	  since ruby 1.9.0.

Mon Sep 26 09:07:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* include/ruby/defines.h: remove NextStep, OpenStep, Rhapsody
	  support. Last activity of their OSes are 7 years ago.
	* configure.in: ditto.
	* dir.c: ditto.
	* ext/tk/extconf.rb: ditto.

Mon Sep 26 09:02:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: remove a code for human68k. it's no longer
	  supported since r19677.

Sun Sep 25 23:43:32 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: fix int_ossl_asn1_decode0_cons when being
	  fed arbitrary string values.
	  Clearly distinguish between the cases "universal, infinite and
	  not a SEQUENCE or SET" and "universal SEQUENCE or SET, possibly
	  infinite". Raise error for universal tags that are not infinite.
	* test/openssl/test_asn1.rb: add a test for this.

	  Thanks to Hiroshi Yoshida for reporting this bug.
	  [Bug #5363] [ruby-dev:44542]

Sun Sep 25 20:57:18 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/syck/test/yamldbm.rb: add test for Syck::DBM.
	* test/psych/test_yamldbm.rb: add test for Psych::DBM.
	* test/psych/test_yamlstore.rb: add test for Psych::PStore.

Sun Sep 25 20:54:10 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/yaml/dbm/dbm.rb: fix #update, add #key for using instead #index.
	  [Bug #5305][ruby-dev:44485]

Sun Sep 25 16:54:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (require_enc): reject only loading from untrusted
	  load paths.  [ruby-dev:44541] [Bug #5279]

	* transcode.c (load_transcoder_entry): ditto.

Sun Sep 25 16:45:05 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in: ignore all warnings from an arbitrary
	  header in /usr/local/include.

Sun Sep 25 03:43:03 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enum.c (slice_before_i): use rb_attr_get to suppress wrong warning
	  for internal instance variable slicebefore_initial_state.

Fri Sep 23 14:20:14 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_asn1.c: remove unused variable.

Fri Sep 23 13:46:59 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_ssl_session.rb: execute test_session_exts_read
	  only for OpenSSL versions >= 0.9.8k. Thanks, Eric Wong, for
	  reporting this.
	  [Bug #4961] [ruby-core:37726]

Fri Sep 23 11:59:08 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_ssl_session.rb: ensure server calls callbacks in
	  test_ctx_server_session_cb. Thanks to Eric Wong for the patch.
	  [Bug #5336] [ruby-core:39619]

Thu Sep 22 02:53:19 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_call_cfunc): suppress a warning.  note that
	  `volatile type *var' doesn't make var itself volatile.

Thu Sep 22 01:52:48 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* thread_pthread.c (ubf_select): activate timer thread when interrupt
	  blocking thread.
	  A patch created by Koichi Sasada. [ruby-core:39634] [Bug #5343]
	  to cover race condition, timer thread periodically send SIGVTARLM to
	  threads in signal thread list. so you should activate timer thread
	  when interrupt a thread.

Wed Sep 21 16:55:26 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/io/wait/test_io_wait.rb (TestIOWait#setup): of course, the
	  behavior of mingw is just same with mswin.

Tue Sep 20 18:08:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_get_cvar_base): reduce duplicated checks and
	  move a warning outside the loop.

Mon Sep 19 18:55:51 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* lib/fileutils.rb (module FileUtils): improve performance of
	  FileUtils.compare_stream. a patch by Masaki Matsushita.
	  [Feature #5337] [ruby-core:39622]

Mon Sep 19 18:42:58 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* test/-ext-/old_thread_select/test_old_thread_select.rb:
	  select() with timeout may return early in old Linux kernels
	  with 250 Hz tickrate and no dynticks, so skip everything older
	  than 2.6.32 (which has long term support).
	  And, Make the timing assertions consistently use assert_operator with
	  timing difference in error message
	  Patch by Eric Wong. [Bug #5335] [ruby-core:39618]

Mon Sep 19 09:28:06 2011  Eric Hodel  <drbrain@segment7.net>

	* test/openssl/test_ssl.rb (class OpenSSL):  Test
	  OpenSSL::SSL::SSLSocket#session and #session=.

Mon Sep 19 07:54:17 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_obj_clone): singleton class should be attached
	  singleton object to.  a patch by Satoshi Shiba <shiba AT rvm.jp>
	  at [ruby-dev:44460].  [Bug #5274]

Sat Sep 17 23:34:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_data_type): inherit the core type in ripper so
	  that checks in core would work.  [ruby-core:39591] [Bug #5331]

Sat Sep 17 12:44:04 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* lib/find.rb (Find.find): add documentation that Find.find
	  without block returns an enumerator.

Thu Sep 15 11:39:43 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (mark_entry, mark_key, mark_keyvalue): adjust callback
	  argument types.

Thu Sep 15 01:44:10 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* ext/tk/*: Change encoding from EUC-JP to UTF-8

Wed Sep 14 11:43:37 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_fd_rcopy): added an argument guard.
	  Patch by NAKAMURA Usaku. [Bug #5306] [ruby-core:39435]

Tue Sep 13 20:21:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/pstore.rb, test/test_pstore.rb: suppress warnings with -v.

	* lib/pstore.rb (PStore): always open in binary mode even if
	  default encodings are set.  [Bug #5311] [ruby-core:39503]

Tue Sep 13 05:37:15 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* io.c (Init_IO): update BINARY comment.  it should not change the
	  encoding of the result to ASCII-8BIT.  [ruby-talk:387719]

Mon Sep 12 19:55:00 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_select): fix to ignore an argument
	  modification of rb_thread_fd_select().
	  based on a patch by Eric Wong. [Bug #5306] [ruby-core:39435]
	* thread.c (rb_fd_rcopy): New. for reverse fd copy.

	* test/-ext-/old_thread_select/test_old_thread_select.rb
	(test_old_select_false_positive): test for bug5306.

	* ext/-test-/old_thread_select/old_thread_select.c (fdset2array):
	  New. convert fdsets to array.
	* ext/-test-/old_thread_select/old_thread_select.c (old_thread_select):
	  return 'read', 'write', 'except' argument of rb_thread_select()
	  to ruby script.

Mon Sep 12 13:38:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* README.EXT, README.EXT.ja (2.2.2), parse.y (rb_check_id): add
	  documents for rb_check_id().

Mon Sep 12 12:53:39 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rake/file_list.rb (Rake::FileList#egrep): there is no need to
	  open files in binary mode.
	  see more details in https://github.com/jimweirich/rake/issues/74

Mon Sep 12 12:42:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_exception.rb (TestException#test_exit_success_p):
	  assert also the cases when exiting with true and false.

	* lib/test/unit/assertions.rb (assert_send): make arguments in
	  the default message clearer.

Sun Sep 11 05:23:14 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/matrix.rb: Deal with subclasses of Matrix [redmine #5307]

Sat Sep 10 13:38:20 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* dir.c (dir_s_aref):
	* dir.c (dir_entries): Two small documentation fixes.
	  A patch from Aaron Lerch. [Bug #5302] [ruby-core:39404]

Sat Sep 10 08:30:03 2011  Koichi Sasada  <ko1@atdot.net>

	* gc.c (GC_PROFILE_MORE_DETAIL, CALC_EXACT_MALLOC_SIZE):
	  define macros only if they are not defined.
	  fixes: [Ruby 1.9 - Feature #5291]

Sat Sep 10 08:25:47 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* parse.y (bv_decls): parse.y relies on $$ = $1 before action
	  routines.  a patch from Michael Edgar.  [Bug #5303]
	  [ruby-core:39429]

Sat Sep 10 01:37:55 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* sample/drb/dhasenc.rb: coding cookie of Emacs is coding,
	  not encoding.

	* sample/mine.rb: ditto.

Fri Sep  9 21:56:40 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_sqrt): Fix comment.
	  BigDecimal#sqrt requires argument. Reported by Makoto Kishimoto.
	  Thanks for your contribution. [Bug #5267] [ruby-dev:44452]

Fri Sep  9 11:00:55 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/rubygems/test_gem_commands_help_command.rb: Add one
	  `require` because if run test-all with test/unit parallel
	  running, sometimes this test fails by some constants not found.
	  The error reason is some worker doesn't require the file needed by
	  this test. This issue is related to [ruby-core:36168].

Fri Sep  9 10:22:03 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* thread.c (rb_thread_select): fix a typo to initialize efds
	  properly.  [Bug #5299] [ruby-core:39380]

Fri Sep  9 02:02:09 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* template/yarvarch.ja:
	  Change encoding from Shift_JIS to UTF-8

Thu Sep  9 01:14:00 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* sample/drb/README.rd.ja:
	* sample/drb/dhasenc.rb:
	* sample/mine.rb:
	  Change encoding from EUC-JP to UTF-8

Thu Sep  8 21:03:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/nkf/nkf-utf8/nkf.c: import nkf 2.1.2 (be9c280)
	  Bump version number/release date only.

Thu Sep  8 12:43:18 2011  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (Init_GC): defined GC::Profiler.raw_data. based on the
	  patch by Eric Hodel. [ruby-core:37857] [Bug #4991]

Thu Sep  8 09:02:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (id2ref): objects which are unmarked but not in sweep_slots
	  are not dead.

Thu Sep  8 07:44:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (rb_declare_transcoder, load_transcoder_entry): no
	  longer need to limit the length of transcoder library name.

Thu Sep  8 07:36:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/syck/lib/syck/types.rb: use toplevel Syck.
	  for the case someone define Syck::Syck (or YAML::Syck).

Thu Sep  8 07:33:12 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* gc.c (id2ref): unmarked object is already dead while lazy
	  sweeping, and to it cannot come back since other objects
	  referred from it might have been freed already.

Wed Sep  8 03:48:00 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* ext/readline/README.ja:
	  Change encoding from EUC-JP to UTF-8

Wed Sep  8 02:59:00 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* test/rexml/test_encoding.rb:
	  Add require 'require 'rexml/document'

Wed Sep  8 02:53:00 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* ext/nkf/nkf-utf8/nkf.c:
	  Change encoding from ISO-2022 to UTF-8

Wed Sep  7 23:41:24 2011  Kouhei Sutou  <kou@cozmixng.org>

	* lib/rexml/parsers/baseparser.rb, test/rexml/test_comment.rb:
	  allow a single hyphen in comment. [Bug #5278] [ruby-core:39289]
	  Reported by Thomas Fritzsche. Thanks!!!

Wed Sep  7 17:27:18 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/yaml.rb: explicitly specify ::Object to avoid the collision with
	  Syck::Object.

Tue Sep  6 21:06:49 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb (_run_suites): Now reports are written the
	  following order: Skip, Failure, Error. [Feature #5282]

	* test_sorting.rb: test for above.

	* test4test_sorting.rb: Ditto.

	* lib/test/unit.rb (run): Put RUBY_DESCRIPTION before quitting.
	  [Feature #5282]

Tue Sep  6 21:13:47 2011  Masaya Tarui  <tarui@ruby-lang.org>

	* win32/Makefile.sub (INSNS): change command line option -Ks to -Ku
	  for generate *.inc. because insns.def encoding has been changed SJIS
	  to UTF-8. if $BASERUBY is 1.9, -Ks cause an error. [Feature #5128]
	  (same as r33194)

Tue Sep  6 15:55:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (load_transcoder_entry): concatenate paths directly.

	* encoding.c (load_encoding): predefined encoding names are safe.
	  [ruby-dev:44469] [Bug #5279]

	* transcode.c (load_transcoder_entry): ditto.

Tue Sep  6 12:07:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c: enabled econv newline option.

Tue Sep  6 06:44:57 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (dbl2ival): Fix Float#divmod and #round for 32 bit
	  platform. part 1 of [bug #5276]

Tue Sep  6 06:44:25 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (flo_round): Fix criteria for 32 bits platform
	  part 2 of [bug #5276]

Tue Sep  6 05:37:11 2011  Masatoshi SEKI  <m_seki@mva.biglobe.ne.jp>

	* test/rinda/test_rinda.rb (test_core_03_notify): Fixed test failures
	  [ruby-dev:44430] [Ruby 1.9 - Bug #372]

Mon Sep  5 20:59:30 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* insns.def: change encoding pragma for emacs (shift_jis to utf-8).

Mon Sep  5 19:32:15 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* Makefile.in (INSNS): change command line option -Ks to -Ku for
	  generate *.inc. because insns.def encoding has been changed SJIS to
	  UTF-8. if $BASERUBY is 1.9, -Ks cause an error. [Feature #5128]

Mon Sep  5 18:10:56 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* transcode.c (rb_econv_binmode): newline decorators are
	  exclusive.

Mon Sep  5 15:03:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rubygems/test_gem_security.rb
	  (test_class_build_self_signed_cert): reset opt[:trust_dir] to apply
	  temporary Gem.user_home.

Mon Sep  5 10:04:35 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* README.ja, README.EXT.ja: resolve conflicts. [ruby-dev:44459]

Mon Sep  5 05:13:22 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (flo_round): Make Float#round round big values [bug
	  #5272]

Mon Sep  5 04:28:25 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (int_round): Integer#round always returns an Integer [Bug
	  #5271]

Sun Sep  4 22:28:50 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (default_port, default_imap_port,
	  default_tls_port, default_ssl_port, default_imaps_port):
	  added methods for consistency with Net::POP.
	  based on the patch by art lussos.  [ruby-core:38997] [Bug #5198]

Sun Sep  4 21:19:19 2011  Ayumu AIZAWA  <ayumu.aizawa@gmail.com>

	* Change encoding from EUC-JP to UTF-8. [Feature #5128]

Sun Sep  4 00:47:39 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* test/ruby/test_fiber.rb (TestFiber#test_no_valid_cfp):
	  add a test. Unlike TestThread#test_no_valid_cfp,
	  this test succeeds even if win32ole is required (see r33153).

Sun Sep  4 00:11:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* variable.c (rb_const_set): show the previous definition
	  location.  [EXPERIMENTAL]

Sat Sep  3 23:56:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (sizeof_struct_dirent_too_small): check if struct
	  dirent.d_name is too small.

	* configure.in (RUBY_MINGW32): take tool prefix from CC.

Sat Sep  3 23:52:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (argf_next_argv): open in default text mode.
	  [ruby-core:39234] [Bug #5268]

Sat Sep  3 18:40:57 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* lib/thread.rb (SizedQueue#max=): raise ArgumentError if max is not
	  positive number. patch by Masaki Matsushita.
	  [ruby-dev:44449] [Bug #5259]

	* test/thread/test_queue.rb (test_sized_queue_initialize,
	  test_sized_queue_assign_max): add tests for it.

Fri Sep  2 21:11:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (validate_enc_binmode, prep_stdio): default to text mode on
	  dosish platforms.  [ruby-core:38822] [Bug #5164]

	* transcode.c (rb_econv_prepare_options): keep default ecflags
	  unchanged if no options.

Fri Sep  2 14:36:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_insnhelper.c (vm_search_const_defined_class): search
	  ancestors only when global scope.  [ruby-core:39227] [Bug #5264]

Fri Sep  2 09:58:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (parser_tokadd_string, parser_yylex): ignore a backslash
	  which prefixes an non-ascii character, which has no escape
	  syntax.  [ruby-core:39222] [Ruby 1.9 - Bug #5262]

Fri Sep  2 04:05:25 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/visitors/yaml_tree.rb: emit strings tagged as
	  ascii-8bit as binary in YAML.
	* test/psych/test_string.rb: corresponding test.

Fri Sep  2 01:07:14 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* numeric.c (flo_round): substitute machine dependent magic number.

Thu Sep  1 17:31:22 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* insns.def (defineclass), vm_insnhelper.c (vm_get_cvar_base): see
	  also inherited constants for classes without superclass and
	  modules.  [ruby-core:37698] [Bug #3423]

Thu Sep  1 16:18:44 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* Release GVL while OpenSSL's public key generation.

	    t = Thread.new { print "."; sleep 0.1 }
	    key = OpenSSL::PKey::RSA.new(2048)
	    #=> Thread t works in parallel with public key generation if
		OS/machine allows it.

	  This works with OpenSSL >= 0.9.8. From this version, it has new
	  public key generation function which allows us to interrupt the
	  execution while pkey generation iterations.

	* ext/openssl/extconf.rb: Check existence of OpenSSL's new public key
	  generation function. (DH_generate_parameters_ex,
	  DSA_generate_parameters_ex and RSA_generate_key_ex.

	* ext/openssl/ossl_pkey.{h,c} (ossl_generate_cb_2,
	  ossl_generate_cb_stop): Added new callback function for OpenSSL pkey
	  generation which handles Thread interruption by Ruby.
	  ossl_generate_cb_stop is the unblock function(ubf) for Ruby which
	  sets a stop flag. New pkey generation callback ossl_generate_cb_2
	  checks the stop flag at each iterations of OpenSSL and interrupts
	  pkey generation when the flag is set.

	* ext/openssl/ossl_pkey_dsa.c (dsa_generate): Call
	  rb_thread_blocking_region with the above unblock function to release
	  GVL while pkey generation.

	* ext/openssl/ossl_pkey_rsa.c (rsa_generate): ditto.

	* ext/openssl/ossl_pkey_dh.c (dh_generate): ditto.

	* test/openssl/test_pkey_{dh,dsa,rsa}.rb: Test it.

Thu Sep  1 14:06:54 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_thread.rb (TestThread#test_no_valid_cfp): skip when
	  win32ole is required.  in such case, win32ole redefines
	  Thread#initialize, and the block argument becomes to be not the top
	  of the thread, then this testcase always fails.

Thu Sep  1 10:20:50 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb (TestIO_M17N#test_{default_mode_on_dosish,
	  default_mode_on_unix,text_mode,binary_mode}): sorry for wrong test
	  committed in r33144.  I'd misunderstood the spec of ruby's universal
	  newline.

Thu Sep  1 09:27:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* variable.c (rb_autoloading_value): Fix the order of definitions.
	  It is used by autoload_defined_p.

Wed Aug 31 17:28:23 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* variable.c (rb_autoload): There was a chance to run GC (from
	  rb_str_new2()) before finishing autoload_data_i construction. It
	  caused SEGV at rb_gc_mark() at autoload_i_mark.

	* variable.c (rb_autoload_load): Move RB_GC_GUARD() to proper
	  position based on suggestion by CHIKANAGA Tomoyuki at
	  http://d.hatena.ne.jp/nagachika/20110826/ruby_trunk_changes_33070_33078

	* variable.c (autoload_defined_p): Fix incompatible autoload behavior
	  that causes Rails crash. Class definition instruction defined in
	  'defineclass' in insns.def always invokes rb_autoload_load for a
	  constant. It's invoked for every class definition regardless of
	  existence of autoload definition. rb_autoload_load checks if a
	  constant is defined as autoloaded, but new thread-safe autoload
	  returned different value if the constant is under autoloading.

Wed Aug 31 17:20:56 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* Re-apply r33078, thread-safe autoload which is reverted at r33093.

Wed Aug 31 16:28:04 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_io_m17n.rb (TestIO_M17N#test_{default_mode_on_dosish,
	  default_mode_on_unix,text_mode,binary_mode}): tests for [Bug #5164].

Wed Aug 31 15:54:11 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Merge json gem v1.5.4 (3dab4c5a6a97fac03dac).

Wed Aug 31 13:09:41 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (flo_round): Avoid overflow by optimizing for trivial
	  cases [Bug #5227]

Wed Aug 31 00:50:01 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (rb_w32_select_with_thread): and my typo. we all must
	  be more careful.

Wed Aug 31 00:48:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* thread.c (rb_thread_select): critical typo in r33117.

Wed Aug 31 00:30:49 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/-ext-/old_thread_select/test_old_thread_select.rb
	  (TestOldThreadSelect#test_old_select_read_timeout): if the machine
	  is fast enough, the time used by code around IO.select may be smaller
	  than Time implement threshold.

Wed Aug 31 00:04:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* ext/-test-/old_thread_select/old_thread_select.c (old_thread_select):
	  typo.

	* test/-ext-/old_thread_select/test_old_thread_select.rb
	  (TestOldThreadSelect#test_old_select_signal_safe): use SIGINT instead
	  of SIGUSR1 because the former is general and the latter is platform
	  dependent.

Tue Aug 30 23:59:36 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/intern.h (rb_w32_fd_copy): implement
	  for rb_thread_select() in thread.c.  the use of rb_fd_copy() is
	  introduced in r33117.
	  [Bug #5251] [ruby-core:39195]

	* thread.c (rb_thread_select): must call rb_fd_init() before using
	  rb_fdset_t.  see the implementations of rb_fd_init()s if you want to
	  know the reason.

Tue Aug 30 22:34:45 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/dl/test_callback.rb (test_callback_with_string): prevents
	  temporary string from GC.

Tue Aug 30 22:25:38 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* vm_insnhelper.c (vm_call_cfunc): revert r33112.  RB_GC_GUARD macro
	  protect a VALUE from GC.  It's not for general anti-optimizing
	  purpose.

Tue Aug 30 11:06:19 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/json: Merge json gem 1.5.4+ (2149f4185c598fb97db1).
	  [Bug #5173] [ruby-core:38866]

Tue Aug 30 09:57:50 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* lib/thread.rb (Queue#pop): fix a race against Thread.wakeup.
	  Patch by Masaki Matsushita <glass.saga at gmail dot com>
	  [Bug #5195] [ruby-dev:44400]

Tue Aug 30 09:48:07 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* cont.c (fiber_entry): fix stack allocation failure on Debian
	  GNU/kFreeBSD.
	  Patch by Lucas Nussbaum <lucas at lucas-nussbaum dot net>.
	  [Bug #5241] [ruby-core:39147]

Tue Aug 30 09:28:01 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread.c (rb_thread_select): rewrite by using
	  rb_thread_fd_select(). old one is EINTR unsafe.
	  Patch by Eric Wong. [Bug #5229] [ruby-core:39102]

	* test/-ext-/old_thread_select/test_old_thread_select.rb:
	  a testcase for rb_thread_select().
	* ext/-test-/old_thread_select/old_thread_select.c: ditto.
	* ext/-test-/old_thread_select/depend: ditto.
	* ext/-test-/old_thread_select/extconf.rb: ditto.

Tue Aug 30 09:08:22 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: fix a build failure on GNU Hurd.
	  Patch by Samuel Thibault <sthibault at debian dot org>. Thank you!
	  [Bug #5250] [ruby-core:39185]

Sun Aug 29 23:22:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* test/ruby/test_numeric.rb (test_num2long): modify a test against the
	  change by r33108.

Sun Aug 29 09:58:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* numeric.c (bit_coerce): A Fixnum and a Bignum are only permitted for
	 bitwise arithmetic with a Fixnum.  #1792

	* test/ruby/test_fixnum.rb: add tests for the above change.

	* bignum.c (bit_coerce): A Fixnum and a Bignum are only permitted for
	 bitwise arithmetic with a Bignum.  #1792

	* test/ruby/test_bignum.rb: add tests for the above change.

Sun Aug 28 15:38:17 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/date/date_parse.c (date_zone_to_diff): keep a temporary string
	  stored in variable while the contents buffer is being used.

	* ext/date/date_parse.c (date_zone_to_diff): get rid of out of bounds
	  memory read. [ruby-dev:44409] [Bug #5213]

Sun Aug 28 05:29:50 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*: Imported minitest 2.5.1 (r6596)
	* test/minitest/*: ditto

Sat Aug 27 20:46:05 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c (rb_vm_rewrite_dfp_in_errinfo): change return type
	  to suppress a warning.

	* vm_core.h: ditto.

Sat Aug 27 19:04:06 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* internal.h (rb_strftime_timespec): moved from time.c and define only
	  if ruby/encoding.h is included.

	* internal.h (rb_strftime): ditto.

Sat Aug 27 18:53:51 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* proc.c (proc_new): force to rewrite errinfo when calling Proc.new in ensure.
	  [Bug #5234] [ruby-core:39125]
	  This code will be removed after changing throw mechanism (see r33064).

	* vm.c (rb_vm_rewrite_dfp_in_errinfo): new function.

	* vm.c (vm_make_env_each): changed accordingly.

	* vm_core.h: ditto.

	* bootstraptest/test_flow.rb: add tests for above.

Sat Aug 27 18:44:06 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* internal.h (rb_strftime_timespec): move to time.c because it depends
	  encoding.h.

Sat Aug 27 18:17:58 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* strftime.c (rb_strftime_with_timespec): get enc argument to specify
	  the encoding of the format. On Windows (at least Japanese Windows),
	  Time#strftime("%Z") includes non ASCII in locale encoding (CP932).
	  So convert locale to default internal. [ruby-core:39092] [Bug #5226]

	* strftime.c (rb_strftime): ditto.

	* strftime.c (rb_strftime_timespec): ditto.

	* internal.h (rb_strftime_timespec): follow above.

	* time.c (rb_strftime_alloc): ditto.

	* time.c (strftimev): ditto.

	* time.c (time_strftime): ditto.

	* time.c (time_to_s): the resulted string of Time#to_s is always
	  ascii only, so this should be US-ASCII.

	* time.c (time_asctime): ditto.

Sat Aug 27 11:18:12 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* Revert r33078. It caused a Rails application NoMethodError.

	  /home/nahi/git/emptyApp/ruby/1.9.1/gems/rack-mount-0.6.14/lib/rack/mount/utils.rb:157: warning: toplevel constant ScanError referenced by Regin::Parser::ScanError
	  /home/nahi/git/emptyApp/ruby/1.9.1/gems/rack-mount-0.6.14/lib/rack/mount/vendor/regin/regin/parser.rb:17:in `parse_regexp': undefined method `scan_str' for #<Regin::Parser:0x00000002344548> (NoMethodError)

Sat Aug 27 08:44:58 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Import RDoc 3.9.4.  Typo and grammar fixes by Luke Gruber.
	  [Ruby 1.9 - Bug #5203]

Sat Aug 27 07:53:34 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/open-uri.rb:  Fix indentation of OpenURI::OpenRead#open.  Use ++
	  instead of `' for method arguments in open-uri.rb

Sat Aug 27 07:22:07 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/pathname/lib/pathname.rb:  Fix typos and grammar mistakes.  Patch
	  by Luke Gruber.  [#5203]
	* ext/pty/lib/expect.rb:  ditto
	* lib/mathn.rb:  ditto
	* lib/net/http.rb:  ditto
	* lib/open-uri.rb:  ditto
	* lib/ostruct.rb:  ditto
	* lib/tempfile.rb:  ditto
	* lib/thread.rb:  ditto
	* lib/weakref.rb:  ditto
	* sample/webrick/httpproxy.rb:  ditto

Sat Aug 27 04:03:18 2011  Koichi Sasada  <ko1@atdot.net>

	* iseq.c (iseq_data_to_ary): fix type of variable
	  (long -> unsigned long) to suppress a warning.

Sat Aug 27 04:02:11 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_core.h: add a decl. of rb_autoloading_value().

Fri Aug 26 19:12:08 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* variable.c: Make autoload thread-safe. See #921.

	  What's the problem?
	    autoload is thread unsafe. When we define a constant to be
	    autoloaded, we expect the constant construction is invariant. But
	    current autoload implementation allows other threads to access the
	    constant while the first thread is loading a file.

	  What's happening inside?
	    The current implementation uses Qundef as a marker of autoload in
	    Constant table. Once the first thread find Qundef as a value at
	    constant lookup, it starts loading a defined feature. Generally a
	    loaded file overrides the Qundef in Constant table by module/class
	    declaration at very beginning lines of the file, so other threads
	    can see the new Module/Class object before feature loading is
	    finished. It breaks invariant construction.

	  How to solve?
	    To ensure invariant constant construction, we need to override
	    Qundef with defined Object after the feature loading. For keeping
	    Qundef in Constant table, I expanded autoload_data struct in
	    Module to have a slot for keeping the defined object while feature
	    loading. And changed Module's constant lookup/update logic a
	    little so that the slot is only visible from the thread which
	    invokes feature loading. (== the first thread which accessed the
	    autoload constant)

	  Evaluation?
	    All test passes (bootstrap test, test-all and RubySpec) and added
	    8 tests for threading behavior. Extra logics are executed only
	    when Qundef is found, so no perf drop should happen except
	    autoloading.

	* variable.c (rb_autoload): Prepare new autoload_data struct.

	* variable.c (rb_autoload_load): Load feature and update Constant
	  table after feature loading is finished.

	* variable.c (rb_const_get_0): When the fetched constant is under
	  autoloading, it returns the object only for the thread which starts
	  autoloading.

	* variable.c (rb_const_defined_0): Ditto.

	* variable.c (rb_const_set): When the specified constant is under
	  autoloading, it sets the object only for the thread which starts
	  autoloading. Otherwise, simply overrides Qundef with constant
	  override warning.

	* vm_insnhelper.c (vm_get_ev_const): Apply same change as
	  rb_const_get_0 in variable.c.

	* test/ruby/test_autoload.rb: Added tests for threading behavior.

Fri Aug 26 10:10:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Update to RubyGems 1.8.10.  Fixes security issue in
	  creating ruby-format gemspecs.  Fixes Gem.dir not being at the front
	  of Gem.path to fix uninstall and cleanup commands.  Fixes gem
	  uninstall stopping on the first missing gem.

Fri Aug 26 08:21:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* time.c (strftimev): Make Time#to_s default to US-ASCII encoding but
	  respect Encoding.default_internal. [ruby-core:39092]
	* test/ruby/test_time.rb (class TestTime): Corresponding test.

Thu Aug 25 09:43:16 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/lib/openssl/bn.rb:  Hide copyright info from RDoc.
	* ext/openssl/lib/openssl/digest.rb:  ditto
	* ext/openssl/lib/openssl/x509.rb:  ditto
	* ext/openssl/lib/openssl/cipher.rb:  ditto

Thu Aug 25 09:25:48 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/openssl/ossl_digest.c:  Document OpenSSL::Digest::digest and add
	  an example to OpenSSL::Digest.  Patch by Sylvain Daubert.
	  [Ruby 1.9 - Bug #5166]
	* ext/openssl/lib/openssl/digest.rb (module OpenSSL):  ditto

Thu Aug 25 08:19:43 2011  Koichi Sasada  <ko1@atdot.net>

	* vm.c (vm_make_env_each): work around to solve Bug #2729.
	  fixes: Bug #2729
	  a patch from Kazuki Tsujimoto <kazuki@callcc.net>
	  This problem is caused by changing dfp (dynamic env pointer)
	  from saved dfp.  Saved dfp is pointed env in VM stack.  However,
	  the dfp can be moved because VM copies env from VM stack to
	  the heap.  At this copying, dfp was also changed.  To solve this
	  problem, I'll try to change throw mechanism (not save target dfp,
	  but save target cfp).

	* bootstraptest/test_flow.rb: add a test for above.

Thu Aug 25 07:57:33 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* numeric.c (int_round): Fix Integer#round [ruby-core:39096]

Thu Aug 25 07:00:00 2011  Koichi Sasada  <ko1@atdot.net>

	* vm_insnhelper.h, vm_insnhelper.c, vm.c, vm_method.c, insns.def:
	  Manage a redefinition of special methods for each classes.
	  A patch from Joel Gouly <joel.gouly@gmail.com>.  Thanks!

Thu Aug 25 06:51:08 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: Fixing psych version number.
	* ext/psych/psych.gemspec: updating the gemspec.

Thu Aug 25 06:11:35 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/nodes/node.rb: default `to_yaml` encoding to be
	  UTF-8.
	* test/psych/test_encoding.rb: test yaml dump encoding.

Thu Aug 25 01:24:33 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* test/fileutils/test_fileutils.rb (test_chmod_symbol_mode): Solaris
	  seems to behave the same as FreeBSD.

Thu Aug 25 01:11:36 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* test/ruby/test_rubyoptions.rb (test_script_from_stdin): slave pty
	  should be manipulated because master pty may not be a tty on some
	  environment (e.g. Solaris). [Bug:#5222] [ruby-dev:44420]

Wed Aug 24 15:13:56 2011  Koichi Sasada  <ko1@atdot.net>

	* iseq.h, iseq.c, compile.c: Change the line number data structure
	  to solve an issue reported at [ruby-dev:44413] [Ruby 1.9 - Bug #5217].
	  Before this fix, each instruction has an information including
	  line number (iseq::iseq_insn_info_table).  Instead of this data
	  structure, recording only line number changing places
	  (iseq::iseq_line_info_table).
	  The order of entries in iseq_line_info_table is ascending order of
	  iseq_line_info_table_entry::position.  You can get a line number
	  by an iseq and a program counter with this data structure.
	  This fix reduces memory consumption of iseq (bytecode).
	  On my measurement, a rails application consumes 21.8MB for
	  iseq with this fix on the 32bit CPU.  Without this fix, it
	  consumes 24.7MB for iseq [ruby-dev:44415].

	* proc.c: ditto.

	* vm_insnhelper.c: ditto.

	* vm_method.c: ditto.

	* vm.c (rb_vm_get_sourceline): change to use rb_iseq_line_no().

Wed Aug 24 09:49:10 2011  Koichi Sasada  <ko1@atdot.net>

	* insns.def (defined): fix to checking class variable.
	  A patch by Magnus Holm <judofyr@gmail.com>.  Thanks!

	* test/ruby/test_variable.rb: add a test for above.

Wed Aug 24 08:53:06 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 3.9.3.  Fixes RDoc with `ruby -Ku`.  Allows
	  HTTPS image paths to be turned into <img> tags.  Prevents special
	  markup inside <tt> from being processed.

Wed Aug 24 07:57:43 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Update to RubyGems 1.8.9.  Fixes uninstalling multiple
	  gems and gem cleanup.

Wed Aug 24 06:45:20 2011  Ryan Davis  <ryand-ruby@zenspider.com>

	* lib/minitest/*: Imported minitest 2.5.0 (r6557)
	* test/minitest/*: ditto

Wed Aug 24 00:38:22 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (update_coverage): skip coverage count up if the current
	  line is out of the way.  rb_sourceline() is unreliable when source
	  code is big.  [ruby-dev:44413]

	* test/coverage/test_coverage.rb: add a test for above.

Tue Aug 23 15:23:56 2011  Eric Hodel  <drbrain@segment7.net>

	* load.c (rb_f_require):  Improve documentation of Kernel#require.
	  [Ruby 1.9 - Bug #5210]

Tue Aug 23 11:27:26 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/zlib/zlib.c (gzfile_read_header): Ensure that each section of
	  gzip header is readable to avoid SEGV.

	* test/zlib/test_zlib.rb (test_corrupted_header): Test it.

Mon Aug 22 23:43:33 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* sprintf.c (rb_str_format): add RB_GC_GUARD to prevent temporary
	  strings from GC.

Sun Aug 21 17:49:53 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* iseq.c (iseq_s_disasm): remove variable which is no longer used
	  since r33013.

Sun Aug 21 14:20:58 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* configure.in: use LD_LIBRARY_PATH_64 on 64-bit Solaris.

Sat Aug 20 13:19:52 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* iseq.c (iseq_s_disasm): fix a bug that may cause SEGV.

	* test/ruby/test_method.rb (test_body): add a test for the above change.

Sat Aug 20 10:43:24 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/stringio/stringio.c (strio_read): return new string if nil
	  is explicitly given as a buffer ([Bug #5207]), otherwise set the
	  encoding.  also removed dead code.

Fri Aug 19 14:25:51 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* process.c (proc_spawn_v, proc_spawn): should not wait the
	  spawned process.

	* process.c (proc_spawn_v): fix missing argument, and try with
	  /bin/sh only if failed with ENOEXEC.

Fri Aug 19 14:12:57 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (idle): raises a Net::IMAP::Error when the
	  connection is closed.  based on the patch by Hugo Barauna.
	  [Bug #5190] [ruby-core:38930]

Fri Aug 19 13:18:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: defines _DARWIN_UNLIMITED_SELECT if the target_os
	  is darwin.

Fri Aug 19 13:14:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* thread.c: add a description for the behavior of select(2) on
	  Mac OS X 10.7 (Lion).

Fri Aug 19 11:28:58 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/net/imap.rb (msg_att): accepts extra space before ')'.
	  based on the patch by art lussos.  [Bug #5163] [ruby-core:38820]

Wed Aug 17 23:01:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (cannot_be_coerced_into_BigDecimal):
	  remove duplication.

Wed Aug 17 15:27:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (cannot_be_coerced_into_BigDecimal):
	  add a new function for raising error when an object cannot coerce
	  into BigDecimal.  [Bug #5172]

	* ext/bigdecimal/bigdecimal.c (BigDecimalValueWithPrec): use
	  cannot_be_coerced_into_BigDecimal function.

	* ext/bigdecimal/bigdecimal.c (BigMath_s_exp): ditto.

	* ext/bigdecimal/bigdecimal.c (BigMath_s_log): ditto.

	* test/bigdecimal/test_bigdecimal.rb: test for the above changes.

	* test/bigdecimal/testbase.rb (under_gc_stress): add a new utility
	  method to run tests under the condition of GC.stress = true.

Wed Aug 17 10:16:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* rational.c (nurat_coerce): Rational#coerce should converts itself
	  into Complex if the argument is a Complex with non-zero imaginary
	  part.  [Bug #5020] [ruby-dev:44088]

	* test/ruby/test_rational.rb (test_coerce): test for the above change.

Wed Aug 17 06:33:19 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_x509cert.c: Add class documentation for
	  OpenSSL::X509::Certificate.

Wed Aug 17 04:54:25 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_pkey.c: corrected docs, OpenSSL::PKey::DH does
	  *not* support #sign/verify.

Tue Aug 16 18:56:54 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm.c (ruby_threadptr_data_type): rename to hide.
	  [ruby-core:38972]

Tue Aug 16 18:52:08 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* win32/mkexports.rb (Exports::Mswin#each_export): exclude Init_
	  and _threadptr_ functions, as well as mingw.

Tue Aug 16 09:31:44 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/dl:  Add documentation.  Patch by Vincent Batts.
	  [Ruby 1.9 - Bug #5192]

Tue Aug 16 08:48:26 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/.document (fiddle):  Remove duplicate entry
	* ext/fiddle:  Complete documentation of Fiddle.  Patch by Vincent
	  Batts.  [#5192]

Tue Aug 16 08:00:15 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/socket:  Make Socket documentation appear.  Add documentation for
	  Socket, TCPServer, SOCKSSocket.  Patch by Sylvain Daubert.
	  [Ruby 1.9 - Feature #5182]

Mon Aug 15 09:58:55 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_ssl.c: Support disabling OpenSSL compression.

	* test/openssl/test_ssl.rb: Add a test for it.
	  Thanks to Eric Wong for the patch.
	  [Ruby 1.9 - Feature #5183] [ruby-core:38911]

Sun Aug 14 05:57:01 2011  Tanaka Akira  <akr@fsij.org>

	* test/socket/test_socket.rb (test_connect_timeout): added a test
	  based on a patch by Eric Wong.  [ruby-core:38910]

Sat Aug 13 22:17:27 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/mkconfig.rb: do not make the entries related to sitedir and
	  verdordir if disabled by --without options.  [ruby-core:38922]
	  [Bug #5187]

Sat Aug 13 17:03:22 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: [ruby-core:38861]

Sat Aug 13 09:39:07 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* test/date/test_*.rb: added tests.

Sat Aug 13 09:36:19 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/date/date_parse.c (parse_ddd_cb): fix r32896. RB_GC_GUARD
	  insertion position was mistaken. [ruby-dev:44337] [Bug #5152]

Sat Aug 13 09:26:24 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/core_ext.rb: Make Kernel#y private.
	  [ruby-core:38913]

	* test/psych/test_yaml.rb: corresponding test.

Sat Aug 13 09:05:16 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c (date_strftime_alloc): followed the change
	  of r32885.

	* doc/NEWS-1.9.3: followed the above change.

Sat Aug 13 08:55:38 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych/scalar_scanner.rb: Only consider strings
	  with fewer than 2 dots to be numbers. [ruby-core:38915]

Sat Aug 13 08:47:20 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: [ruby-core:38855].

Sat Aug 13 03:41:37 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/uri/common.rb:  Fix documentation of URI::Parser.new.  Patch by
	  Steve Klabnik.  [Ruby 1.9 - Bug #5177]

Sat Aug 13 02:19:57 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/digest/digest.c:  Add documentation for the Digest module.  Patch
	  by Sylvain Daubert.  [Ruby 1.9 - Bug #5167]

Sat Aug 13 01:56:11 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rake:  Update to Rake 0.9.2.2.  Prevent pollution of toplevel
	  namespace by Commands.  Remove unused variable and debugging
	  statement in tests.

Fri Aug 12 11:39:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: Describe "no" configure option for site_ruby
	  and vendor_ruby. Patch by Vit Ondruch. [Bug #5187][ruby-core:38921]

Fri Aug 12 09:00:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Import RubyGems 1.8.8.  Fixes encoding of YAML gemspec
	  from gems.  Github Issue #149

Fri Aug 12 08:17:46 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ipsocket.c (init_inetsock_internal): use SOMAXCONN for
	  listen backlog.

	* ext/socket/unixsocket.c (rsock_init_unixsock): ditto.

	* ext/socket/lib/socket.rb (Addrinfo#listen): ditto.
	  (Socket.tcp_server_sockets_port0): ditto.

	* ext/socket/mkconstants.rb: define SOMAXCONN as 5 if not available.

	[ruby-core:38493]

Fri Aug 12 03:24:35 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Import RDoc 3.9.2.  Fixes TIDYLINK for HTML output.

Thu Aug 11 15:37:42 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* variable.c (autoload_delete): An autoload entry is still in a
	  RCLASS_IV_TBL, not in a RCLASS_CONST_TBL, so take back the table
	  changed in r29600. And an autoload entry keeps not a
	  rb_const_entry_t but a NODE so remove rb_const_entry_t thing added
	  in r29602.

Thu Aug 11 15:07:36 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (link_command): use LIBRUBYARG in rbconfig for
	  unbundled extensions.  [ruby-core:38802] [Bug #5147]

	* lib/mkmf.rb (init_mkmf): revert r32902.  [ruby-core:38903]

Wed Aug 10 23:03:55 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb: fix argument check in the previous commit.

Wed Aug 10 22:12:28 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (Socket.tcp): add :connect_timeout option.
	  (Addrinfo#connect_from): add :timeout option.
	  (Addrinfo#connect): ditto.
	  (Addrinfo#connect_to): ditto.
	  [ruby-core:38538]

Wed Aug 10 21:27:19 2011  Tanaka Akira  <akr@fsij.org>

	* lib/net/pop.rb: fix typo in document.

	* lib/net/http.rb: ditto.

	* lib/net/imap.rb: ditto.

Wed Aug 10 19:30:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* complex.c (nucomp_rationalize): calls rationalize of real part if
	  imaginary part is exactly zero.  The patch is made by Marc-Andre
	  Lafortune.  fixes [Bug #5178] [ruby-core:38885]

	* test/ruby/test_complex.rb (test_rationalize): add a test for the
	  above change.

	* complex.c (nucomp_to_r): fix RDoc comment.  The patch is made by
	  Marc-Andre Lafortune.

Wed Aug 10 14:11:07 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (init_mkmf): set $LIBRUBYARG regardless of shared
	  option.  [ruby-core:38802] [Bug #5147]

Wed Aug 10 02:53:27 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/net/http.rb: come back autoload. OpenSSL constant is used
	  some places, so it leads mistakes like HTTP.start.

Tue Aug  9 22:57:45 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/date/date_parse.c (date_zone_to_diff): add RB_GC_GUARD.
	  [ruby-dev:44337] [Bug #5152]

	* ext/date/data_parse.c (parse_ddd_cb): ditto.

Tue Aug  9 14:25:47 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* ext/fiddle/conversions.c (generic_to_value): ffi_arg and ffi_sarg
	  should be used to handle shorter return value. fix [Bug #3861]
	  [ruby-core:32504]

	* ext/fiddle/closure.c (callback): ditto

	* ext/fiddle/conversions.h (fiddle_generic): ditto

	* ext/fiddle/conversions.c (value_to_generic): char, short and int
	  are strictly distinguished on big-endian CPU, e.g. sparc64.

Tue Aug  9 11:21:08 2011  Narihiro Nakamura  <authornari@gmail.com>

	* gc.c (gc_lazy_sweep): if sweep target slots are not found, we
	  try heap_increment() because it might be able to expand the
	  heap. [Bug #5127] [ruby-dev:44285]

	* gc.c (gc_clear_mark_on_sweep_slots): if a sweeping was
	  interrupted, we expand the heap if at all possible.

Tue Aug  9 12:20:33 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* test/fiddle/helper.rb (libc_so, libm_so): Solaris support added.
	  [ruby-core:38853] [Bug #5168]

	* test/dl/test_base.rb (libc_so, libm_so): on Solaris, remove libc
	  and libm version numbers for detecting default libc and libm.

Tue Aug  9 09:18:04 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/zlib/zlib.c (gzfile_wrap):  Document encoding options.

	* ext/zlib/zlib.c (rb_gzwriter_s_open): ditto

	* ext/zlib/zlib.c (rb_gzreader_s_open): ditto

Sun Aug  7 23:31:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* time.c (rb_strftime_alloc): raise ERANGE if width is too large.
	  Patch by Nobuyoshi Nakada. [Bug #4457] [ruby-dev:43285]

	* test/ruby/test_time.rb (class TestTime): add a test for the
	  above change.

Sun Aug  7 22:51:45 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* ext/openssl/ossl_asn1.c (decode_eoc): remove unused variables.
	  Patch by Eric Wong. [Feature #5157] [ruby-core:38798]

	* ext/openssl/ossl_asn1.c (ossl_asn1_decode): ditto.

	* ext/openssl/ossl_pkey.c (ossl_pkey_new_from_data): ditto.

Sun Aug  7 22:37:08 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* configure.in: add -Wunused-variable to default CFLAGS.
	  Patch by Eric Wong. [Feature #5157] [ruby-core:38798]

Sun Aug  7 15:37:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/digest/sha2/sha2ossl.c: use original SHA384_Final on DragonFly.

Sun Aug  7 14:08:16 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* ext/objspace/objspace.c: fix typos in a document.

Sun Aug  7 07:14:57 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* cont.c (HAVE_GETCONTEXT): see getcontext(3) because DragonFly BSD
	  x64 port doesn't have it.

Sun Aug  7 00:42:55 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/tk/lib/tk/wm.rb (Tk::Wm.command): Add the missing receiver
	  before calling epath. patched by flori
	  https://github.com/flori/ruby/commit/aa9474d32e5f2c57f8b0e2e0c528a03f06a4d433

Sat Aug  6 07:06:34 2011  Eric Hodel  <drbrain@segment7.net>

	* marshal.c (w_object):  Fix exception message when _dump_data is not
	  defined on a T_DATA object.

Fri Aug  5 22:16:20 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* numeric.c (rb_infinity, rb_nan): use WORDS_BIGENDIAN to get endian.
	  fix [Bug #5160] [ruby-dev:44356]

Fri Aug  5 17:14:11 2011  Akinori MUSHA  <knu@iDaemons.org>

	* test/test_syslog.rb (TestSyslog#test_log): Do not be too
	  specific about the log line format.  Fixes #5081.

Fri Aug  5 15:57:10 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* complex.c (f_signbit): fix compile error in gcc4 on Solaris with
	  CFLAGS="-std=gnu99".  [ruby-dev:44355] fix [Bug #5159]

	* math.c: ditto.

Fri Aug  5 15:55:33 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/ruby/test_object.rb: tests that respond_to? returns false.

Fri Aug  5 13:32:43 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* lib/xmlrpc/client.rb, lib/xmlrpc/server.rb: should use
	  String#bytesize instead of String#size.

Fri Aug  5 12:18:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* vm_eval.c (check_funcall): try respond_to? first if redefined.
	  [Bug #5158]

Fri Aug  5 09:48:22 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Import RubyGems 1.8.7:
	  Added missing require for `gem uninstall --format-executable`.

	  The correct name of the executable being uninstalled is now displayed
	  with --format-executable.

	  Fixed `gem unpack uninstalled_gem` default version picker.

	  RubyGems no longer claims a nonexistent gem can be uninstalled.

	  `gem which` no longer claims directories are requirable files.

	  `gem cleanup` continues cleaning up gems if one can't be uninstalled
	  due to permissions.  Issue #82.

	  Gem repository directories are no longer created world-writable.
	  Patch by Sakuro OZAWA.  [Ruby 1.9 - Bug #4930]

Fri Aug  5 07:00:31 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* test/io/console/test_io_console.rb (test_noctty): daemon() on
	  Fedora Rawhide seems not to detach the controlling terminal,
	  when the argument noclose is non-zero.  ref: [Bug #5135]

Thu Aug  4 23:48:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* thread_pthread.c (native_cond_signal): retry to call pthread_cond_signal
	  and pthread_cond_broadcast if they return EAGAIN in
	  native_cond_signal and native_cond_broadcast, respectively.
	  It is for the pthread implementation of Mac OS X 10.7 (Lion).
	  fixes #5155.  [ruby-dev:44342].

	* thread_pthread.c (native_cond_broadcast): ditto.

	* thread_pthread.c (struct cached_thread_entry): stop using
	  pthread_cond_t and its functions directly.

	* thread_pthread.c (register_cached_thread_and_wait): ditto.

	* thread_pthread.c (use_cached_thread): ditto.

Thu Aug  4 20:29:41 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* configure.in: when Solaris cc, use $(CC) to link shared libs.

Thu Aug  4 20:19:11 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* error.c (report_bug): use a small message buffer instead of BUFSIZ.
	  It is needed for avoiding nested SIGSEGV on Linux.
	  Note: BUFSIZ is not proper buffer size. It's unrelated with maximum
	  filename length. :-/
	  [Bug #5139] [ruby-dev:44315]

Thu Aug  4 16:08:45 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* tool/rbinstall.rb (gem): install all gemspecs under lib and ext.

	* tool/rbinstall.rb (Gem::Specification): may not be defined when
	  cross-compiling and BASERUBY is 1.8.

Thu Aug  4 11:30:36 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/missing.h: define __syscall on OpenBSD as r32702.

Thu Aug  4 03:02:54 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* tool/rbinstall.rb: use rubygems to load gemspecs, copy actual
	  gemspecs on install rather than generate fake ones for all gems.

Thu Aug  4 02:45:10 2011  Kenta Murata  <mrkn@mrkn.jp>

	* configure.in: set CXX variable to the C++ compiler that matches the
	  C compiler specified by CC variable (e.g. use g++-4.2 for gcc-4.2).

Thu Aug  4 02:21:10 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* lib/mkmf.rb (link_command): use static library only for bundled
	  extensions.  [Bug #5147]

Thu Aug  4 02:02:10 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/psych.gemspec: installing psych as a gem.

Wed Aug  3 16:01:35 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* util.c, include/ruby/util.h (ruby_add_suffix): remove the function.
	  [Bug #5153] [ruby-core:38736]

	* io.c (argf_next_argv): remove the call of above function.

	* ext/-test-/add_suffix, test/-ext-/test_add_suffix.rb: remove the test
	  extension module because this is only for testing ruby_add_suffix().

	* LEGAL: remove the mention about a part of util.c, because now we
	  removed the part.

	* io.c (argf_next_argv): now the new filename is not guaranteed to
	  use, so should check the return value of rename(2).

	* test/ruby/test_argf.rb (TestArgf#test_inplace_rename_impossible):
	  now we expect same result with other platforms on no_safe_rename
	  platforms (=Windows).

Wed Aug  3 09:18:08 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/xmlrpc/webrick_testing.rb (WEBrick_Testing#start_server):
	  Like r32795, bind address should be specified.

Wed Aug  3 07:46:30 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* encoding.c (enc_find): mistakenly remained !.  [Bug #5150]

Wed Aug  3 00:11:08 2011  Tanaka Akira  <akr@fsij.org>

	* lib/prettyprint.rb: update document.  [ruby-core:36776]

Tue Aug  2 22:04:46 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* gc.c (init_heap): allocate sigaltstack after heaps are allocated.
	  [ruby-dev:44315] [Bug #5139]

	* vm.c (thread_free): use free because objspace is not ready.

	* vm.c (th_init): use malloc because objspace is not ready.

Tue Aug  2 20:10:16 2011  Shota Fukumori  <sorah@tubusu.net>

	* test/testunit/test_parallel.rb: pass "--ruby" option to
	  test/testunit/tests_for_parallel/runner.rb. [Bug #5132] [ruby-dev:44303]

Tue Aug  2 15:53:37 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* encoding.c (str_to_encoding): rename from to_encoding and
	  use str_to_encindex.

	* encoding.c (str_to_encindex): split from to_encoding.

	* encoding.c (rb_to_encoding): use str_to_encoding.

	* encoding.c (rb_obj_encoding): don't bypass rb_encoding*.
	  If it uses rb_encoding*, it bypass encindex. If it uses encindex,
	  it doesn't bypass.

	* encoding.c (enc_find): add shortcut for encoding object, use
	  str_to_encindex, and avoid bypass rb_encoding*.

Tue Aug  2 12:03:16 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* hash.c (recursive_hash): hash value of emptied hash should be
	  equal to an empty hash.  [ruby-core:38650]

Tue Aug  2 11:42:15 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_enc_symname2_p): :! is valid symbol.  [Bug #5136]

Tue Aug  2 07:33:29 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/net/http/test_http.rb (TestNetHTTP_version_1_1_methods#test_timeout_during_HTTP_session):
	  If you connect to localhost, you should listen localhost.

	* test/net/http/test_https.rb (TestNetHTTPS#test_timeout_during_SSL_handshake):
	  ditto.

Tue Aug  2 06:18:15 2011  Luis Lavena  <luislavena@gmail.com>

	* lib/rubygems/installer.rb (class Gem): Correct path check on Windows
	  Possible fix for [Ruby 1.9 - Bug #5111]
	* test/rubygems/test_gem_installer.rb (load Gem): ditto

Mon Aug  1 20:12:03 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/ruby/test_process.rb (TestProcess#windows?): new method.

	* test/ruby/test_process.rb (TestProcess#*): use above method.

	* test/ruby/test_process.rb (TestProcess#test_execopts_redirect):
	  windows doesn't support FD_CLOEXEC.

Mon Aug  1 15:45:23 2011  Eric Hodel  <drbrain@segment7.net>

	* test/rake/test_rake_functional.rb:  Don't assume the binary name of
	  ruby is "ruby".  [Ruby 1.9 - Bug #5114]
	* test/rake/helper.rb:  ditto

Mon Aug  1 15:31:14 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/io/console/test_io_console.rb (TestIO_Console#test_sync):
	  Skip when PTY allocation failed (that's not our fault).

Mon Aug  1 15:04:12 2011  URABE Shyouhei  <shyouhei@ruby-lang.org>

	* test/xmlrpc/test_webrick_server.rb (Test_Webrick#setup_http_server):
	  XMLRPC::Client.new3(), when called without host: argument, tries
	  to  connect to  a host  where "localhost"  resolves to.   On the
	  other  hand  a  WEBrick::HTTPServer.new(), when  called  without
	  BindAddress:  argument, tries  to listen  all the  address where
	  getaddrinfo(AF_UNSPEC) resolves to.   This is a mismatch because
	  "localhost" might not resolve to one of those listening sockets.
	  We  would  better explicitly  specify  "localhost"  here and  if
	  failed, just skip the whole test.

Mon Aug  1 14:24:56 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc.rb:  Import RDoc 3.9.1.  Fixes bugs in the RDoc::Markup
	  parser.

Mon Aug  1 12:00:35 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* insns.def (concatstrings): don't use initial ASCII-8BIT string.
	  [ruby-core:38635] [Bug #5126]

Sun Jul 31 22:57:16 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* enc/Makefile.in (ECHO1): Same as the recent fix in common.mk.
	  ":" in a make variable replacement cause a syntax error with
	  /usr/ccs/bin/make on Solaris.  Uses $(NULLCMD) instead.

Sun Jul 31 21:16:02 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* complex.c (f_signbit): gcc4 on Solaris DOES have signbit but does
	  not have it on header.

	* math.c: ditto.

Sun Jul 31 21:09:04 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (node_name.inc): Use $(Q) for consistency.

	* Makefile.in (INSNS): ditto.

Sun Jul 31 21:19:51 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* lib/mkmf.rb (configuration:ECHO1): Same as the recent fix in
	  common.mk.
	  ":" in a make variable replacement cause a syntax error with
	  /usr/ccs/bin/make on Solaris.  Uses $(NULLCMD) instead.

Sun Jul 31 20:39:12 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* common.mk (ECHO1): nmake does not allow parenthesis in make variable
	  replacement.

Sun Jul 31 23:06:57 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c (check_env): print debug messages to stderr.
	[Feature #4871] [ruby-dev:43743]

Sun Jul 31 22:50:23 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c (vm_make_env_each): don't save prev env value.
	It is no longer used. [Feature #4871] [ruby-dev:43743]

	* vm.c (check_env): changed accordingly.

Sun Jul 31 20:21:36 2011  "Yuki Sonoda (Yugui)"  <yugui@yugui.jp>

	* common.mk (ECHO1): ":" in a make variable replacement cause a syntax
	  error with /usr/ccs/bin/make on Solaris.  Uses $(NULLCMD) instead.

	* configure.in (NULLCMD): new check.

	* Makefile.in (NULLCMD): Reflects checking in configure.

	* win32/Makefile.sub (NULLCMD): new assignment.

Sun Jul 31 18:58:59 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_pipe): pipe on cygwin can succeed half but fail
	  half.

Sun Jul 31 11:31:07 2011  Kazuki Tsujimoto  <kazuki@callcc.net>

	* vm.c: check if cfp is valid. [Bug #5083] [ruby-dev:44208]

Sun Jul 31 09:18:28 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rdoc:  Update to RDoc 3.9.  Fixed `ri []`, stopdoc creating an
	  object reference, nodoc for class aliases, verbatim === lines.

Sun Jul 31 01:29:08 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* io.c (rb_io_each_byte): remove unused variable e.

Sat Jul 31 01:23:45 2011  Kenta Murata  <mrkn@mrkn.jp>

	* test/bigdecimal/test_bigdecimal.rb (test_version): removed.

Sat Jul 30 23:19:09 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* defs/default_gems: separate from tool/rbinstall.rb.

Sat Jul 30 23:14:44 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* io.c (rb_io_each_byte): rbuf can be refreshed during yield.
	  [Bug #5119]

Sat Jul 30 22:35:50 2011  Naohisa Goto  <ngotogenome@gmail.com>

	* strftime.c (NEEDS): avoid SEGV due to integer overflow in
	  sparc-solaris2.10 and i686-linux.  fix [Bug #4456] [ruby-dev:43284]

Sat Jul 30 17:26:26 2011  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_win32ole_variant.rb: use skip method to skip the test.

	* test/win32ole/test_win32ole_variant_outarg.rb: ditto.

Sat Jul 30 14:27:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/bigdecimal.c (BigDecimal_version): version 1.1.0.

	* ext/bigdecimal/bigdecimal.gemspec: turn into a default gem.

	* tool/rbinstall.rb: ditto.

Sat Jul 30 11:21:55 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_core.h (ALT_STACK_SIZE): use MINSIGSTKSZ*2 instead of SIGSTKSZ*2.
	  [ruby-core:38607]

Sat Jul 30 10:39:14 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm.c (th_init): preallocate alternative stack.
	  NoMemoryError is better than rb_bug, of course.
	  Patch by Eric Wong. [ruby-core:38572][ruby-core:38594].

	* signal.c (rb_register_sigaltstack): ditto.

	* vm_core.h: moved ALT_STACK_SIZE definition from signal.c.
	* vm.c (thread_free): use xfree() instead of free().

Sat Jul 30 07:20:49 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/lib/socket.rb (udp_server_sockets): unused variable
	  removed.
	  patch by Jeremy Evans.  [ruby-core:38600]

Fri Jul 29 23:56:32 2011  Tanaka Akira  <akr@fsij.org>

	* lib/securerandom.rb: call OpenSSL::Random.seed at the
	  SecureRandom.random_bytes call.
	  based on the patch by Masahiro Tomita.  [ruby-dev:44270]

Fri Jul 29 23:53:48 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* array.c (rb_ary_set_len): new function to set array length.

	* vm_eval.c (method_missing): set the length of argv array, to mark
	  arguments.

	* vm_eval.c (rb_apply): get rid of too large alloca.

Fri Jul 29 20:48:39 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: fix typos.

Fri Jul 29 20:28:56 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: use whitespaces as a separator.

Fri Jul 29 18:59:07 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/mkconstants.rb: add documents for constants.
	  patch by Eric Hodel.  [ruby-core:37853] [Bug #4989]

Fri Jul 29 16:00:43 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* configure.in (enable_pthread): use -pthread on OpenBSD without
	  explicit option. patched by Jeremy Evans. [ruby-core:38572]

Thu Jul 28 23:36:28 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* ext/fiddle/closure.c (callback): use rb_ary_tmp_new() instead of
	  xmalloc() to allocate an array for arguments of callback procedure,
	  to prevent arguments from being swept by GC. [ruby-core:38546]
	  [Bug #4929]

Thu Jul 28 22:36:06 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_cipher.c (ossl_cipher_initialize): Avoid possible
	  SEGV from AES encryption/decryption. Processing data by
	  Cipher#update without initializing key (meaningless usage of Cipher
	  object since we don't offer a way to export a key) could cause SEGV.

	  In OpenSSL, the EVP which has EVP_CIPH_RAND_KEY flag (such as DES3)
	  allows uninitialized key, but other EVPs (such as AES) does not
	  allow it. Calling EVP_CipherUpdate() without initializing key causes
	  SEGV so we set the data filled with "\0" as the key by default. See
	  #2768.

	* test/openssl/test_cipher.rb: test it.

Thu Jul 28 14:25:08 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* lib/rubygems/user_interaction.rb (Gem::StreamUI#tty?): typo.

Thu Jul 28 12:32:53 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/callback/mkcallback.rb (gencallback): use PTR2NUM.

	* ext/dl/cptr.c (rb_dlptr_aref, rb_dlptr_aset): check NULL pointer
	  dereference.

	* ext/dl/cptr.c (rb_dlptr_s_to_ptr): use rb_check_funcall.

	* ext/dl/cptr.c (rb_dlptr_s_to_ptr): fix wrapping condition.

Thu Jul 28 04:53:31 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/delegate.rb:  Move file-level documentation to the appropriate
	  classes.

Thu Jul 28 02:15:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* ext/dl/cfunc.c (dlcfunc_mark), ext/dl/cptr.c (dlptr_mark):
	  workaround to mark wrapped object.  this is not a true fix,
	  because [Bug #4929] is caused by the interface design of DL.

Thu Jul 28 00:28:15 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/fileutils/test_fileutils.rb: add OpenBSD case.
	  patched by Jeremy Evans [ruby-core:38530] see #5097

	* test/ruby/test_process.rb: ditto.

Wed Jul 27 22:46:59 2011  CHIKANAGA Tomoyuki  <nagachika00@gmail.com>

	* test/rinda/test_rinda.rb (test_remote_array_and_hash):
	  add local variables to protect objects from GC. [ruby-dev:44253]
	  [Bug #5104]

Wed Jul 27 17:55:54 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* include/ruby/missing.h: define __syscall if the platform has
	  __syscall in the library but doesn't define it in headers
	  for example Mac OS X.

Wed Jul 27 15:39:14 2011  Eric Hodel  <drbrain@segment7.net>

	* object.c:  Add usage documentation for BasicObject.  Based on patch
	  by Thomas Sawyer.  [Ruby 1.9 - Bug #5067]

Wed Jul 27 12:24:17 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/uninstaller.rb:  Add missing require and update
	  messaging to avoid confusion with uninstall --format-executable.
	  [Ruby 1.9 - Bug #4062]

Wed Jul 27 09:34:24 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems:  Update to RubyGems 1.8.6.1.

Wed Jul 27 09:27:59 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_pkcs12.rb: Add test and intermediate certificates.
	  [ Ruby 1.9 - Feature #3793 ] [ruby-core:32088]

Wed Jul 27 01:05:32 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* eval_error.c (rb_print_undef_str): new function to raise
	  NameError for undefined method.

	* load.c (rb_mod_autoload_p), object.c (rb_mod_const_get),
	  variable.c (rb_f_untrace_var, set_const_visibility), vm_method.c
	  (rb_mod_{remove,undef,alias}_method, set_method_visibility):
	  remove inadvertent symbol creation.  based on the first patch by
	  Jeremy Evans at [ruby-core:38447].  [Feature #5089]

	* vm_method.c (obj_respond_to): fix the respond_to_missing? override
	  case.  based on the patch by Jeremy Evans at [ruby-core:38417].
	  [Feature #5072]

	* parse.y (rb_check_id): make the given name a symbol or a string.
	  based on the second patch by Jeremy Evans at [ruby-core:38447]

Wed Jul 27 00:50:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (Rational#to_d):
	  zero or negative precision is error.  fixes #5098.
	  [ruby-dev:44210]

	* test/bigdecimal/test_bigdecimal_util.rb: add test for the above
	  change.

Wed Jul 27 00:48:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (Float#to_d): modified for
	  specifying precision.  fixes #5098.  [ruby-dev:44210]

	* test/bigdecimal/test_bigdecimal_util.rb: add test for the above
	  change.

Wed Jul 27 00:45:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (Integer#to_d): added
	  for symmetry to BigDecimal() function with an Integer.
	  fixes #5098.  [ruby-dev:44210]

	* test/bigdecimal/test_bigdecimal_util.rb: add test for the above
	  change.

Wed Jul 27 00:30:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* ext/bigdecimal/lib/bigdecimal/util.rb (BigDecimal#to_d): added
	  for adapting other Numeric subclasses.  [ruby-dev:44245]

	* test/bigdecimal/test_bigdecimal_util.rb: test for the above change.

Wed Jul 27 00:27:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* bigdecimal/bigdecimal.c (VpDup) a new function for duplicating
	  a BigDecimal.

	* bigdecimal/bigdecimal.c (BigDecimal_new): support generating a new
	  BigDecimal from another BigDecimal using BigDecimal global function
	  or constructor.  [ruby-dev:44245]

Tue Jul 26 23:33:24 2011  Igor Zubkov  <igor.zubkov@gmail.com>

	* array.c: Fix typo. https://github.com/ruby/ruby/pull/36

Mon Jul 25 23:51:01 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c: pre-allocate the unlinked_method_entry_list_entry struct to
	  avoid memory allocation during GC.  based on a patch from Eric Wong.
	  [ruby-core:38498]

Mon Jul 25 23:39:33 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* test/rake/test_rake_directory_task.rb (TestRakeDirectoryTask#
	  test_directory_win32): fixed wrong test.

Mon Jul 25 22:36:11 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* proc.c (struct METHOD), gc.c (gc_marks), vm_method.c
	  (rb_gc_mark_unlinked_live_method_entries): fix SEGV bug.
	  rb_method_entry_t was free'd even when the method is still on the
	  stack if it is BMETHOD (i.e., Method#call).  This is because
	  rb_method_entry_t is embedded in struct METHOD.  This commit
	  separates them and marks the live method entries.
	  See [ruby-core:38449] in detail.  fix [Bug #5047] [ruby-core:38171]

Mon Jul 25 22:14:37 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* lib/xmlrpc/client.rb: Fix possible HTTP header formatting failure by
	  'Basic' header. Long username caused the base64 String truncation in
	  HTTP header which is not allowed. See #5046.

	* test/xmlrpc/test_webrick_server.rb: test it.

Mon Jul 25 15:04:33 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl.rb: End of transition period introduced by
	  [ruby-dev:38018]. From the next version of 1.9.3, you should use
	    require "openssl"
	  instead of
	    require "openssl/ssl"
	  and
	    require "openssl/x509"

Mon Jul 25 13:46:38 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/lib/openssl/x509.rb: Cosmetic change: move definition
	  introduced in r30152 to x509-internal.rb.

Mon Jul 25 13:09:42 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl_ssl.c (ossl_ssl_shutdown): Avoid randomly generated
	  SSLError from SSLSocket just after invoking SSLSocket#close.
	  OpenSSL's SSL_shutdown could try to send alert packet and it might
	  set SSLerr(global error stack) as the result. It causes the next
	  SSL read/write operation to fail by unrelated reason.

	  By design, we're ignoring any error at SSL_shutdown() so we clear
	  global error stack after SSL_shutdown is called. See #5039.

Sun Jul 24 20:29:53 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: refine the recvmsg test.

Sun Jul 24 20:02:31 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: fix the recvmsg test.

Sun Jul 24 08:42:51 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/extconf.rb: test recvmsg allocates file descriptors for
	  fd passing even with MSG_PEEK.

	* ext/socket/ancdata.c: use the above test result.

Sun Jul 24 01:04:50 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/rubygems/specification.rb:  Restore behavior of
	  Gem::Specification#loaded.  [Ruby 1.9 - Bug #5032]

Sun Jul 24 00:05:00 2011  Jeremy Evans  <merch-redmine@jeremyevans.net>

	* error.c (rb_name_error_str): new function to raise NameError
	  with the name string but not ID.

	* object.c, proc.c, variable.c: more removal of inadvertent symbol
	  creation.  [Feature #5079]

Sat Jul 23 21:14:00 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* lib/cmath.rb (cbrt): should return a real number if possible.

Sat Jul 23 20:12:52 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* test/rake/test_rake_functional.rb (setup): Use __FILE__ for the base
	  directory. Current directory is not the top source directory when
	  the building process runs on other than there.

	* test/rake/test_rake_rake_test_loader.rb: ditto.

	* test/rake/test_rake_task_argument_parsing.rb
	  (test_terminal_width_using_hardcoded_80): hardcoded 80 is used
	  when app.unix? is false.

Sat Jul 23 20:11:50 2011  Tadayoshi Funaba  <tadf@dotrb.org>

	* ext/date/date_core.c: an issue that is same as  [ruby-dev:44071].
	* ext/date/date_strftime.c: identical to [ruby-dev:44112].

Sat Jul 23 19:12:53 2011  Masaki Suketa <masaki.suketa@nifty.ne.jp>

	* test/win32ole/test_err_in_callback.rb (test_err_in_callback):
	  skip test if ADODB.connection is not available.

Sat Jul 23 15:37:04 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* parse.y (rb_enc_symname_type): :$a!, @a! and so on are not
	  valid symbols, so they should be inspected with quotes.

Sat Jul 23 17:06:25 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_update_max_fd): validate fd.

	* ext/socket/rubysocket.h (rsock_discard_cmsg_resource): add
	  msg_peek_p argument for the declaration.

	* ext/socket/ancdata.c (discard_cmsg): add msg_peek_p argument.
	  assume FreeBSD, NetBSD and MacOS X doesn't generate passed fd
	  when MSG_PEEK.
	  (rsock_discard_cmsg_resource): add msg_peek_p argument.
	  (bsock_recvmsg_internal): call rsock_discard_cmsg_resource with
	  msg_peek_p argument.

	* ext/socket/unixsocket.c (unix_recv_io): call
	  rsock_discard_cmsg_resource with msg_peek_p argument.

Sat Jul 23 14:38:28 2011  Eric Hodel  <drbrain@segment7.net>

	* test/rake*: Remove dependencies on flexmock and session gems.
	  [Ruby 1.9 - Bug #4987]

Sat Jul 23 12:19:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_check_id): take care of attrset ID created
	  implicitly by local ID.  [Bug #5084]

	* parse.y (rb_check_id): conversion condition was inverse.
	  [Bug #5084]

Fri Jul 22 21:46:54 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* vm_insnhelper.c (vm_call_cfunc): added volatile for a workaround
	  of cfp consistency error problem on OS X 10.7 (Lion). It's
	  suspected llvm optimization bug.
	  [Bug #5074] [ruby-dev:44185]

Fri Jul 22 21:18:20 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/uri/generic.rb (WFKV_): unroll the loop of regexp.

	* lib/uri/generic.rb (URI.decode_www_form_component): ditto.

Fri Jul 22 21:06:39 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* object.c (rb_mod_{const,cvar}_defined, rb_obj_ivar_defined):
	  avoid inadvertent symbol creation in reflection methods.  based
	  on a patch by Jeremy Evans at [ruby-core:38367].  [Feature #5072]

	* vm_method.c (rb_mod_method_defined)
	  (rb_mod_{public,private,protected}_method_defined)
	  (obj_respond_to): ditto.

	* parse.y (rb_check_id): new function returns already interned ID
	  or 0.

Fri Jul 22 20:44:49 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_is_global_id, rb_is_attrset_id): add missing
	  predicates.

Fri Jul 22 20:24:38 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* test/ruby/test_object.rb (TestObject#test_respond_to_missing):
	  2nd argument of respond_to_missing? is not optional.

Fri Jul 22 19:05:47 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* parse.y (rb_enc_symname2_p): get rid of potential out-of-bound
	  access.

Fri Jul 22 13:55:59 2011  Eric Hodel  <drbrain@segment7.net>

	* lib/net/http.rb:  Net::HTTP#finish is used to manually close
	  connections.  [Ruby 1.9 - Bug #5045]

Fri Jul 22 13:51:29 2011  Eric Hodel  <drbrain@segment7.net>

	* ext/readline/readline.c:  Add examples for Readline.completion_proc=.
	  [Ruby 1.9 - Bug #5057]

Fri Jul 22 13:03:12 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_hmac.c: Revert checking return type of
	  HMAC_Init_ex as it is not compatible with OpenSSL < 1.0.0.

Fri Jul 22 12:10:21 2011  Eric Hodel  <drbrain@segment7.net>

	* tool/rbinstall.rb (default gems):  Install executables into the fake
	  gem dir for Gem.bin_path.  [#4485]

Fri Jul 22 11:20:20 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_digest.c: Check return value of EVP_DigestInit_ex.
	* ext/openssl/ossl_hmac.c: Check return value of HMAC_Init_ex.
	  Thanks, Jared Jennings, for the patch.
	  [ Ruby 1.9 - Bug #4944 ] [ruby-core:37670]

Fri Jul 22 09:09:43 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* ext/openssl/ossl_engine.c: Avoid double free of ENGINE reference.
	* test/openssl/test_engine.rb: Add a test for it.
	  Thanks to Ippei Obayashi for providing the patch.
	  [ Ruby 1.9 - Bug #5062 ] [ruby-dev:44173]

Fri Jul 22 06:37:13 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/csv.rb: Do not modify CSV.generate's argument [ruby-core:38356]

Thu Jul 21 20:59:59 2011  Tanaka Akira  <akr@fsij.org>

	* ext/socket/ancdata.c (discard_cmsg): workaround for MacOS X Lion.

Thu Jul 21 20:02:11 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* thread.c (set_trace_func, thread_set_trace_func_m): reset tracing
	  state when set_trace_func hook is removed.  This is workaround patch
	  to force to reset tracing state that is broken by continuation call.
	  a patch from James M. Lawrence.  [Feature #4347] [ruby-core:34998]

	* test/ruby/test_continuation.rb (class TestContinuation): add a test
	  for above.  a patch from James M. Lawrence.

Thu Jul 21 19:27:19 2011  Yusuke Endoh  <mame@tsg.ne.jp>

	* node.c (dump_node): add today's knowledge.  "init arguments (m)" and
	  "init arguments (p)" of compile.c indicates a Ruby code that
	  evaluates multiple assignments that is in method or block
	  parameters:  def foo((m1,m2), (m3,m4), *r, (p1,p2), (p3,p4)); end
	  The former (init arguments (m)) evaluates the multiple assignments
	  before rest argument, that are (m1,m2) and (m3,m4).  The letter
	  (init arguments (p)) does ones after rest argument, that are
	  (p1,p2) and (p3, p4).

Thu Jul 21 18:11:07 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* enum.c (enum_inject): remove empty line to notify rdoc
	  Enumerable#reduce is alias. patched by milki@github.
	  https://github.com/ruby/ruby/pull/26

Thu Jul 21 17:30:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* array.c (rb_ary_delete_at_m): use simple array literal in rdoc.
	  patched by samuel tonini. [ruby-core:38310] [Bug #5066]

Thu Jul 21 17:14:21 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* lib/webrick/httprequest.rb (WEBrick::HTTPRequest#each):
	  Allow HTTP/0.9 request which doesn't has any header or body.
	  patched by Felix Jodoin. [ruby-core:38040] [Bug #5022]

Wed Jul 20 23:02:18 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* io.c (rb_update_max_fd): remove parentheses. they are not in
	  macro.

Wed Jul 20 22:22:23 2011  Tanaka Akira  <akr@fsij.org>

	* include/ruby/intern.h (rb_update_max_fd): declaration moved from
	  internal.h.

	* file.c: ditto.

	* io.c: call rb_update_max_fd for each new fds.

	* process.c: ditto.

	* random.c: ditto.

	* ruby.c: ditto.

	* ext/io/console/console.c: ditto.

	* ext/openssl/ossl_bio.c: ditto.

	* ext/pty/pty.c: ditto.

	* ext/socket/init.c: ditto.

	* ext/socket/socket.c: ditto.

	* ext/socket/ancdata.c: ditto.

	* ext/socket/unixsocket.c: ditto.

Wed Jul 20 15:16:22 2011  NARUSE, Yui  <naruse@ruby-lang.org>

	* ext/dl/handle.c (dlhandle_sym): clear previous error with dlerror()
	  before calling dlsym(). [ruby-dev:44091] [Bug #5021]

Wed Jul 20 07:16:26 2011  Kazuhiro NISHIYAMA  <zn@mbf.nifty.com>

	* NEWS: mention Kernel#warn.  [ruby-core:38119] [Feature #5029]

Tue Jul 19 16:40:45 2011  TAKANO Mitsuhiro (takano32)  <tak@no32.tk>

	* cont.c (cont_save_thread): fix missing semicolon.

Tue Jul 19 16:25:15 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (UPDATE_MAXFD): removed.

Tue Jul 19 16:07:45 2011  Tanaka Akira  <akr@fsij.org>

	* io.c (rb_update_max_fd): new function.

	* internal.h (rb_update_max_fd): declare rb_update_max_fd.

	* thread_pthread.c (rb_thread_create_timer_thread): update max fd when
	  timer thread pipe is created.

Mon Jul 18 13:36:47 2011  Aaron Patterson <aaron@tenderlovemaking.com>

	* ext/psych/lib/psych.rb: define a new BadAlias error class.

	* ext/psych/lib/psych/visitors/to_ruby.rb: raise an exception when
	  deserializing an alias that does not exist.

	* test/psych/test_merge_keys.rb: corresponding test.

Mon Jul 18 00:00:46 2011  Shugo Maeda  <shugo@ruby-lang.org>

	* ext/curses/curses.c: added the new class Curses::Pad, which
	  supports scrolling.  patch by Eric Hodel.  [Feature #4896]
	  [ruby-core:37206]

Sun Jul 17 16:26:40 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_check_trusted): new function to check an object is
	  trusted.

	* struct.c (rb_struct_modify), time.c (time_modify): check by the
	  above function to show proper class names.  [Bug #5036]

Sun Jul 17 15:30:04 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* error.c (rb_warn_m): accept multiple args in like puts.  rdoc
	  patch by Erik Price at [ruby-core:38119].  [Feature #5029]

Sun Jul 17 07:56:31 2011  Martin Bosslet  <Martin.Bosslet@googlemail.com>

	* test/openssl/test_ssl_session.rb: add PEM SSL session without TLS
	  extensions. Use this as the default for the tests to ensure
	  compatibility with OpenSSL 0.9.7.
	  [ Ruby 1.9 - Bug #4961 ] [ruby-core:37726]

Sat Jul 16 17:29:20 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* configure.in (RUBY_UNIVERSAL_ARCH): restore arch flag.
	  Bug #4977

Sat Jul 16 06:27:51 2011  Marc-Andre Lafortune  <ruby-core@marc-andre.ca>

	* lib/uri/common.rb (module): Remove optional parser argument to
	  Kernel#URI
	  [ruby-core:38061]

	* lib/uri/generic.rb (module): ditto

Sat Jul 16 03:19:45 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c (is_socket, is_console): add prototypes to fix compile
	  problem with gcc introduced at r32549.
	  reported by Jon Forums. [Bug #5030] [ruby-core:38079]

Sat Jul 16 00:55:38 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* time.c (time_dup): used rb_obj_class() instead of CLASS_OF().
	  The patch is made by Kazuki Tsujimoto. [Bug #5012] [ruby-dev:44071]

	* test/ruby/test_time.rb (TestTime#test_getlocal_dont_share_eigenclass):
	  added a new test for eigenclass of time object.

Fri Jul 15 19:11:00 2011  Kenta Murata  <mrkn@mrkn.jp>

	* bignum.c (bigsub_int): add RB_GC_GUARD.  This patch is made by
	  Makoto Kishimoto.  fixes #4223 [ruby-dev:42907]

	* bignum.c (bigadd_int): ditto.

Fri Jul 15 14:27:53 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/win32.c, include/ruby/win32.h (rb_w32_io_cancelable_p): renamed
	  from rb_w32_has_cancel_io().  now it takes a parameter as fd to check
	  the fd is console or not, because we cannot cancel console input even
	  if we have cancel_io function.

	* io.c (WAIT_FD_IN_WIN32): call above function instead of the old one,
	  so now we can kill the thread which calls STDIN.gets.
	  the problem was reported by ko1 via IRC.

Fri Jul 15 09:10:41 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/digest/sha2/sha2.c (SHA256_Update, SHA512_Update): avoid Bus
	  Error caused by unalignment access on Sparc-Solaris (and possibly on
	  other similar environment.) This patch just do memcpy always instead
	  of checking architecture. I see no perf drop on my 64bit env. For
	  more details, see #4320.

	* test/digest/test_digest.rb: add test for unalignment access.

Fri Jul 15 01:51:25 2011  Nobuyoshi Nakada  <nobu@ruby-lang.org>

	* regint.h (PLATFORM_UNALIGNED_WORD_ACCESS): Power PC does not
	  allow unaligned word access.

	* st.c (UNALIGNED_WORD_ACCESS): x86_64 allows unaligned word
	  access as well as i386.

Thu Jul 14 12:19:34 2011  Hiroshi Nakamura  <nahi@ruby-lang.org>

	* ext/openssl/ossl.c (ossl_verify_cb): trap the exception from
	  verify callback of SSLContext and X509Store and make the
	  verification fail normally. Raising exception directly from callback
	  causes orphan resources in OpenSSL stack. Patched by Ippei Obayashi.
	  See #4445.

	* test/openssl/test_ssl.rb
	  (test_exception_in_verify_callback_is_ignored): test it.

Tue Jul 12 23:41:49 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* NEWS: add a description of Signal.trap change.

Tue Jul 12 20:02:35 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (reserved_signal_p): reverted a part of r32523.
	  chikanaga noticed trap(:CHLD) has some realworld usecase.
	* test/ruby/test_signal.rb (TestSignal#test_reserved_signal):
	  ditto.

Tue Jul 12 17:12:45 2011  Yukihiro Matsumoto  <matz@ruby-lang.org>

	* vm_method.c (rb_add_method): should not call method_added hook
	  for undef operation. [Bug #5015]

Tue Jul 12 16:58:44 2011  Shota Fukumori  <sorah@tubusu.net>

	* lib/test/unit.rb(Test::Unit::Options#process_args): Fix bug.
	  Fix process_args didn't return `@option` after r30939.

Tue Jul 12 14:07:46 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (install_sighandler): fixed a race.

Tue Jul 12 13:49:32 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* signal.c (sig_trap): don't permit to change a signal handler which
	  the interpreter reserved.
	* signal.c (reserved_signal_p): ditto.
	  [Bug #2616] [ruby-core:27625]

	* test/ruby/test_signal.rb (TestSignal#test_reserved_signal):
	  added a test for reserved signal.

Tue Jul 12 11:58:28 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* win32/setup.mak: support x86-amd64 cross compile environment.

Mon Jul 11 23:22:28 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* time.c: can't compile time.c on AIX due to missing declaration for
	  ffs(). It is declared in strings.h on AIX.

Mon Jul 11 15:54:24 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* process.c: removed signal() macro. It's no longer used.

Mon Jul 11 15:02:24 2011  NAKAMURA Usaku  <usa@ruby-lang.org>

	* numeric.c (rb_num2ull): use FIX2LONG instead of FIX2ULONG. see
	  rb_num2ulong(). fixed the problem of ObjectSpace._id2ref of IL32LLP64
	  platforms, introduced at r32433.

Mon Jul 11 05:38:05 2011  Yutaka Kanemoto  <kanemoto@ruby-lang.org>

	* thread_pthread.c (get_stack): need to adjust stack addr for
	  [Bug #1813] on AIX.

Mon Jul 11 01:16:27 2011  KOSAKI Motohiro  <kosaki.motohiro@gmail.com>

	* thread_pthread.c (rb_thread_create_timer_thread): removed
	  rb_disable_interrupt()/rb_enable_interrupt().
	* vm_core.h: ditto.
	* process.c (static void before_exec): ditto.
	* process.c (static void after_exec): ditto.
	  [Bug #4765] [ruby-dev:43571]

	* eval_intern.h: removed rb_trap_restore_mask().
	* vm_eval.c (rb_throw_obj): ditto.
	* eval.c (setup_exception): ditto.

	* signal.c: removed trap_last_mask.
	* signal.c (trap_restore_mask): removed.
	* signal.c (init_sigchld): comment clarification why signal block
	  is needed. and removed trap_last_mask operation.
	* signal.c (trap_ensure): removed trap_last_mask operation.

	* signal.c (rb_disable_interrupt, rb_enable_interrupt): made
	  static and removed sigdelset(SIGVTALRM) and sigdelset(SIGSEGV).

	* process.c (rb_syswait): removed implicit signal handler change.

Sun Jul 10 23:49:12 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* docs/NEWS-1.9.3: moved from NEWS.

	* docs/ChangeLog-1.9.3: merged ChangeLog for 1.9.3.

	* NEWS: NEWS for 1.9.4 that describes changes since 1.9.3

	* ChangeLog: new ChangeLog for 1.9.4.

Sun Jul 10 23:30:52 2011  Yuki Sonoda (Yugui)  <yugui@yugui.jp>

	* version.h (RUBY_VERSION): ruby_1_9_3 branch was forked.

For the changes before 1.9.3, see doc/ChangeLog-1.9.3
For the changes before 1.8.0, see doc/ChangeLog-1.8.0

Local variables:
coding: us-ascii
add-log-time-format: (lambda ()
  (let* ((time (current-time))
	 (system-time-locale "C")
	 (diff (+ (cadr time) 32400))
	 (lo (% diff 65536))
	 (hi (+ (car time) (/ diff 65536))))
  (format-time-string "%a %b %e %H:%M:%S %Y" (list hi lo) t)))
indent-tabs-mode: t
tab-width: 8
change-log-indent-text: 2
end:
vim: tabstop=8 shiftwidth=2
